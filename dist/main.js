(()=>{var t={486:function(t,e,n){var r;
/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */t=n.nmd(t),function(){var i,o="Expected a function",a="__lodash_hash_undefined__",s="__lodash_placeholder__",u=16,l=32,c=64,f=128,h=256,d=1/0,p=9007199254740991,v=NaN,m=4294967295,g=[["ary",f],["bind",1],["bindKey",2],["curry",8],["curryRight",u],["flip",512],["partial",l],["partialRight",c],["rearg",h]],y="[object Arguments]",x="[object Array]",_="[object Boolean]",b="[object Date]",A="[object Error]",T="[object Function]",w="[object GeneratorFunction]",S="[object Map]",N="[object Number]",F="[object Object]",P="[object Promise]",L="[object RegExp]",O="[object Set]",E="[object String]",C="[object Symbol]",I="[object WeakMap]",U="[object ArrayBuffer]",R="[object DataView]",M="[object Float32Array]",z="[object Float64Array]",D="[object Int8Array]",X="[object Int16Array]",j="[object Int32Array]",J="[object Uint8Array]",Q="[object Uint8ClampedArray]",k="[object Uint16Array]",B="[object Uint32Array]",V=/\b__p \+= '';/g,Y=/\b(__p \+=) '' \+/g,H=/(__e\(.*?\)|\b__t\)) \+\n'';/g,W=/&(?:amp|lt|gt|quot|#39);/g,G=/[&<>"']/g,q=RegExp(W.source),$=RegExp(G.source),K=/<%-([\s\S]+?)%>/g,Z=/<%([\s\S]+?)%>/g,tt=/<%=([\s\S]+?)%>/g,et=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,nt=/^\w*$/,rt=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,it=/[\\^$.*+?()[\]{}|]/g,ot=RegExp(it.source),at=/^\s+/,st=/\s/,ut=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,lt=/\{\n\/\* \[wrapped with (.+)\] \*/,ct=/,? & /,ft=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,ht=/[()=,{}\[\]\/\s]/,dt=/\\(\\)?/g,pt=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,vt=/\w*$/,mt=/^[-+]0x[0-9a-f]+$/i,gt=/^0b[01]+$/i,yt=/^\[object .+?Constructor\]$/,xt=/^0o[0-7]+$/i,_t=/^(?:0|[1-9]\d*)$/,bt=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,At=/($^)/,Tt=/['\n\r\u2028\u2029\\]/g,wt="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",St="\\u2700-\\u27bf",Nt="a-z\\xdf-\\xf6\\xf8-\\xff",Ft="A-Z\\xc0-\\xd6\\xd8-\\xde",Pt="\\ufe0e\\ufe0f",Lt="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Ot="['’]",Et="[\\ud800-\\udfff]",Ct="["+Lt+"]",It="["+wt+"]",Ut="\\d+",Rt="[\\u2700-\\u27bf]",Mt="["+Nt+"]",zt="[^\\ud800-\\udfff"+Lt+Ut+St+Nt+Ft+"]",Dt="\\ud83c[\\udffb-\\udfff]",Xt="[^\\ud800-\\udfff]",jt="(?:\\ud83c[\\udde6-\\uddff]){2}",Jt="[\\ud800-\\udbff][\\udc00-\\udfff]",Qt="["+Ft+"]",kt="(?:"+Mt+"|"+zt+")",Bt="(?:"+Qt+"|"+zt+")",Vt="(?:['’](?:d|ll|m|re|s|t|ve))?",Yt="(?:['’](?:D|LL|M|RE|S|T|VE))?",Ht="(?:"+It+"|"+Dt+")"+"?",Wt="[\\ufe0e\\ufe0f]?",Gt=Wt+Ht+("(?:\\u200d(?:"+[Xt,jt,Jt].join("|")+")"+Wt+Ht+")*"),qt="(?:"+[Rt,jt,Jt].join("|")+")"+Gt,$t="(?:"+[Xt+It+"?",It,jt,Jt,Et].join("|")+")",Kt=RegExp(Ot,"g"),Zt=RegExp(It,"g"),te=RegExp(Dt+"(?="+Dt+")|"+$t+Gt,"g"),ee=RegExp([Qt+"?"+Mt+"+"+Vt+"(?="+[Ct,Qt,"$"].join("|")+")",Bt+"+"+Yt+"(?="+[Ct,Qt+kt,"$"].join("|")+")",Qt+"?"+kt+"+"+Vt,Qt+"+"+Yt,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Ut,qt].join("|"),"g"),ne=RegExp("[\\u200d\\ud800-\\udfff"+wt+Pt+"]"),re=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,ie=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],oe=-1,ae={};ae[M]=ae[z]=ae[D]=ae[X]=ae[j]=ae[J]=ae[Q]=ae[k]=ae[B]=!0,ae[y]=ae[x]=ae[U]=ae[_]=ae[R]=ae[b]=ae[A]=ae[T]=ae[S]=ae[N]=ae[F]=ae[L]=ae[O]=ae[E]=ae[I]=!1;var se={};se[y]=se[x]=se[U]=se[R]=se[_]=se[b]=se[M]=se[z]=se[D]=se[X]=se[j]=se[S]=se[N]=se[F]=se[L]=se[O]=se[E]=se[C]=se[J]=se[Q]=se[k]=se[B]=!0,se[A]=se[T]=se[I]=!1;var ue={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},le=parseFloat,ce=parseInt,fe="object"==typeof n.g&&n.g&&n.g.Object===Object&&n.g,he="object"==typeof self&&self&&self.Object===Object&&self,de=fe||he||Function("return this")(),pe=e&&!e.nodeType&&e,ve=pe&&t&&!t.nodeType&&t,me=ve&&ve.exports===pe,ge=me&&fe.process,ye=function(){try{var t=ve&&ve.require&&ve.require("util").types;return t||ge&&ge.binding&&ge.binding("util")}catch(t){}}(),xe=ye&&ye.isArrayBuffer,_e=ye&&ye.isDate,be=ye&&ye.isMap,Ae=ye&&ye.isRegExp,Te=ye&&ye.isSet,we=ye&&ye.isTypedArray;function Se(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}function Ne(t,e,n,r){for(var i=-1,o=null==t?0:t.length;++i<o;){var a=t[i];e(r,a,n(a),t)}return r}function Fe(t,e){for(var n=-1,r=null==t?0:t.length;++n<r&&!1!==e(t[n],n,t););return t}function Pe(t,e){for(var n=null==t?0:t.length;n--&&!1!==e(t[n],n,t););return t}function Le(t,e){for(var n=-1,r=null==t?0:t.length;++n<r;)if(!e(t[n],n,t))return!1;return!0}function Oe(t,e){for(var n=-1,r=null==t?0:t.length,i=0,o=[];++n<r;){var a=t[n];e(a,n,t)&&(o[i++]=a)}return o}function Ee(t,e){return!!(null==t?0:t.length)&&Je(t,e,0)>-1}function Ce(t,e,n){for(var r=-1,i=null==t?0:t.length;++r<i;)if(n(e,t[r]))return!0;return!1}function Ie(t,e){for(var n=-1,r=null==t?0:t.length,i=Array(r);++n<r;)i[n]=e(t[n],n,t);return i}function Ue(t,e){for(var n=-1,r=e.length,i=t.length;++n<r;)t[i+n]=e[n];return t}function Re(t,e,n,r){var i=-1,o=null==t?0:t.length;for(r&&o&&(n=t[++i]);++i<o;)n=e(n,t[i],i,t);return n}function Me(t,e,n,r){var i=null==t?0:t.length;for(r&&i&&(n=t[--i]);i--;)n=e(n,t[i],i,t);return n}function ze(t,e){for(var n=-1,r=null==t?0:t.length;++n<r;)if(e(t[n],n,t))return!0;return!1}var De=Ve("length");function Xe(t,e,n){var r;return n(t,(function(t,n,i){if(e(t,n,i))return r=n,!1})),r}function je(t,e,n,r){for(var i=t.length,o=n+(r?1:-1);r?o--:++o<i;)if(e(t[o],o,t))return o;return-1}function Je(t,e,n){return e==e?function(t,e,n){var r=n-1,i=t.length;for(;++r<i;)if(t[r]===e)return r;return-1}(t,e,n):je(t,ke,n)}function Qe(t,e,n,r){for(var i=n-1,o=t.length;++i<o;)if(r(t[i],e))return i;return-1}function ke(t){return t!=t}function Be(t,e){var n=null==t?0:t.length;return n?We(t,e)/n:v}function Ve(t){return function(e){return null==e?i:e[t]}}function Ye(t){return function(e){return null==t?i:t[e]}}function He(t,e,n,r,i){return i(t,(function(t,i,o){n=r?(r=!1,t):e(n,t,i,o)})),n}function We(t,e){for(var n,r=-1,o=t.length;++r<o;){var a=e(t[r]);a!==i&&(n=n===i?a:n+a)}return n}function Ge(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}function qe(t){return t?t.slice(0,vn(t)+1).replace(at,""):t}function $e(t){return function(e){return t(e)}}function Ke(t,e){return Ie(e,(function(e){return t[e]}))}function Ze(t,e){return t.has(e)}function tn(t,e){for(var n=-1,r=t.length;++n<r&&Je(e,t[n],0)>-1;);return n}function en(t,e){for(var n=t.length;n--&&Je(e,t[n],0)>-1;);return n}function nn(t,e){for(var n=t.length,r=0;n--;)t[n]===e&&++r;return r}var rn=Ye({À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"}),on=Ye({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function an(t){return"\\"+ue[t]}function sn(t){return ne.test(t)}function un(t){var e=-1,n=Array(t.size);return t.forEach((function(t,r){n[++e]=[r,t]})),n}function ln(t,e){return function(n){return t(e(n))}}function cn(t,e){for(var n=-1,r=t.length,i=0,o=[];++n<r;){var a=t[n];a!==e&&a!==s||(t[n]=s,o[i++]=n)}return o}function fn(t){var e=-1,n=Array(t.size);return t.forEach((function(t){n[++e]=t})),n}function hn(t){var e=-1,n=Array(t.size);return t.forEach((function(t){n[++e]=[t,t]})),n}function dn(t){return sn(t)?function(t){var e=te.lastIndex=0;for(;te.test(t);)++e;return e}(t):De(t)}function pn(t){return sn(t)?function(t){return t.match(te)||[]}(t):function(t){return t.split("")}(t)}function vn(t){for(var e=t.length;e--&&st.test(t.charAt(e)););return e}var mn=Ye({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"});var gn=function t(e){var n,r=(e=null==e?de:gn.defaults(de.Object(),e,gn.pick(de,ie))).Array,st=e.Date,wt=e.Error,St=e.Function,Nt=e.Math,Ft=e.Object,Pt=e.RegExp,Lt=e.String,Ot=e.TypeError,Et=r.prototype,Ct=St.prototype,It=Ft.prototype,Ut=e["__core-js_shared__"],Rt=Ct.toString,Mt=It.hasOwnProperty,zt=0,Dt=(n=/[^.]+$/.exec(Ut&&Ut.keys&&Ut.keys.IE_PROTO||""))?"Symbol(src)_1."+n:"",Xt=It.toString,jt=Rt.call(Ft),Jt=de._,Qt=Pt("^"+Rt.call(Mt).replace(it,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),kt=me?e.Buffer:i,Bt=e.Symbol,Vt=e.Uint8Array,Yt=kt?kt.allocUnsafe:i,Ht=ln(Ft.getPrototypeOf,Ft),Wt=Ft.create,Gt=It.propertyIsEnumerable,qt=Et.splice,$t=Bt?Bt.isConcatSpreadable:i,te=Bt?Bt.iterator:i,ne=Bt?Bt.toStringTag:i,ue=function(){try{var t=po(Ft,"defineProperty");return t({},"",{}),t}catch(t){}}(),fe=e.clearTimeout!==de.clearTimeout&&e.clearTimeout,he=st&&st.now!==de.Date.now&&st.now,pe=e.setTimeout!==de.setTimeout&&e.setTimeout,ve=Nt.ceil,ge=Nt.floor,ye=Ft.getOwnPropertySymbols,De=kt?kt.isBuffer:i,Ye=e.isFinite,yn=Et.join,xn=ln(Ft.keys,Ft),_n=Nt.max,bn=Nt.min,An=st.now,Tn=e.parseInt,wn=Nt.random,Sn=Et.reverse,Nn=po(e,"DataView"),Fn=po(e,"Map"),Pn=po(e,"Promise"),Ln=po(e,"Set"),On=po(e,"WeakMap"),En=po(Ft,"create"),Cn=On&&new On,In={},Un=Jo(Nn),Rn=Jo(Fn),Mn=Jo(Pn),zn=Jo(Ln),Dn=Jo(On),Xn=Bt?Bt.prototype:i,jn=Xn?Xn.valueOf:i,Jn=Xn?Xn.toString:i;function Qn(t){if(is(t)&&!Ha(t)&&!(t instanceof Yn)){if(t instanceof Vn)return t;if(Mt.call(t,"__wrapped__"))return Qo(t)}return new Vn(t)}var kn=function(){function t(){}return function(e){if(!rs(e))return{};if(Wt)return Wt(e);t.prototype=e;var n=new t;return t.prototype=i,n}}();function Bn(){}function Vn(t,e){this.__wrapped__=t,this.__actions__=[],this.__chain__=!!e,this.__index__=0,this.__values__=i}function Yn(t){this.__wrapped__=t,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=m,this.__views__=[]}function Hn(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function Wn(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function Gn(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function qn(t){var e=-1,n=null==t?0:t.length;for(this.__data__=new Gn;++e<n;)this.add(t[e])}function $n(t){var e=this.__data__=new Wn(t);this.size=e.size}function Kn(t,e){var n=Ha(t),r=!n&&Ya(t),i=!n&&!r&&$a(t),o=!n&&!r&&!i&&hs(t),a=n||r||i||o,s=a?Ge(t.length,Lt):[],u=s.length;for(var l in t)!e&&!Mt.call(t,l)||a&&("length"==l||i&&("offset"==l||"parent"==l)||o&&("buffer"==l||"byteLength"==l||"byteOffset"==l)||bo(l,u))||s.push(l);return s}function Zn(t){var e=t.length;return e?t[qr(0,e-1)]:i}function tr(t,e){return Do(Ei(t),lr(e,0,t.length))}function er(t){return Do(Ei(t))}function nr(t,e,n){(n!==i&&!ka(t[e],n)||n===i&&!(e in t))&&sr(t,e,n)}function rr(t,e,n){var r=t[e];Mt.call(t,e)&&ka(r,n)&&(n!==i||e in t)||sr(t,e,n)}function ir(t,e){for(var n=t.length;n--;)if(ka(t[n][0],e))return n;return-1}function or(t,e,n,r){return pr(t,(function(t,i,o){e(r,t,n(t),o)})),r}function ar(t,e){return t&&Ci(e,Us(e),t)}function sr(t,e,n){"__proto__"==e&&ue?ue(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}function ur(t,e){for(var n=-1,o=e.length,a=r(o),s=null==t;++n<o;)a[n]=s?i:Ls(t,e[n]);return a}function lr(t,e,n){return t==t&&(n!==i&&(t=t<=n?t:n),e!==i&&(t=t>=e?t:e)),t}function cr(t,e,n,r,o,a){var s,u=1&e,l=2&e,c=4&e;if(n&&(s=o?n(t,r,o,a):n(t)),s!==i)return s;if(!rs(t))return t;var f=Ha(t);if(f){if(s=function(t){var e=t.length,n=new t.constructor(e);e&&"string"==typeof t[0]&&Mt.call(t,"index")&&(n.index=t.index,n.input=t.input);return n}(t),!u)return Ei(t,s)}else{var h=go(t),d=h==T||h==w;if($a(t))return Si(t,u);if(h==F||h==y||d&&!o){if(s=l||d?{}:xo(t),!u)return l?function(t,e){return Ci(t,mo(t),e)}(t,function(t,e){return t&&Ci(e,Rs(e),t)}(s,t)):function(t,e){return Ci(t,vo(t),e)}(t,ar(s,t))}else{if(!se[h])return o?t:{};s=function(t,e,n){var r=t.constructor;switch(e){case U:return Ni(t);case _:case b:return new r(+t);case R:return function(t,e){var n=e?Ni(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}(t,n);case M:case z:case D:case X:case j:case J:case Q:case k:case B:return Fi(t,n);case S:return new r;case N:case E:return new r(t);case L:return function(t){var e=new t.constructor(t.source,vt.exec(t));return e.lastIndex=t.lastIndex,e}(t);case O:return new r;case C:return i=t,jn?Ft(jn.call(i)):{}}var i}(t,h,u)}}a||(a=new $n);var p=a.get(t);if(p)return p;a.set(t,s),ls(t)?t.forEach((function(r){s.add(cr(r,e,n,r,t,a))})):os(t)&&t.forEach((function(r,i){s.set(i,cr(r,e,n,i,t,a))}));var v=f?i:(c?l?ao:oo:l?Rs:Us)(t);return Fe(v||t,(function(r,i){v&&(r=t[i=r]),rr(s,i,cr(r,e,n,i,t,a))})),s}function fr(t,e,n){var r=n.length;if(null==t)return!r;for(t=Ft(t);r--;){var o=n[r],a=e[o],s=t[o];if(s===i&&!(o in t)||!a(s))return!1}return!0}function hr(t,e,n){if("function"!=typeof t)throw new Ot(o);return Uo((function(){t.apply(i,n)}),e)}function dr(t,e,n,r){var i=-1,o=Ee,a=!0,s=t.length,u=[],l=e.length;if(!s)return u;n&&(e=Ie(e,$e(n))),r?(o=Ce,a=!1):e.length>=200&&(o=Ze,a=!1,e=new qn(e));t:for(;++i<s;){var c=t[i],f=null==n?c:n(c);if(c=r||0!==c?c:0,a&&f==f){for(var h=l;h--;)if(e[h]===f)continue t;u.push(c)}else o(e,f,r)||u.push(c)}return u}Qn.templateSettings={escape:K,evaluate:Z,interpolate:tt,variable:"",imports:{_:Qn}},Qn.prototype=Bn.prototype,Qn.prototype.constructor=Qn,Vn.prototype=kn(Bn.prototype),Vn.prototype.constructor=Vn,Yn.prototype=kn(Bn.prototype),Yn.prototype.constructor=Yn,Hn.prototype.clear=function(){this.__data__=En?En(null):{},this.size=0},Hn.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},Hn.prototype.get=function(t){var e=this.__data__;if(En){var n=e[t];return n===a?i:n}return Mt.call(e,t)?e[t]:i},Hn.prototype.has=function(t){var e=this.__data__;return En?e[t]!==i:Mt.call(e,t)},Hn.prototype.set=function(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=En&&e===i?a:e,this},Wn.prototype.clear=function(){this.__data__=[],this.size=0},Wn.prototype.delete=function(t){var e=this.__data__,n=ir(e,t);return!(n<0)&&(n==e.length-1?e.pop():qt.call(e,n,1),--this.size,!0)},Wn.prototype.get=function(t){var e=this.__data__,n=ir(e,t);return n<0?i:e[n][1]},Wn.prototype.has=function(t){return ir(this.__data__,t)>-1},Wn.prototype.set=function(t,e){var n=this.__data__,r=ir(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this},Gn.prototype.clear=function(){this.size=0,this.__data__={hash:new Hn,map:new(Fn||Wn),string:new Hn}},Gn.prototype.delete=function(t){var e=fo(this,t).delete(t);return this.size-=e?1:0,e},Gn.prototype.get=function(t){return fo(this,t).get(t)},Gn.prototype.has=function(t){return fo(this,t).has(t)},Gn.prototype.set=function(t,e){var n=fo(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this},qn.prototype.add=qn.prototype.push=function(t){return this.__data__.set(t,a),this},qn.prototype.has=function(t){return this.__data__.has(t)},$n.prototype.clear=function(){this.__data__=new Wn,this.size=0},$n.prototype.delete=function(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n},$n.prototype.get=function(t){return this.__data__.get(t)},$n.prototype.has=function(t){return this.__data__.has(t)},$n.prototype.set=function(t,e){var n=this.__data__;if(n instanceof Wn){var r=n.__data__;if(!Fn||r.length<199)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new Gn(r)}return n.set(t,e),this.size=n.size,this};var pr=Ri(Ar),vr=Ri(Tr,!0);function mr(t,e){var n=!0;return pr(t,(function(t,r,i){return n=!!e(t,r,i)})),n}function gr(t,e,n){for(var r=-1,o=t.length;++r<o;){var a=t[r],s=e(a);if(null!=s&&(u===i?s==s&&!fs(s):n(s,u)))var u=s,l=a}return l}function yr(t,e){var n=[];return pr(t,(function(t,r,i){e(t,r,i)&&n.push(t)})),n}function xr(t,e,n,r,i){var o=-1,a=t.length;for(n||(n=_o),i||(i=[]);++o<a;){var s=t[o];e>0&&n(s)?e>1?xr(s,e-1,n,r,i):Ue(i,s):r||(i[i.length]=s)}return i}var _r=Mi(),br=Mi(!0);function Ar(t,e){return t&&_r(t,e,Us)}function Tr(t,e){return t&&br(t,e,Us)}function wr(t,e){return Oe(e,(function(e){return ts(t[e])}))}function Sr(t,e){for(var n=0,r=(e=bi(e,t)).length;null!=t&&n<r;)t=t[jo(e[n++])];return n&&n==r?t:i}function Nr(t,e,n){var r=e(t);return Ha(t)?r:Ue(r,n(t))}function Fr(t){return null==t?t===i?"[object Undefined]":"[object Null]":ne&&ne in Ft(t)?function(t){var e=Mt.call(t,ne),n=t[ne];try{t[ne]=i;var r=!0}catch(t){}var o=Xt.call(t);r&&(e?t[ne]=n:delete t[ne]);return o}(t):function(t){return Xt.call(t)}(t)}function Pr(t,e){return t>e}function Lr(t,e){return null!=t&&Mt.call(t,e)}function Or(t,e){return null!=t&&e in Ft(t)}function Er(t,e,n){for(var o=n?Ce:Ee,a=t[0].length,s=t.length,u=s,l=r(s),c=1/0,f=[];u--;){var h=t[u];u&&e&&(h=Ie(h,$e(e))),c=bn(h.length,c),l[u]=!n&&(e||a>=120&&h.length>=120)?new qn(u&&h):i}h=t[0];var d=-1,p=l[0];t:for(;++d<a&&f.length<c;){var v=h[d],m=e?e(v):v;if(v=n||0!==v?v:0,!(p?Ze(p,m):o(f,m,n))){for(u=s;--u;){var g=l[u];if(!(g?Ze(g,m):o(t[u],m,n)))continue t}p&&p.push(m),f.push(v)}}return f}function Cr(t,e,n){var r=null==(t=Oo(t,e=bi(e,t)))?t:t[jo(Zo(e))];return null==r?i:Se(r,t,n)}function Ir(t){return is(t)&&Fr(t)==y}function Ur(t,e,n,r,o){return t===e||(null==t||null==e||!is(t)&&!is(e)?t!=t&&e!=e:function(t,e,n,r,o,a){var s=Ha(t),u=Ha(e),l=s?x:go(t),c=u?x:go(e),f=(l=l==y?F:l)==F,h=(c=c==y?F:c)==F,d=l==c;if(d&&$a(t)){if(!$a(e))return!1;s=!0,f=!1}if(d&&!f)return a||(a=new $n),s||hs(t)?ro(t,e,n,r,o,a):function(t,e,n,r,i,o,a){switch(n){case R:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case U:return!(t.byteLength!=e.byteLength||!o(new Vt(t),new Vt(e)));case _:case b:case N:return ka(+t,+e);case A:return t.name==e.name&&t.message==e.message;case L:case E:return t==e+"";case S:var s=un;case O:var u=1&r;if(s||(s=fn),t.size!=e.size&&!u)return!1;var l=a.get(t);if(l)return l==e;r|=2,a.set(t,e);var c=ro(s(t),s(e),r,i,o,a);return a.delete(t),c;case C:if(jn)return jn.call(t)==jn.call(e)}return!1}(t,e,l,n,r,o,a);if(!(1&n)){var p=f&&Mt.call(t,"__wrapped__"),v=h&&Mt.call(e,"__wrapped__");if(p||v){var m=p?t.value():t,g=v?e.value():e;return a||(a=new $n),o(m,g,n,r,a)}}if(!d)return!1;return a||(a=new $n),function(t,e,n,r,o,a){var s=1&n,u=oo(t),l=u.length,c=oo(e).length;if(l!=c&&!s)return!1;var f=l;for(;f--;){var h=u[f];if(!(s?h in e:Mt.call(e,h)))return!1}var d=a.get(t),p=a.get(e);if(d&&p)return d==e&&p==t;var v=!0;a.set(t,e),a.set(e,t);var m=s;for(;++f<l;){var g=t[h=u[f]],y=e[h];if(r)var x=s?r(y,g,h,e,t,a):r(g,y,h,t,e,a);if(!(x===i?g===y||o(g,y,n,r,a):x)){v=!1;break}m||(m="constructor"==h)}if(v&&!m){var _=t.constructor,b=e.constructor;_==b||!("constructor"in t)||!("constructor"in e)||"function"==typeof _&&_ instanceof _&&"function"==typeof b&&b instanceof b||(v=!1)}return a.delete(t),a.delete(e),v}(t,e,n,r,o,a)}(t,e,n,r,Ur,o))}function Rr(t,e,n,r){var o=n.length,a=o,s=!r;if(null==t)return!a;for(t=Ft(t);o--;){var u=n[o];if(s&&u[2]?u[1]!==t[u[0]]:!(u[0]in t))return!1}for(;++o<a;){var l=(u=n[o])[0],c=t[l],f=u[1];if(s&&u[2]){if(c===i&&!(l in t))return!1}else{var h=new $n;if(r)var d=r(c,f,l,t,e,h);if(!(d===i?Ur(f,c,3,r,h):d))return!1}}return!0}function Mr(t){return!(!rs(t)||(e=t,Dt&&Dt in e))&&(ts(t)?Qt:yt).test(Jo(t));var e}function zr(t){return"function"==typeof t?t:null==t?au:"object"==typeof t?Ha(t)?kr(t[0],t[1]):Qr(t):vu(t)}function Dr(t){if(!No(t))return xn(t);var e=[];for(var n in Ft(t))Mt.call(t,n)&&"constructor"!=n&&e.push(n);return e}function Xr(t){if(!rs(t))return function(t){var e=[];if(null!=t)for(var n in Ft(t))e.push(n);return e}(t);var e=No(t),n=[];for(var r in t)("constructor"!=r||!e&&Mt.call(t,r))&&n.push(r);return n}function jr(t,e){return t<e}function Jr(t,e){var n=-1,i=Ga(t)?r(t.length):[];return pr(t,(function(t,r,o){i[++n]=e(t,r,o)})),i}function Qr(t){var e=ho(t);return 1==e.length&&e[0][2]?Po(e[0][0],e[0][1]):function(n){return n===t||Rr(n,t,e)}}function kr(t,e){return To(t)&&Fo(e)?Po(jo(t),e):function(n){var r=Ls(n,t);return r===i&&r===e?Os(n,t):Ur(e,r,3)}}function Br(t,e,n,r,o){t!==e&&_r(e,(function(a,s){if(o||(o=new $n),rs(a))!function(t,e,n,r,o,a,s){var u=Co(t,n),l=Co(e,n),c=s.get(l);if(c)return void nr(t,n,c);var f=a?a(u,l,n+"",t,e,s):i,h=f===i;if(h){var d=Ha(l),p=!d&&$a(l),v=!d&&!p&&hs(l);f=l,d||p||v?Ha(u)?f=u:qa(u)?f=Ei(u):p?(h=!1,f=Si(l,!0)):v?(h=!1,f=Fi(l,!0)):f=[]:ss(l)||Ya(l)?(f=u,Ya(u)?f=_s(u):rs(u)&&!ts(u)||(f=xo(l))):h=!1}h&&(s.set(l,f),o(f,l,r,a,s),s.delete(l));nr(t,n,f)}(t,e,s,n,Br,r,o);else{var u=r?r(Co(t,s),a,s+"",t,e,o):i;u===i&&(u=a),nr(t,s,u)}}),Rs)}function Vr(t,e){var n=t.length;if(n)return bo(e+=e<0?n:0,n)?t[e]:i}function Yr(t,e,n){e=e.length?Ie(e,(function(t){return Ha(t)?function(e){return Sr(e,1===t.length?t[0]:t)}:t})):[au];var r=-1;e=Ie(e,$e(co()));var i=Jr(t,(function(t,n,i){var o=Ie(e,(function(e){return e(t)}));return{criteria:o,index:++r,value:t}}));return function(t,e){var n=t.length;for(t.sort(e);n--;)t[n]=t[n].value;return t}(i,(function(t,e){return function(t,e,n){var r=-1,i=t.criteria,o=e.criteria,a=i.length,s=n.length;for(;++r<a;){var u=Pi(i[r],o[r]);if(u)return r>=s?u:u*("desc"==n[r]?-1:1)}return t.index-e.index}(t,e,n)}))}function Hr(t,e,n){for(var r=-1,i=e.length,o={};++r<i;){var a=e[r],s=Sr(t,a);n(s,a)&&ei(o,bi(a,t),s)}return o}function Wr(t,e,n,r){var i=r?Qe:Je,o=-1,a=e.length,s=t;for(t===e&&(e=Ei(e)),n&&(s=Ie(t,$e(n)));++o<a;)for(var u=0,l=e[o],c=n?n(l):l;(u=i(s,c,u,r))>-1;)s!==t&&qt.call(s,u,1),qt.call(t,u,1);return t}function Gr(t,e){for(var n=t?e.length:0,r=n-1;n--;){var i=e[n];if(n==r||i!==o){var o=i;bo(i)?qt.call(t,i,1):di(t,i)}}return t}function qr(t,e){return t+ge(wn()*(e-t+1))}function $r(t,e){var n="";if(!t||e<1||e>p)return n;do{e%2&&(n+=t),(e=ge(e/2))&&(t+=t)}while(e);return n}function Kr(t,e){return Ro(Lo(t,e,au),t+"")}function Zr(t){return Zn(ks(t))}function ti(t,e){var n=ks(t);return Do(n,lr(e,0,n.length))}function ei(t,e,n,r){if(!rs(t))return t;for(var o=-1,a=(e=bi(e,t)).length,s=a-1,u=t;null!=u&&++o<a;){var l=jo(e[o]),c=n;if("__proto__"===l||"constructor"===l||"prototype"===l)return t;if(o!=s){var f=u[l];(c=r?r(f,l,u):i)===i&&(c=rs(f)?f:bo(e[o+1])?[]:{})}rr(u,l,c),u=u[l]}return t}var ni=Cn?function(t,e){return Cn.set(t,e),t}:au,ri=ue?function(t,e){return ue(t,"toString",{configurable:!0,enumerable:!1,value:ru(e),writable:!0})}:au;function ii(t){return Do(ks(t))}function oi(t,e,n){var i=-1,o=t.length;e<0&&(e=-e>o?0:o+e),(n=n>o?o:n)<0&&(n+=o),o=e>n?0:n-e>>>0,e>>>=0;for(var a=r(o);++i<o;)a[i]=t[i+e];return a}function ai(t,e){var n;return pr(t,(function(t,r,i){return!(n=e(t,r,i))})),!!n}function si(t,e,n){var r=0,i=null==t?r:t.length;if("number"==typeof e&&e==e&&i<=2147483647){for(;r<i;){var o=r+i>>>1,a=t[o];null!==a&&!fs(a)&&(n?a<=e:a<e)?r=o+1:i=o}return i}return ui(t,e,au,n)}function ui(t,e,n,r){var o=0,a=null==t?0:t.length;if(0===a)return 0;for(var s=(e=n(e))!=e,u=null===e,l=fs(e),c=e===i;o<a;){var f=ge((o+a)/2),h=n(t[f]),d=h!==i,p=null===h,v=h==h,m=fs(h);if(s)var g=r||v;else g=c?v&&(r||d):u?v&&d&&(r||!p):l?v&&d&&!p&&(r||!m):!p&&!m&&(r?h<=e:h<e);g?o=f+1:a=f}return bn(a,4294967294)}function li(t,e){for(var n=-1,r=t.length,i=0,o=[];++n<r;){var a=t[n],s=e?e(a):a;if(!n||!ka(s,u)){var u=s;o[i++]=0===a?0:a}}return o}function ci(t){return"number"==typeof t?t:fs(t)?v:+t}function fi(t){if("string"==typeof t)return t;if(Ha(t))return Ie(t,fi)+"";if(fs(t))return Jn?Jn.call(t):"";var e=t+"";return"0"==e&&1/t==-1/0?"-0":e}function hi(t,e,n){var r=-1,i=Ee,o=t.length,a=!0,s=[],u=s;if(n)a=!1,i=Ce;else if(o>=200){var l=e?null:$i(t);if(l)return fn(l);a=!1,i=Ze,u=new qn}else u=e?[]:s;t:for(;++r<o;){var c=t[r],f=e?e(c):c;if(c=n||0!==c?c:0,a&&f==f){for(var h=u.length;h--;)if(u[h]===f)continue t;e&&u.push(f),s.push(c)}else i(u,f,n)||(u!==s&&u.push(f),s.push(c))}return s}function di(t,e){return null==(t=Oo(t,e=bi(e,t)))||delete t[jo(Zo(e))]}function pi(t,e,n,r){return ei(t,e,n(Sr(t,e)),r)}function vi(t,e,n,r){for(var i=t.length,o=r?i:-1;(r?o--:++o<i)&&e(t[o],o,t););return n?oi(t,r?0:o,r?o+1:i):oi(t,r?o+1:0,r?i:o)}function mi(t,e){var n=t;return n instanceof Yn&&(n=n.value()),Re(e,(function(t,e){return e.func.apply(e.thisArg,Ue([t],e.args))}),n)}function gi(t,e,n){var i=t.length;if(i<2)return i?hi(t[0]):[];for(var o=-1,a=r(i);++o<i;)for(var s=t[o],u=-1;++u<i;)u!=o&&(a[o]=dr(a[o]||s,t[u],e,n));return hi(xr(a,1),e,n)}function yi(t,e,n){for(var r=-1,o=t.length,a=e.length,s={};++r<o;){var u=r<a?e[r]:i;n(s,t[r],u)}return s}function xi(t){return qa(t)?t:[]}function _i(t){return"function"==typeof t?t:au}function bi(t,e){return Ha(t)?t:To(t,e)?[t]:Xo(bs(t))}var Ai=Kr;function Ti(t,e,n){var r=t.length;return n=n===i?r:n,!e&&n>=r?t:oi(t,e,n)}var wi=fe||function(t){return de.clearTimeout(t)};function Si(t,e){if(e)return t.slice();var n=t.length,r=Yt?Yt(n):new t.constructor(n);return t.copy(r),r}function Ni(t){var e=new t.constructor(t.byteLength);return new Vt(e).set(new Vt(t)),e}function Fi(t,e){var n=e?Ni(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}function Pi(t,e){if(t!==e){var n=t!==i,r=null===t,o=t==t,a=fs(t),s=e!==i,u=null===e,l=e==e,c=fs(e);if(!u&&!c&&!a&&t>e||a&&s&&l&&!u&&!c||r&&s&&l||!n&&l||!o)return 1;if(!r&&!a&&!c&&t<e||c&&n&&o&&!r&&!a||u&&n&&o||!s&&o||!l)return-1}return 0}function Li(t,e,n,i){for(var o=-1,a=t.length,s=n.length,u=-1,l=e.length,c=_n(a-s,0),f=r(l+c),h=!i;++u<l;)f[u]=e[u];for(;++o<s;)(h||o<a)&&(f[n[o]]=t[o]);for(;c--;)f[u++]=t[o++];return f}function Oi(t,e,n,i){for(var o=-1,a=t.length,s=-1,u=n.length,l=-1,c=e.length,f=_n(a-u,0),h=r(f+c),d=!i;++o<f;)h[o]=t[o];for(var p=o;++l<c;)h[p+l]=e[l];for(;++s<u;)(d||o<a)&&(h[p+n[s]]=t[o++]);return h}function Ei(t,e){var n=-1,i=t.length;for(e||(e=r(i));++n<i;)e[n]=t[n];return e}function Ci(t,e,n,r){var o=!n;n||(n={});for(var a=-1,s=e.length;++a<s;){var u=e[a],l=r?r(n[u],t[u],u,n,t):i;l===i&&(l=t[u]),o?sr(n,u,l):rr(n,u,l)}return n}function Ii(t,e){return function(n,r){var i=Ha(n)?Ne:or,o=e?e():{};return i(n,t,co(r,2),o)}}function Ui(t){return Kr((function(e,n){var r=-1,o=n.length,a=o>1?n[o-1]:i,s=o>2?n[2]:i;for(a=t.length>3&&"function"==typeof a?(o--,a):i,s&&Ao(n[0],n[1],s)&&(a=o<3?i:a,o=1),e=Ft(e);++r<o;){var u=n[r];u&&t(e,u,r,a)}return e}))}function Ri(t,e){return function(n,r){if(null==n)return n;if(!Ga(n))return t(n,r);for(var i=n.length,o=e?i:-1,a=Ft(n);(e?o--:++o<i)&&!1!==r(a[o],o,a););return n}}function Mi(t){return function(e,n,r){for(var i=-1,o=Ft(e),a=r(e),s=a.length;s--;){var u=a[t?s:++i];if(!1===n(o[u],u,o))break}return e}}function zi(t){return function(e){var n=sn(e=bs(e))?pn(e):i,r=n?n[0]:e.charAt(0),o=n?Ti(n,1).join(""):e.slice(1);return r[t]()+o}}function Di(t){return function(e){return Re(tu(Ys(e).replace(Kt,"")),t,"")}}function Xi(t){return function(){var e=arguments;switch(e.length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3]);case 5:return new t(e[0],e[1],e[2],e[3],e[4]);case 6:return new t(e[0],e[1],e[2],e[3],e[4],e[5]);case 7:return new t(e[0],e[1],e[2],e[3],e[4],e[5],e[6])}var n=kn(t.prototype),r=t.apply(n,e);return rs(r)?r:n}}function ji(t){return function(e,n,r){var o=Ft(e);if(!Ga(e)){var a=co(n,3);e=Us(e),n=function(t){return a(o[t],t,o)}}var s=t(e,n,r);return s>-1?o[a?e[s]:s]:i}}function Ji(t){return io((function(e){var n=e.length,r=n,a=Vn.prototype.thru;for(t&&e.reverse();r--;){var s=e[r];if("function"!=typeof s)throw new Ot(o);if(a&&!u&&"wrapper"==uo(s))var u=new Vn([],!0)}for(r=u?r:n;++r<n;){var l=uo(s=e[r]),c="wrapper"==l?so(s):i;u=c&&wo(c[0])&&424==c[1]&&!c[4].length&&1==c[9]?u[uo(c[0])].apply(u,c[3]):1==s.length&&wo(s)?u[l]():u.thru(s)}return function(){var t=arguments,r=t[0];if(u&&1==t.length&&Ha(r))return u.plant(r).value();for(var i=0,o=n?e[i].apply(this,t):r;++i<n;)o=e[i].call(this,o);return o}}))}function Qi(t,e,n,o,a,s,u,l,c,h){var d=e&f,p=1&e,v=2&e,m=24&e,g=512&e,y=v?i:Xi(t);return function i(){for(var f=arguments.length,x=r(f),_=f;_--;)x[_]=arguments[_];if(m)var b=lo(i),A=nn(x,b);if(o&&(x=Li(x,o,a,m)),s&&(x=Oi(x,s,u,m)),f-=A,m&&f<h){var T=cn(x,b);return Gi(t,e,Qi,i.placeholder,n,x,T,l,c,h-f)}var w=p?n:this,S=v?w[t]:t;return f=x.length,l?x=Eo(x,l):g&&f>1&&x.reverse(),d&&c<f&&(x.length=c),this&&this!==de&&this instanceof i&&(S=y||Xi(S)),S.apply(w,x)}}function ki(t,e){return function(n,r){return function(t,e,n,r){return Ar(t,(function(t,i,o){e(r,n(t),i,o)})),r}(n,t,e(r),{})}}function Bi(t,e){return function(n,r){var o;if(n===i&&r===i)return e;if(n!==i&&(o=n),r!==i){if(o===i)return r;"string"==typeof n||"string"==typeof r?(n=fi(n),r=fi(r)):(n=ci(n),r=ci(r)),o=t(n,r)}return o}}function Vi(t){return io((function(e){return e=Ie(e,$e(co())),Kr((function(n){var r=this;return t(e,(function(t){return Se(t,r,n)}))}))}))}function Yi(t,e){var n=(e=e===i?" ":fi(e)).length;if(n<2)return n?$r(e,t):e;var r=$r(e,ve(t/dn(e)));return sn(e)?Ti(pn(r),0,t).join(""):r.slice(0,t)}function Hi(t){return function(e,n,o){return o&&"number"!=typeof o&&Ao(e,n,o)&&(n=o=i),e=ms(e),n===i?(n=e,e=0):n=ms(n),function(t,e,n,i){for(var o=-1,a=_n(ve((e-t)/(n||1)),0),s=r(a);a--;)s[i?a:++o]=t,t+=n;return s}(e,n,o=o===i?e<n?1:-1:ms(o),t)}}function Wi(t){return function(e,n){return"string"==typeof e&&"string"==typeof n||(e=xs(e),n=xs(n)),t(e,n)}}function Gi(t,e,n,r,o,a,s,u,f,h){var d=8&e;e|=d?l:c,4&(e&=~(d?c:l))||(e&=-4);var p=[t,e,o,d?a:i,d?s:i,d?i:a,d?i:s,u,f,h],v=n.apply(i,p);return wo(t)&&Io(v,p),v.placeholder=r,Mo(v,t,e)}function qi(t){var e=Nt[t];return function(t,n){if(t=xs(t),(n=null==n?0:bn(gs(n),292))&&Ye(t)){var r=(bs(t)+"e").split("e");return+((r=(bs(e(r[0]+"e"+(+r[1]+n)))+"e").split("e"))[0]+"e"+(+r[1]-n))}return e(t)}}var $i=Ln&&1/fn(new Ln([,-0]))[1]==d?function(t){return new Ln(t)}:fu;function Ki(t){return function(e){var n=go(e);return n==S?un(e):n==O?hn(e):function(t,e){return Ie(e,(function(e){return[e,t[e]]}))}(e,t(e))}}function Zi(t,e,n,a,d,p,v,m){var g=2&e;if(!g&&"function"!=typeof t)throw new Ot(o);var y=a?a.length:0;if(y||(e&=-97,a=d=i),v=v===i?v:_n(gs(v),0),m=m===i?m:gs(m),y-=d?d.length:0,e&c){var x=a,_=d;a=d=i}var b=g?i:so(t),A=[t,e,n,a,d,x,_,p,v,m];if(b&&function(t,e){var n=t[1],r=e[1],i=n|r,o=i<131,a=r==f&&8==n||r==f&&n==h&&t[7].length<=e[8]||384==r&&e[7].length<=e[8]&&8==n;if(!o&&!a)return t;1&r&&(t[2]=e[2],i|=1&n?0:4);var u=e[3];if(u){var l=t[3];t[3]=l?Li(l,u,e[4]):u,t[4]=l?cn(t[3],s):e[4]}(u=e[5])&&(l=t[5],t[5]=l?Oi(l,u,e[6]):u,t[6]=l?cn(t[5],s):e[6]);(u=e[7])&&(t[7]=u);r&f&&(t[8]=null==t[8]?e[8]:bn(t[8],e[8]));null==t[9]&&(t[9]=e[9]);t[0]=e[0],t[1]=i}(A,b),t=A[0],e=A[1],n=A[2],a=A[3],d=A[4],!(m=A[9]=A[9]===i?g?0:t.length:_n(A[9]-y,0))&&24&e&&(e&=-25),e&&1!=e)T=8==e||e==u?function(t,e,n){var o=Xi(t);return function a(){for(var s=arguments.length,u=r(s),l=s,c=lo(a);l--;)u[l]=arguments[l];var f=s<3&&u[0]!==c&&u[s-1]!==c?[]:cn(u,c);return(s-=f.length)<n?Gi(t,e,Qi,a.placeholder,i,u,f,i,i,n-s):Se(this&&this!==de&&this instanceof a?o:t,this,u)}}(t,e,m):e!=l&&33!=e||d.length?Qi.apply(i,A):function(t,e,n,i){var o=1&e,a=Xi(t);return function e(){for(var s=-1,u=arguments.length,l=-1,c=i.length,f=r(c+u),h=this&&this!==de&&this instanceof e?a:t;++l<c;)f[l]=i[l];for(;u--;)f[l++]=arguments[++s];return Se(h,o?n:this,f)}}(t,e,n,a);else var T=function(t,e,n){var r=1&e,i=Xi(t);return function e(){return(this&&this!==de&&this instanceof e?i:t).apply(r?n:this,arguments)}}(t,e,n);return Mo((b?ni:Io)(T,A),t,e)}function to(t,e,n,r){return t===i||ka(t,It[n])&&!Mt.call(r,n)?e:t}function eo(t,e,n,r,o,a){return rs(t)&&rs(e)&&(a.set(e,t),Br(t,e,i,eo,a),a.delete(e)),t}function no(t){return ss(t)?i:t}function ro(t,e,n,r,o,a){var s=1&n,u=t.length,l=e.length;if(u!=l&&!(s&&l>u))return!1;var c=a.get(t),f=a.get(e);if(c&&f)return c==e&&f==t;var h=-1,d=!0,p=2&n?new qn:i;for(a.set(t,e),a.set(e,t);++h<u;){var v=t[h],m=e[h];if(r)var g=s?r(m,v,h,e,t,a):r(v,m,h,t,e,a);if(g!==i){if(g)continue;d=!1;break}if(p){if(!ze(e,(function(t,e){if(!Ze(p,e)&&(v===t||o(v,t,n,r,a)))return p.push(e)}))){d=!1;break}}else if(v!==m&&!o(v,m,n,r,a)){d=!1;break}}return a.delete(t),a.delete(e),d}function io(t){return Ro(Lo(t,i,Wo),t+"")}function oo(t){return Nr(t,Us,vo)}function ao(t){return Nr(t,Rs,mo)}var so=Cn?function(t){return Cn.get(t)}:fu;function uo(t){for(var e=t.name+"",n=In[e],r=Mt.call(In,e)?n.length:0;r--;){var i=n[r],o=i.func;if(null==o||o==t)return i.name}return e}function lo(t){return(Mt.call(Qn,"placeholder")?Qn:t).placeholder}function co(){var t=Qn.iteratee||su;return t=t===su?zr:t,arguments.length?t(arguments[0],arguments[1]):t}function fo(t,e){var n,r,i=t.__data__;return("string"==(r=typeof(n=e))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==n:null===n)?i["string"==typeof e?"string":"hash"]:i.map}function ho(t){for(var e=Us(t),n=e.length;n--;){var r=e[n],i=t[r];e[n]=[r,i,Fo(i)]}return e}function po(t,e){var n=function(t,e){return null==t?i:t[e]}(t,e);return Mr(n)?n:i}var vo=ye?function(t){return null==t?[]:(t=Ft(t),Oe(ye(t),(function(e){return Gt.call(t,e)})))}:yu,mo=ye?function(t){for(var e=[];t;)Ue(e,vo(t)),t=Ht(t);return e}:yu,go=Fr;function yo(t,e,n){for(var r=-1,i=(e=bi(e,t)).length,o=!1;++r<i;){var a=jo(e[r]);if(!(o=null!=t&&n(t,a)))break;t=t[a]}return o||++r!=i?o:!!(i=null==t?0:t.length)&&ns(i)&&bo(a,i)&&(Ha(t)||Ya(t))}function xo(t){return"function"!=typeof t.constructor||No(t)?{}:kn(Ht(t))}function _o(t){return Ha(t)||Ya(t)||!!($t&&t&&t[$t])}function bo(t,e){var n=typeof t;return!!(e=null==e?p:e)&&("number"==n||"symbol"!=n&&_t.test(t))&&t>-1&&t%1==0&&t<e}function Ao(t,e,n){if(!rs(n))return!1;var r=typeof e;return!!("number"==r?Ga(n)&&bo(e,n.length):"string"==r&&e in n)&&ka(n[e],t)}function To(t,e){if(Ha(t))return!1;var n=typeof t;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=t&&!fs(t))||(nt.test(t)||!et.test(t)||null!=e&&t in Ft(e))}function wo(t){var e=uo(t),n=Qn[e];if("function"!=typeof n||!(e in Yn.prototype))return!1;if(t===n)return!0;var r=so(n);return!!r&&t===r[0]}(Nn&&go(new Nn(new ArrayBuffer(1)))!=R||Fn&&go(new Fn)!=S||Pn&&go(Pn.resolve())!=P||Ln&&go(new Ln)!=O||On&&go(new On)!=I)&&(go=function(t){var e=Fr(t),n=e==F?t.constructor:i,r=n?Jo(n):"";if(r)switch(r){case Un:return R;case Rn:return S;case Mn:return P;case zn:return O;case Dn:return I}return e});var So=Ut?ts:xu;function No(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||It)}function Fo(t){return t==t&&!rs(t)}function Po(t,e){return function(n){return null!=n&&(n[t]===e&&(e!==i||t in Ft(n)))}}function Lo(t,e,n){return e=_n(e===i?t.length-1:e,0),function(){for(var i=arguments,o=-1,a=_n(i.length-e,0),s=r(a);++o<a;)s[o]=i[e+o];o=-1;for(var u=r(e+1);++o<e;)u[o]=i[o];return u[e]=n(s),Se(t,this,u)}}function Oo(t,e){return e.length<2?t:Sr(t,oi(e,0,-1))}function Eo(t,e){for(var n=t.length,r=bn(e.length,n),o=Ei(t);r--;){var a=e[r];t[r]=bo(a,n)?o[a]:i}return t}function Co(t,e){if(("constructor"!==e||"function"!=typeof t[e])&&"__proto__"!=e)return t[e]}var Io=zo(ni),Uo=pe||function(t,e){return de.setTimeout(t,e)},Ro=zo(ri);function Mo(t,e,n){var r=e+"";return Ro(t,function(t,e){var n=e.length;if(!n)return t;var r=n-1;return e[r]=(n>1?"& ":"")+e[r],e=e.join(n>2?", ":" "),t.replace(ut,"{\n/* [wrapped with "+e+"] */\n")}(r,function(t,e){return Fe(g,(function(n){var r="_."+n[0];e&n[1]&&!Ee(t,r)&&t.push(r)})),t.sort()}(function(t){var e=t.match(lt);return e?e[1].split(ct):[]}(r),n)))}function zo(t){var e=0,n=0;return function(){var r=An(),o=16-(r-n);if(n=r,o>0){if(++e>=800)return arguments[0]}else e=0;return t.apply(i,arguments)}}function Do(t,e){var n=-1,r=t.length,o=r-1;for(e=e===i?r:e;++n<e;){var a=qr(n,o),s=t[a];t[a]=t[n],t[n]=s}return t.length=e,t}var Xo=function(t){var e=za(t,(function(t){return 500===n.size&&n.clear(),t})),n=e.cache;return e}((function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(rt,(function(t,n,r,i){e.push(r?i.replace(dt,"$1"):n||t)})),e}));function jo(t){if("string"==typeof t||fs(t))return t;var e=t+"";return"0"==e&&1/t==-1/0?"-0":e}function Jo(t){if(null!=t){try{return Rt.call(t)}catch(t){}try{return t+""}catch(t){}}return""}function Qo(t){if(t instanceof Yn)return t.clone();var e=new Vn(t.__wrapped__,t.__chain__);return e.__actions__=Ei(t.__actions__),e.__index__=t.__index__,e.__values__=t.__values__,e}var ko=Kr((function(t,e){return qa(t)?dr(t,xr(e,1,qa,!0)):[]})),Bo=Kr((function(t,e){var n=Zo(e);return qa(n)&&(n=i),qa(t)?dr(t,xr(e,1,qa,!0),co(n,2)):[]})),Vo=Kr((function(t,e){var n=Zo(e);return qa(n)&&(n=i),qa(t)?dr(t,xr(e,1,qa,!0),i,n):[]}));function Yo(t,e,n){var r=null==t?0:t.length;if(!r)return-1;var i=null==n?0:gs(n);return i<0&&(i=_n(r+i,0)),je(t,co(e,3),i)}function Ho(t,e,n){var r=null==t?0:t.length;if(!r)return-1;var o=r-1;return n!==i&&(o=gs(n),o=n<0?_n(r+o,0):bn(o,r-1)),je(t,co(e,3),o,!0)}function Wo(t){return(null==t?0:t.length)?xr(t,1):[]}function Go(t){return t&&t.length?t[0]:i}var qo=Kr((function(t){var e=Ie(t,xi);return e.length&&e[0]===t[0]?Er(e):[]})),$o=Kr((function(t){var e=Zo(t),n=Ie(t,xi);return e===Zo(n)?e=i:n.pop(),n.length&&n[0]===t[0]?Er(n,co(e,2)):[]})),Ko=Kr((function(t){var e=Zo(t),n=Ie(t,xi);return(e="function"==typeof e?e:i)&&n.pop(),n.length&&n[0]===t[0]?Er(n,i,e):[]}));function Zo(t){var e=null==t?0:t.length;return e?t[e-1]:i}var ta=Kr(ea);function ea(t,e){return t&&t.length&&e&&e.length?Wr(t,e):t}var na=io((function(t,e){var n=null==t?0:t.length,r=ur(t,e);return Gr(t,Ie(e,(function(t){return bo(t,n)?+t:t})).sort(Pi)),r}));function ra(t){return null==t?t:Sn.call(t)}var ia=Kr((function(t){return hi(xr(t,1,qa,!0))})),oa=Kr((function(t){var e=Zo(t);return qa(e)&&(e=i),hi(xr(t,1,qa,!0),co(e,2))})),aa=Kr((function(t){var e=Zo(t);return e="function"==typeof e?e:i,hi(xr(t,1,qa,!0),i,e)}));function sa(t){if(!t||!t.length)return[];var e=0;return t=Oe(t,(function(t){if(qa(t))return e=_n(t.length,e),!0})),Ge(e,(function(e){return Ie(t,Ve(e))}))}function ua(t,e){if(!t||!t.length)return[];var n=sa(t);return null==e?n:Ie(n,(function(t){return Se(e,i,t)}))}var la=Kr((function(t,e){return qa(t)?dr(t,e):[]})),ca=Kr((function(t){return gi(Oe(t,qa))})),fa=Kr((function(t){var e=Zo(t);return qa(e)&&(e=i),gi(Oe(t,qa),co(e,2))})),ha=Kr((function(t){var e=Zo(t);return e="function"==typeof e?e:i,gi(Oe(t,qa),i,e)})),da=Kr(sa);var pa=Kr((function(t){var e=t.length,n=e>1?t[e-1]:i;return n="function"==typeof n?(t.pop(),n):i,ua(t,n)}));function va(t){var e=Qn(t);return e.__chain__=!0,e}function ma(t,e){return e(t)}var ga=io((function(t){var e=t.length,n=e?t[0]:0,r=this.__wrapped__,o=function(e){return ur(e,t)};return!(e>1||this.__actions__.length)&&r instanceof Yn&&bo(n)?((r=r.slice(n,+n+(e?1:0))).__actions__.push({func:ma,args:[o],thisArg:i}),new Vn(r,this.__chain__).thru((function(t){return e&&!t.length&&t.push(i),t}))):this.thru(o)}));var ya=Ii((function(t,e,n){Mt.call(t,n)?++t[n]:sr(t,n,1)}));var xa=ji(Yo),_a=ji(Ho);function ba(t,e){return(Ha(t)?Fe:pr)(t,co(e,3))}function Aa(t,e){return(Ha(t)?Pe:vr)(t,co(e,3))}var Ta=Ii((function(t,e,n){Mt.call(t,n)?t[n].push(e):sr(t,n,[e])}));var wa=Kr((function(t,e,n){var i=-1,o="function"==typeof e,a=Ga(t)?r(t.length):[];return pr(t,(function(t){a[++i]=o?Se(e,t,n):Cr(t,e,n)})),a})),Sa=Ii((function(t,e,n){sr(t,n,e)}));function Na(t,e){return(Ha(t)?Ie:Jr)(t,co(e,3))}var Fa=Ii((function(t,e,n){t[n?0:1].push(e)}),(function(){return[[],[]]}));var Pa=Kr((function(t,e){if(null==t)return[];var n=e.length;return n>1&&Ao(t,e[0],e[1])?e=[]:n>2&&Ao(e[0],e[1],e[2])&&(e=[e[0]]),Yr(t,xr(e,1),[])})),La=he||function(){return de.Date.now()};function Oa(t,e,n){return e=n?i:e,e=t&&null==e?t.length:e,Zi(t,f,i,i,i,i,e)}function Ea(t,e){var n;if("function"!=typeof e)throw new Ot(o);return t=gs(t),function(){return--t>0&&(n=e.apply(this,arguments)),t<=1&&(e=i),n}}var Ca=Kr((function(t,e,n){var r=1;if(n.length){var i=cn(n,lo(Ca));r|=l}return Zi(t,r,e,n,i)})),Ia=Kr((function(t,e,n){var r=3;if(n.length){var i=cn(n,lo(Ia));r|=l}return Zi(e,r,t,n,i)}));function Ua(t,e,n){var r,a,s,u,l,c,f=0,h=!1,d=!1,p=!0;if("function"!=typeof t)throw new Ot(o);function v(e){var n=r,o=a;return r=a=i,f=e,u=t.apply(o,n)}function m(t){return f=t,l=Uo(y,e),h?v(t):u}function g(t){var n=t-c;return c===i||n>=e||n<0||d&&t-f>=s}function y(){var t=La();if(g(t))return x(t);l=Uo(y,function(t){var n=e-(t-c);return d?bn(n,s-(t-f)):n}(t))}function x(t){return l=i,p&&r?v(t):(r=a=i,u)}function _(){var t=La(),n=g(t);if(r=arguments,a=this,c=t,n){if(l===i)return m(c);if(d)return wi(l),l=Uo(y,e),v(c)}return l===i&&(l=Uo(y,e)),u}return e=xs(e)||0,rs(n)&&(h=!!n.leading,s=(d="maxWait"in n)?_n(xs(n.maxWait)||0,e):s,p="trailing"in n?!!n.trailing:p),_.cancel=function(){l!==i&&wi(l),f=0,r=c=a=l=i},_.flush=function(){return l===i?u:x(La())},_}var Ra=Kr((function(t,e){return hr(t,1,e)})),Ma=Kr((function(t,e,n){return hr(t,xs(e)||0,n)}));function za(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new Ot(o);var n=function(){var r=arguments,i=e?e.apply(this,r):r[0],o=n.cache;if(o.has(i))return o.get(i);var a=t.apply(this,r);return n.cache=o.set(i,a)||o,a};return n.cache=new(za.Cache||Gn),n}function Da(t){if("function"!=typeof t)throw new Ot(o);return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}za.Cache=Gn;var Xa=Ai((function(t,e){var n=(e=1==e.length&&Ha(e[0])?Ie(e[0],$e(co())):Ie(xr(e,1),$e(co()))).length;return Kr((function(r){for(var i=-1,o=bn(r.length,n);++i<o;)r[i]=e[i].call(this,r[i]);return Se(t,this,r)}))})),ja=Kr((function(t,e){var n=cn(e,lo(ja));return Zi(t,l,i,e,n)})),Ja=Kr((function(t,e){var n=cn(e,lo(Ja));return Zi(t,c,i,e,n)})),Qa=io((function(t,e){return Zi(t,h,i,i,i,e)}));function ka(t,e){return t===e||t!=t&&e!=e}var Ba=Wi(Pr),Va=Wi((function(t,e){return t>=e})),Ya=Ir(function(){return arguments}())?Ir:function(t){return is(t)&&Mt.call(t,"callee")&&!Gt.call(t,"callee")},Ha=r.isArray,Wa=xe?$e(xe):function(t){return is(t)&&Fr(t)==U};function Ga(t){return null!=t&&ns(t.length)&&!ts(t)}function qa(t){return is(t)&&Ga(t)}var $a=De||xu,Ka=_e?$e(_e):function(t){return is(t)&&Fr(t)==b};function Za(t){if(!is(t))return!1;var e=Fr(t);return e==A||"[object DOMException]"==e||"string"==typeof t.message&&"string"==typeof t.name&&!ss(t)}function ts(t){if(!rs(t))return!1;var e=Fr(t);return e==T||e==w||"[object AsyncFunction]"==e||"[object Proxy]"==e}function es(t){return"number"==typeof t&&t==gs(t)}function ns(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=p}function rs(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}function is(t){return null!=t&&"object"==typeof t}var os=be?$e(be):function(t){return is(t)&&go(t)==S};function as(t){return"number"==typeof t||is(t)&&Fr(t)==N}function ss(t){if(!is(t)||Fr(t)!=F)return!1;var e=Ht(t);if(null===e)return!0;var n=Mt.call(e,"constructor")&&e.constructor;return"function"==typeof n&&n instanceof n&&Rt.call(n)==jt}var us=Ae?$e(Ae):function(t){return is(t)&&Fr(t)==L};var ls=Te?$e(Te):function(t){return is(t)&&go(t)==O};function cs(t){return"string"==typeof t||!Ha(t)&&is(t)&&Fr(t)==E}function fs(t){return"symbol"==typeof t||is(t)&&Fr(t)==C}var hs=we?$e(we):function(t){return is(t)&&ns(t.length)&&!!ae[Fr(t)]};var ds=Wi(jr),ps=Wi((function(t,e){return t<=e}));function vs(t){if(!t)return[];if(Ga(t))return cs(t)?pn(t):Ei(t);if(te&&t[te])return function(t){for(var e,n=[];!(e=t.next()).done;)n.push(e.value);return n}(t[te]());var e=go(t);return(e==S?un:e==O?fn:ks)(t)}function ms(t){return t?(t=xs(t))===d||t===-1/0?17976931348623157e292*(t<0?-1:1):t==t?t:0:0===t?t:0}function gs(t){var e=ms(t),n=e%1;return e==e?n?e-n:e:0}function ys(t){return t?lr(gs(t),0,m):0}function xs(t){if("number"==typeof t)return t;if(fs(t))return v;if(rs(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=rs(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=qe(t);var n=gt.test(t);return n||xt.test(t)?ce(t.slice(2),n?2:8):mt.test(t)?v:+t}function _s(t){return Ci(t,Rs(t))}function bs(t){return null==t?"":fi(t)}var As=Ui((function(t,e){if(No(e)||Ga(e))Ci(e,Us(e),t);else for(var n in e)Mt.call(e,n)&&rr(t,n,e[n])})),Ts=Ui((function(t,e){Ci(e,Rs(e),t)})),ws=Ui((function(t,e,n,r){Ci(e,Rs(e),t,r)})),Ss=Ui((function(t,e,n,r){Ci(e,Us(e),t,r)})),Ns=io(ur);var Fs=Kr((function(t,e){t=Ft(t);var n=-1,r=e.length,o=r>2?e[2]:i;for(o&&Ao(e[0],e[1],o)&&(r=1);++n<r;)for(var a=e[n],s=Rs(a),u=-1,l=s.length;++u<l;){var c=s[u],f=t[c];(f===i||ka(f,It[c])&&!Mt.call(t,c))&&(t[c]=a[c])}return t})),Ps=Kr((function(t){return t.push(i,eo),Se(zs,i,t)}));function Ls(t,e,n){var r=null==t?i:Sr(t,e);return r===i?n:r}function Os(t,e){return null!=t&&yo(t,e,Or)}var Es=ki((function(t,e,n){null!=e&&"function"!=typeof e.toString&&(e=Xt.call(e)),t[e]=n}),ru(au)),Cs=ki((function(t,e,n){null!=e&&"function"!=typeof e.toString&&(e=Xt.call(e)),Mt.call(t,e)?t[e].push(n):t[e]=[n]}),co),Is=Kr(Cr);function Us(t){return Ga(t)?Kn(t):Dr(t)}function Rs(t){return Ga(t)?Kn(t,!0):Xr(t)}var Ms=Ui((function(t,e,n){Br(t,e,n)})),zs=Ui((function(t,e,n,r){Br(t,e,n,r)})),Ds=io((function(t,e){var n={};if(null==t)return n;var r=!1;e=Ie(e,(function(e){return e=bi(e,t),r||(r=e.length>1),e})),Ci(t,ao(t),n),r&&(n=cr(n,7,no));for(var i=e.length;i--;)di(n,e[i]);return n}));var Xs=io((function(t,e){return null==t?{}:function(t,e){return Hr(t,e,(function(e,n){return Os(t,n)}))}(t,e)}));function js(t,e){if(null==t)return{};var n=Ie(ao(t),(function(t){return[t]}));return e=co(e),Hr(t,n,(function(t,n){return e(t,n[0])}))}var Js=Ki(Us),Qs=Ki(Rs);function ks(t){return null==t?[]:Ke(t,Us(t))}var Bs=Di((function(t,e,n){return e=e.toLowerCase(),t+(n?Vs(e):e)}));function Vs(t){return Zs(bs(t).toLowerCase())}function Ys(t){return(t=bs(t))&&t.replace(bt,rn).replace(Zt,"")}var Hs=Di((function(t,e,n){return t+(n?"-":"")+e.toLowerCase()})),Ws=Di((function(t,e,n){return t+(n?" ":"")+e.toLowerCase()})),Gs=zi("toLowerCase");var qs=Di((function(t,e,n){return t+(n?"_":"")+e.toLowerCase()}));var $s=Di((function(t,e,n){return t+(n?" ":"")+Zs(e)}));var Ks=Di((function(t,e,n){return t+(n?" ":"")+e.toUpperCase()})),Zs=zi("toUpperCase");function tu(t,e,n){return t=bs(t),(e=n?i:e)===i?function(t){return re.test(t)}(t)?function(t){return t.match(ee)||[]}(t):function(t){return t.match(ft)||[]}(t):t.match(e)||[]}var eu=Kr((function(t,e){try{return Se(t,i,e)}catch(t){return Za(t)?t:new wt(t)}})),nu=io((function(t,e){return Fe(e,(function(e){e=jo(e),sr(t,e,Ca(t[e],t))})),t}));function ru(t){return function(){return t}}var iu=Ji(),ou=Ji(!0);function au(t){return t}function su(t){return zr("function"==typeof t?t:cr(t,1))}var uu=Kr((function(t,e){return function(n){return Cr(n,t,e)}})),lu=Kr((function(t,e){return function(n){return Cr(t,n,e)}}));function cu(t,e,n){var r=Us(e),i=wr(e,r);null!=n||rs(e)&&(i.length||!r.length)||(n=e,e=t,t=this,i=wr(e,Us(e)));var o=!(rs(n)&&"chain"in n&&!n.chain),a=ts(t);return Fe(i,(function(n){var r=e[n];t[n]=r,a&&(t.prototype[n]=function(){var e=this.__chain__;if(o||e){var n=t(this.__wrapped__),i=n.__actions__=Ei(this.__actions__);return i.push({func:r,args:arguments,thisArg:t}),n.__chain__=e,n}return r.apply(t,Ue([this.value()],arguments))})})),t}function fu(){}var hu=Vi(Ie),du=Vi(Le),pu=Vi(ze);function vu(t){return To(t)?Ve(jo(t)):function(t){return function(e){return Sr(e,t)}}(t)}var mu=Hi(),gu=Hi(!0);function yu(){return[]}function xu(){return!1}var _u=Bi((function(t,e){return t+e}),0),bu=qi("ceil"),Au=Bi((function(t,e){return t/e}),1),Tu=qi("floor");var wu,Su=Bi((function(t,e){return t*e}),1),Nu=qi("round"),Fu=Bi((function(t,e){return t-e}),0);return Qn.after=function(t,e){if("function"!=typeof e)throw new Ot(o);return t=gs(t),function(){if(--t<1)return e.apply(this,arguments)}},Qn.ary=Oa,Qn.assign=As,Qn.assignIn=Ts,Qn.assignInWith=ws,Qn.assignWith=Ss,Qn.at=Ns,Qn.before=Ea,Qn.bind=Ca,Qn.bindAll=nu,Qn.bindKey=Ia,Qn.castArray=function(){if(!arguments.length)return[];var t=arguments[0];return Ha(t)?t:[t]},Qn.chain=va,Qn.chunk=function(t,e,n){e=(n?Ao(t,e,n):e===i)?1:_n(gs(e),0);var o=null==t?0:t.length;if(!o||e<1)return[];for(var a=0,s=0,u=r(ve(o/e));a<o;)u[s++]=oi(t,a,a+=e);return u},Qn.compact=function(t){for(var e=-1,n=null==t?0:t.length,r=0,i=[];++e<n;){var o=t[e];o&&(i[r++]=o)}return i},Qn.concat=function(){var t=arguments.length;if(!t)return[];for(var e=r(t-1),n=arguments[0],i=t;i--;)e[i-1]=arguments[i];return Ue(Ha(n)?Ei(n):[n],xr(e,1))},Qn.cond=function(t){var e=null==t?0:t.length,n=co();return t=e?Ie(t,(function(t){if("function"!=typeof t[1])throw new Ot(o);return[n(t[0]),t[1]]})):[],Kr((function(n){for(var r=-1;++r<e;){var i=t[r];if(Se(i[0],this,n))return Se(i[1],this,n)}}))},Qn.conforms=function(t){return function(t){var e=Us(t);return function(n){return fr(n,t,e)}}(cr(t,1))},Qn.constant=ru,Qn.countBy=ya,Qn.create=function(t,e){var n=kn(t);return null==e?n:ar(n,e)},Qn.curry=function t(e,n,r){var o=Zi(e,8,i,i,i,i,i,n=r?i:n);return o.placeholder=t.placeholder,o},Qn.curryRight=function t(e,n,r){var o=Zi(e,u,i,i,i,i,i,n=r?i:n);return o.placeholder=t.placeholder,o},Qn.debounce=Ua,Qn.defaults=Fs,Qn.defaultsDeep=Ps,Qn.defer=Ra,Qn.delay=Ma,Qn.difference=ko,Qn.differenceBy=Bo,Qn.differenceWith=Vo,Qn.drop=function(t,e,n){var r=null==t?0:t.length;return r?oi(t,(e=n||e===i?1:gs(e))<0?0:e,r):[]},Qn.dropRight=function(t,e,n){var r=null==t?0:t.length;return r?oi(t,0,(e=r-(e=n||e===i?1:gs(e)))<0?0:e):[]},Qn.dropRightWhile=function(t,e){return t&&t.length?vi(t,co(e,3),!0,!0):[]},Qn.dropWhile=function(t,e){return t&&t.length?vi(t,co(e,3),!0):[]},Qn.fill=function(t,e,n,r){var o=null==t?0:t.length;return o?(n&&"number"!=typeof n&&Ao(t,e,n)&&(n=0,r=o),function(t,e,n,r){var o=t.length;for((n=gs(n))<0&&(n=-n>o?0:o+n),(r=r===i||r>o?o:gs(r))<0&&(r+=o),r=n>r?0:ys(r);n<r;)t[n++]=e;return t}(t,e,n,r)):[]},Qn.filter=function(t,e){return(Ha(t)?Oe:yr)(t,co(e,3))},Qn.flatMap=function(t,e){return xr(Na(t,e),1)},Qn.flatMapDeep=function(t,e){return xr(Na(t,e),d)},Qn.flatMapDepth=function(t,e,n){return n=n===i?1:gs(n),xr(Na(t,e),n)},Qn.flatten=Wo,Qn.flattenDeep=function(t){return(null==t?0:t.length)?xr(t,d):[]},Qn.flattenDepth=function(t,e){return(null==t?0:t.length)?xr(t,e=e===i?1:gs(e)):[]},Qn.flip=function(t){return Zi(t,512)},Qn.flow=iu,Qn.flowRight=ou,Qn.fromPairs=function(t){for(var e=-1,n=null==t?0:t.length,r={};++e<n;){var i=t[e];r[i[0]]=i[1]}return r},Qn.functions=function(t){return null==t?[]:wr(t,Us(t))},Qn.functionsIn=function(t){return null==t?[]:wr(t,Rs(t))},Qn.groupBy=Ta,Qn.initial=function(t){return(null==t?0:t.length)?oi(t,0,-1):[]},Qn.intersection=qo,Qn.intersectionBy=$o,Qn.intersectionWith=Ko,Qn.invert=Es,Qn.invertBy=Cs,Qn.invokeMap=wa,Qn.iteratee=su,Qn.keyBy=Sa,Qn.keys=Us,Qn.keysIn=Rs,Qn.map=Na,Qn.mapKeys=function(t,e){var n={};return e=co(e,3),Ar(t,(function(t,r,i){sr(n,e(t,r,i),t)})),n},Qn.mapValues=function(t,e){var n={};return e=co(e,3),Ar(t,(function(t,r,i){sr(n,r,e(t,r,i))})),n},Qn.matches=function(t){return Qr(cr(t,1))},Qn.matchesProperty=function(t,e){return kr(t,cr(e,1))},Qn.memoize=za,Qn.merge=Ms,Qn.mergeWith=zs,Qn.method=uu,Qn.methodOf=lu,Qn.mixin=cu,Qn.negate=Da,Qn.nthArg=function(t){return t=gs(t),Kr((function(e){return Vr(e,t)}))},Qn.omit=Ds,Qn.omitBy=function(t,e){return js(t,Da(co(e)))},Qn.once=function(t){return Ea(2,t)},Qn.orderBy=function(t,e,n,r){return null==t?[]:(Ha(e)||(e=null==e?[]:[e]),Ha(n=r?i:n)||(n=null==n?[]:[n]),Yr(t,e,n))},Qn.over=hu,Qn.overArgs=Xa,Qn.overEvery=du,Qn.overSome=pu,Qn.partial=ja,Qn.partialRight=Ja,Qn.partition=Fa,Qn.pick=Xs,Qn.pickBy=js,Qn.property=vu,Qn.propertyOf=function(t){return function(e){return null==t?i:Sr(t,e)}},Qn.pull=ta,Qn.pullAll=ea,Qn.pullAllBy=function(t,e,n){return t&&t.length&&e&&e.length?Wr(t,e,co(n,2)):t},Qn.pullAllWith=function(t,e,n){return t&&t.length&&e&&e.length?Wr(t,e,i,n):t},Qn.pullAt=na,Qn.range=mu,Qn.rangeRight=gu,Qn.rearg=Qa,Qn.reject=function(t,e){return(Ha(t)?Oe:yr)(t,Da(co(e,3)))},Qn.remove=function(t,e){var n=[];if(!t||!t.length)return n;var r=-1,i=[],o=t.length;for(e=co(e,3);++r<o;){var a=t[r];e(a,r,t)&&(n.push(a),i.push(r))}return Gr(t,i),n},Qn.rest=function(t,e){if("function"!=typeof t)throw new Ot(o);return Kr(t,e=e===i?e:gs(e))},Qn.reverse=ra,Qn.sampleSize=function(t,e,n){return e=(n?Ao(t,e,n):e===i)?1:gs(e),(Ha(t)?tr:ti)(t,e)},Qn.set=function(t,e,n){return null==t?t:ei(t,e,n)},Qn.setWith=function(t,e,n,r){return r="function"==typeof r?r:i,null==t?t:ei(t,e,n,r)},Qn.shuffle=function(t){return(Ha(t)?er:ii)(t)},Qn.slice=function(t,e,n){var r=null==t?0:t.length;return r?(n&&"number"!=typeof n&&Ao(t,e,n)?(e=0,n=r):(e=null==e?0:gs(e),n=n===i?r:gs(n)),oi(t,e,n)):[]},Qn.sortBy=Pa,Qn.sortedUniq=function(t){return t&&t.length?li(t):[]},Qn.sortedUniqBy=function(t,e){return t&&t.length?li(t,co(e,2)):[]},Qn.split=function(t,e,n){return n&&"number"!=typeof n&&Ao(t,e,n)&&(e=n=i),(n=n===i?m:n>>>0)?(t=bs(t))&&("string"==typeof e||null!=e&&!us(e))&&!(e=fi(e))&&sn(t)?Ti(pn(t),0,n):t.split(e,n):[]},Qn.spread=function(t,e){if("function"!=typeof t)throw new Ot(o);return e=null==e?0:_n(gs(e),0),Kr((function(n){var r=n[e],i=Ti(n,0,e);return r&&Ue(i,r),Se(t,this,i)}))},Qn.tail=function(t){var e=null==t?0:t.length;return e?oi(t,1,e):[]},Qn.take=function(t,e,n){return t&&t.length?oi(t,0,(e=n||e===i?1:gs(e))<0?0:e):[]},Qn.takeRight=function(t,e,n){var r=null==t?0:t.length;return r?oi(t,(e=r-(e=n||e===i?1:gs(e)))<0?0:e,r):[]},Qn.takeRightWhile=function(t,e){return t&&t.length?vi(t,co(e,3),!1,!0):[]},Qn.takeWhile=function(t,e){return t&&t.length?vi(t,co(e,3)):[]},Qn.tap=function(t,e){return e(t),t},Qn.throttle=function(t,e,n){var r=!0,i=!0;if("function"!=typeof t)throw new Ot(o);return rs(n)&&(r="leading"in n?!!n.leading:r,i="trailing"in n?!!n.trailing:i),Ua(t,e,{leading:r,maxWait:e,trailing:i})},Qn.thru=ma,Qn.toArray=vs,Qn.toPairs=Js,Qn.toPairsIn=Qs,Qn.toPath=function(t){return Ha(t)?Ie(t,jo):fs(t)?[t]:Ei(Xo(bs(t)))},Qn.toPlainObject=_s,Qn.transform=function(t,e,n){var r=Ha(t),i=r||$a(t)||hs(t);if(e=co(e,4),null==n){var o=t&&t.constructor;n=i?r?new o:[]:rs(t)&&ts(o)?kn(Ht(t)):{}}return(i?Fe:Ar)(t,(function(t,r,i){return e(n,t,r,i)})),n},Qn.unary=function(t){return Oa(t,1)},Qn.union=ia,Qn.unionBy=oa,Qn.unionWith=aa,Qn.uniq=function(t){return t&&t.length?hi(t):[]},Qn.uniqBy=function(t,e){return t&&t.length?hi(t,co(e,2)):[]},Qn.uniqWith=function(t,e){return e="function"==typeof e?e:i,t&&t.length?hi(t,i,e):[]},Qn.unset=function(t,e){return null==t||di(t,e)},Qn.unzip=sa,Qn.unzipWith=ua,Qn.update=function(t,e,n){return null==t?t:pi(t,e,_i(n))},Qn.updateWith=function(t,e,n,r){return r="function"==typeof r?r:i,null==t?t:pi(t,e,_i(n),r)},Qn.values=ks,Qn.valuesIn=function(t){return null==t?[]:Ke(t,Rs(t))},Qn.without=la,Qn.words=tu,Qn.wrap=function(t,e){return ja(_i(e),t)},Qn.xor=ca,Qn.xorBy=fa,Qn.xorWith=ha,Qn.zip=da,Qn.zipObject=function(t,e){return yi(t||[],e||[],rr)},Qn.zipObjectDeep=function(t,e){return yi(t||[],e||[],ei)},Qn.zipWith=pa,Qn.entries=Js,Qn.entriesIn=Qs,Qn.extend=Ts,Qn.extendWith=ws,cu(Qn,Qn),Qn.add=_u,Qn.attempt=eu,Qn.camelCase=Bs,Qn.capitalize=Vs,Qn.ceil=bu,Qn.clamp=function(t,e,n){return n===i&&(n=e,e=i),n!==i&&(n=(n=xs(n))==n?n:0),e!==i&&(e=(e=xs(e))==e?e:0),lr(xs(t),e,n)},Qn.clone=function(t){return cr(t,4)},Qn.cloneDeep=function(t){return cr(t,5)},Qn.cloneDeepWith=function(t,e){return cr(t,5,e="function"==typeof e?e:i)},Qn.cloneWith=function(t,e){return cr(t,4,e="function"==typeof e?e:i)},Qn.conformsTo=function(t,e){return null==e||fr(t,e,Us(e))},Qn.deburr=Ys,Qn.defaultTo=function(t,e){return null==t||t!=t?e:t},Qn.divide=Au,Qn.endsWith=function(t,e,n){t=bs(t),e=fi(e);var r=t.length,o=n=n===i?r:lr(gs(n),0,r);return(n-=e.length)>=0&&t.slice(n,o)==e},Qn.eq=ka,Qn.escape=function(t){return(t=bs(t))&&$.test(t)?t.replace(G,on):t},Qn.escapeRegExp=function(t){return(t=bs(t))&&ot.test(t)?t.replace(it,"\\$&"):t},Qn.every=function(t,e,n){var r=Ha(t)?Le:mr;return n&&Ao(t,e,n)&&(e=i),r(t,co(e,3))},Qn.find=xa,Qn.findIndex=Yo,Qn.findKey=function(t,e){return Xe(t,co(e,3),Ar)},Qn.findLast=_a,Qn.findLastIndex=Ho,Qn.findLastKey=function(t,e){return Xe(t,co(e,3),Tr)},Qn.floor=Tu,Qn.forEach=ba,Qn.forEachRight=Aa,Qn.forIn=function(t,e){return null==t?t:_r(t,co(e,3),Rs)},Qn.forInRight=function(t,e){return null==t?t:br(t,co(e,3),Rs)},Qn.forOwn=function(t,e){return t&&Ar(t,co(e,3))},Qn.forOwnRight=function(t,e){return t&&Tr(t,co(e,3))},Qn.get=Ls,Qn.gt=Ba,Qn.gte=Va,Qn.has=function(t,e){return null!=t&&yo(t,e,Lr)},Qn.hasIn=Os,Qn.head=Go,Qn.identity=au,Qn.includes=function(t,e,n,r){t=Ga(t)?t:ks(t),n=n&&!r?gs(n):0;var i=t.length;return n<0&&(n=_n(i+n,0)),cs(t)?n<=i&&t.indexOf(e,n)>-1:!!i&&Je(t,e,n)>-1},Qn.indexOf=function(t,e,n){var r=null==t?0:t.length;if(!r)return-1;var i=null==n?0:gs(n);return i<0&&(i=_n(r+i,0)),Je(t,e,i)},Qn.inRange=function(t,e,n){return e=ms(e),n===i?(n=e,e=0):n=ms(n),function(t,e,n){return t>=bn(e,n)&&t<_n(e,n)}(t=xs(t),e,n)},Qn.invoke=Is,Qn.isArguments=Ya,Qn.isArray=Ha,Qn.isArrayBuffer=Wa,Qn.isArrayLike=Ga,Qn.isArrayLikeObject=qa,Qn.isBoolean=function(t){return!0===t||!1===t||is(t)&&Fr(t)==_},Qn.isBuffer=$a,Qn.isDate=Ka,Qn.isElement=function(t){return is(t)&&1===t.nodeType&&!ss(t)},Qn.isEmpty=function(t){if(null==t)return!0;if(Ga(t)&&(Ha(t)||"string"==typeof t||"function"==typeof t.splice||$a(t)||hs(t)||Ya(t)))return!t.length;var e=go(t);if(e==S||e==O)return!t.size;if(No(t))return!Dr(t).length;for(var n in t)if(Mt.call(t,n))return!1;return!0},Qn.isEqual=function(t,e){return Ur(t,e)},Qn.isEqualWith=function(t,e,n){var r=(n="function"==typeof n?n:i)?n(t,e):i;return r===i?Ur(t,e,i,n):!!r},Qn.isError=Za,Qn.isFinite=function(t){return"number"==typeof t&&Ye(t)},Qn.isFunction=ts,Qn.isInteger=es,Qn.isLength=ns,Qn.isMap=os,Qn.isMatch=function(t,e){return t===e||Rr(t,e,ho(e))},Qn.isMatchWith=function(t,e,n){return n="function"==typeof n?n:i,Rr(t,e,ho(e),n)},Qn.isNaN=function(t){return as(t)&&t!=+t},Qn.isNative=function(t){if(So(t))throw new wt("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return Mr(t)},Qn.isNil=function(t){return null==t},Qn.isNull=function(t){return null===t},Qn.isNumber=as,Qn.isObject=rs,Qn.isObjectLike=is,Qn.isPlainObject=ss,Qn.isRegExp=us,Qn.isSafeInteger=function(t){return es(t)&&t>=-9007199254740991&&t<=p},Qn.isSet=ls,Qn.isString=cs,Qn.isSymbol=fs,Qn.isTypedArray=hs,Qn.isUndefined=function(t){return t===i},Qn.isWeakMap=function(t){return is(t)&&go(t)==I},Qn.isWeakSet=function(t){return is(t)&&"[object WeakSet]"==Fr(t)},Qn.join=function(t,e){return null==t?"":yn.call(t,e)},Qn.kebabCase=Hs,Qn.last=Zo,Qn.lastIndexOf=function(t,e,n){var r=null==t?0:t.length;if(!r)return-1;var o=r;return n!==i&&(o=(o=gs(n))<0?_n(r+o,0):bn(o,r-1)),e==e?function(t,e,n){for(var r=n+1;r--;)if(t[r]===e)return r;return r}(t,e,o):je(t,ke,o,!0)},Qn.lowerCase=Ws,Qn.lowerFirst=Gs,Qn.lt=ds,Qn.lte=ps,Qn.max=function(t){return t&&t.length?gr(t,au,Pr):i},Qn.maxBy=function(t,e){return t&&t.length?gr(t,co(e,2),Pr):i},Qn.mean=function(t){return Be(t,au)},Qn.meanBy=function(t,e){return Be(t,co(e,2))},Qn.min=function(t){return t&&t.length?gr(t,au,jr):i},Qn.minBy=function(t,e){return t&&t.length?gr(t,co(e,2),jr):i},Qn.stubArray=yu,Qn.stubFalse=xu,Qn.stubObject=function(){return{}},Qn.stubString=function(){return""},Qn.stubTrue=function(){return!0},Qn.multiply=Su,Qn.nth=function(t,e){return t&&t.length?Vr(t,gs(e)):i},Qn.noConflict=function(){return de._===this&&(de._=Jt),this},Qn.noop=fu,Qn.now=La,Qn.pad=function(t,e,n){t=bs(t);var r=(e=gs(e))?dn(t):0;if(!e||r>=e)return t;var i=(e-r)/2;return Yi(ge(i),n)+t+Yi(ve(i),n)},Qn.padEnd=function(t,e,n){t=bs(t);var r=(e=gs(e))?dn(t):0;return e&&r<e?t+Yi(e-r,n):t},Qn.padStart=function(t,e,n){t=bs(t);var r=(e=gs(e))?dn(t):0;return e&&r<e?Yi(e-r,n)+t:t},Qn.parseInt=function(t,e,n){return n||null==e?e=0:e&&(e=+e),Tn(bs(t).replace(at,""),e||0)},Qn.random=function(t,e,n){if(n&&"boolean"!=typeof n&&Ao(t,e,n)&&(e=n=i),n===i&&("boolean"==typeof e?(n=e,e=i):"boolean"==typeof t&&(n=t,t=i)),t===i&&e===i?(t=0,e=1):(t=ms(t),e===i?(e=t,t=0):e=ms(e)),t>e){var r=t;t=e,e=r}if(n||t%1||e%1){var o=wn();return bn(t+o*(e-t+le("1e-"+((o+"").length-1))),e)}return qr(t,e)},Qn.reduce=function(t,e,n){var r=Ha(t)?Re:He,i=arguments.length<3;return r(t,co(e,4),n,i,pr)},Qn.reduceRight=function(t,e,n){var r=Ha(t)?Me:He,i=arguments.length<3;return r(t,co(e,4),n,i,vr)},Qn.repeat=function(t,e,n){return e=(n?Ao(t,e,n):e===i)?1:gs(e),$r(bs(t),e)},Qn.replace=function(){var t=arguments,e=bs(t[0]);return t.length<3?e:e.replace(t[1],t[2])},Qn.result=function(t,e,n){var r=-1,o=(e=bi(e,t)).length;for(o||(o=1,t=i);++r<o;){var a=null==t?i:t[jo(e[r])];a===i&&(r=o,a=n),t=ts(a)?a.call(t):a}return t},Qn.round=Nu,Qn.runInContext=t,Qn.sample=function(t){return(Ha(t)?Zn:Zr)(t)},Qn.size=function(t){if(null==t)return 0;if(Ga(t))return cs(t)?dn(t):t.length;var e=go(t);return e==S||e==O?t.size:Dr(t).length},Qn.snakeCase=qs,Qn.some=function(t,e,n){var r=Ha(t)?ze:ai;return n&&Ao(t,e,n)&&(e=i),r(t,co(e,3))},Qn.sortedIndex=function(t,e){return si(t,e)},Qn.sortedIndexBy=function(t,e,n){return ui(t,e,co(n,2))},Qn.sortedIndexOf=function(t,e){var n=null==t?0:t.length;if(n){var r=si(t,e);if(r<n&&ka(t[r],e))return r}return-1},Qn.sortedLastIndex=function(t,e){return si(t,e,!0)},Qn.sortedLastIndexBy=function(t,e,n){return ui(t,e,co(n,2),!0)},Qn.sortedLastIndexOf=function(t,e){if(null==t?0:t.length){var n=si(t,e,!0)-1;if(ka(t[n],e))return n}return-1},Qn.startCase=$s,Qn.startsWith=function(t,e,n){return t=bs(t),n=null==n?0:lr(gs(n),0,t.length),e=fi(e),t.slice(n,n+e.length)==e},Qn.subtract=Fu,Qn.sum=function(t){return t&&t.length?We(t,au):0},Qn.sumBy=function(t,e){return t&&t.length?We(t,co(e,2)):0},Qn.template=function(t,e,n){var r=Qn.templateSettings;n&&Ao(t,e,n)&&(e=i),t=bs(t),e=ws({},e,r,to);var o,a,s=ws({},e.imports,r.imports,to),u=Us(s),l=Ke(s,u),c=0,f=e.interpolate||At,h="__p += '",d=Pt((e.escape||At).source+"|"+f.source+"|"+(f===tt?pt:At).source+"|"+(e.evaluate||At).source+"|$","g"),p="//# sourceURL="+(Mt.call(e,"sourceURL")?(e.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++oe+"]")+"\n";t.replace(d,(function(e,n,r,i,s,u){return r||(r=i),h+=t.slice(c,u).replace(Tt,an),n&&(o=!0,h+="' +\n__e("+n+") +\n'"),s&&(a=!0,h+="';\n"+s+";\n__p += '"),r&&(h+="' +\n((__t = ("+r+")) == null ? '' : __t) +\n'"),c=u+e.length,e})),h+="';\n";var v=Mt.call(e,"variable")&&e.variable;if(v){if(ht.test(v))throw new wt("Invalid `variable` option passed into `_.template`")}else h="with (obj) {\n"+h+"\n}\n";h=(a?h.replace(V,""):h).replace(Y,"$1").replace(H,"$1;"),h="function("+(v||"obj")+") {\n"+(v?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(o?", __e = _.escape":"")+(a?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+h+"return __p\n}";var m=eu((function(){return St(u,p+"return "+h).apply(i,l)}));if(m.source=h,Za(m))throw m;return m},Qn.times=function(t,e){if((t=gs(t))<1||t>p)return[];var n=m,r=bn(t,m);e=co(e),t-=m;for(var i=Ge(r,e);++n<t;)e(n);return i},Qn.toFinite=ms,Qn.toInteger=gs,Qn.toLength=ys,Qn.toLower=function(t){return bs(t).toLowerCase()},Qn.toNumber=xs,Qn.toSafeInteger=function(t){return t?lr(gs(t),-9007199254740991,p):0===t?t:0},Qn.toString=bs,Qn.toUpper=function(t){return bs(t).toUpperCase()},Qn.trim=function(t,e,n){if((t=bs(t))&&(n||e===i))return qe(t);if(!t||!(e=fi(e)))return t;var r=pn(t),o=pn(e);return Ti(r,tn(r,o),en(r,o)+1).join("")},Qn.trimEnd=function(t,e,n){if((t=bs(t))&&(n||e===i))return t.slice(0,vn(t)+1);if(!t||!(e=fi(e)))return t;var r=pn(t);return Ti(r,0,en(r,pn(e))+1).join("")},Qn.trimStart=function(t,e,n){if((t=bs(t))&&(n||e===i))return t.replace(at,"");if(!t||!(e=fi(e)))return t;var r=pn(t);return Ti(r,tn(r,pn(e))).join("")},Qn.truncate=function(t,e){var n=30,r="...";if(rs(e)){var o="separator"in e?e.separator:o;n="length"in e?gs(e.length):n,r="omission"in e?fi(e.omission):r}var a=(t=bs(t)).length;if(sn(t)){var s=pn(t);a=s.length}if(n>=a)return t;var u=n-dn(r);if(u<1)return r;var l=s?Ti(s,0,u).join(""):t.slice(0,u);if(o===i)return l+r;if(s&&(u+=l.length-u),us(o)){if(t.slice(u).search(o)){var c,f=l;for(o.global||(o=Pt(o.source,bs(vt.exec(o))+"g")),o.lastIndex=0;c=o.exec(f);)var h=c.index;l=l.slice(0,h===i?u:h)}}else if(t.indexOf(fi(o),u)!=u){var d=l.lastIndexOf(o);d>-1&&(l=l.slice(0,d))}return l+r},Qn.unescape=function(t){return(t=bs(t))&&q.test(t)?t.replace(W,mn):t},Qn.uniqueId=function(t){var e=++zt;return bs(t)+e},Qn.upperCase=Ks,Qn.upperFirst=Zs,Qn.each=ba,Qn.eachRight=Aa,Qn.first=Go,cu(Qn,(wu={},Ar(Qn,(function(t,e){Mt.call(Qn.prototype,e)||(wu[e]=t)})),wu),{chain:!1}),Qn.VERSION="4.17.21",Fe(["bind","bindKey","curry","curryRight","partial","partialRight"],(function(t){Qn[t].placeholder=Qn})),Fe(["drop","take"],(function(t,e){Yn.prototype[t]=function(n){n=n===i?1:_n(gs(n),0);var r=this.__filtered__&&!e?new Yn(this):this.clone();return r.__filtered__?r.__takeCount__=bn(n,r.__takeCount__):r.__views__.push({size:bn(n,m),type:t+(r.__dir__<0?"Right":"")}),r},Yn.prototype[t+"Right"]=function(e){return this.reverse()[t](e).reverse()}})),Fe(["filter","map","takeWhile"],(function(t,e){var n=e+1,r=1==n||3==n;Yn.prototype[t]=function(t){var e=this.clone();return e.__iteratees__.push({iteratee:co(t,3),type:n}),e.__filtered__=e.__filtered__||r,e}})),Fe(["head","last"],(function(t,e){var n="take"+(e?"Right":"");Yn.prototype[t]=function(){return this[n](1).value()[0]}})),Fe(["initial","tail"],(function(t,e){var n="drop"+(e?"":"Right");Yn.prototype[t]=function(){return this.__filtered__?new Yn(this):this[n](1)}})),Yn.prototype.compact=function(){return this.filter(au)},Yn.prototype.find=function(t){return this.filter(t).head()},Yn.prototype.findLast=function(t){return this.reverse().find(t)},Yn.prototype.invokeMap=Kr((function(t,e){return"function"==typeof t?new Yn(this):this.map((function(n){return Cr(n,t,e)}))})),Yn.prototype.reject=function(t){return this.filter(Da(co(t)))},Yn.prototype.slice=function(t,e){t=gs(t);var n=this;return n.__filtered__&&(t>0||e<0)?new Yn(n):(t<0?n=n.takeRight(-t):t&&(n=n.drop(t)),e!==i&&(n=(e=gs(e))<0?n.dropRight(-e):n.take(e-t)),n)},Yn.prototype.takeRightWhile=function(t){return this.reverse().takeWhile(t).reverse()},Yn.prototype.toArray=function(){return this.take(m)},Ar(Yn.prototype,(function(t,e){var n=/^(?:filter|find|map|reject)|While$/.test(e),r=/^(?:head|last)$/.test(e),o=Qn[r?"take"+("last"==e?"Right":""):e],a=r||/^find/.test(e);o&&(Qn.prototype[e]=function(){var e=this.__wrapped__,s=r?[1]:arguments,u=e instanceof Yn,l=s[0],c=u||Ha(e),f=function(t){var e=o.apply(Qn,Ue([t],s));return r&&h?e[0]:e};c&&n&&"function"==typeof l&&1!=l.length&&(u=c=!1);var h=this.__chain__,d=!!this.__actions__.length,p=a&&!h,v=u&&!d;if(!a&&c){e=v?e:new Yn(this);var m=t.apply(e,s);return m.__actions__.push({func:ma,args:[f],thisArg:i}),new Vn(m,h)}return p&&v?t.apply(this,s):(m=this.thru(f),p?r?m.value()[0]:m.value():m)})})),Fe(["pop","push","shift","sort","splice","unshift"],(function(t){var e=Et[t],n=/^(?:push|sort|unshift)$/.test(t)?"tap":"thru",r=/^(?:pop|shift)$/.test(t);Qn.prototype[t]=function(){var t=arguments;if(r&&!this.__chain__){var i=this.value();return e.apply(Ha(i)?i:[],t)}return this[n]((function(n){return e.apply(Ha(n)?n:[],t)}))}})),Ar(Yn.prototype,(function(t,e){var n=Qn[e];if(n){var r=n.name+"";Mt.call(In,r)||(In[r]=[]),In[r].push({name:e,func:n})}})),In[Qi(i,2).name]=[{name:"wrapper",func:i}],Yn.prototype.clone=function(){var t=new Yn(this.__wrapped__);return t.__actions__=Ei(this.__actions__),t.__dir__=this.__dir__,t.__filtered__=this.__filtered__,t.__iteratees__=Ei(this.__iteratees__),t.__takeCount__=this.__takeCount__,t.__views__=Ei(this.__views__),t},Yn.prototype.reverse=function(){if(this.__filtered__){var t=new Yn(this);t.__dir__=-1,t.__filtered__=!0}else(t=this.clone()).__dir__*=-1;return t},Yn.prototype.value=function(){var t=this.__wrapped__.value(),e=this.__dir__,n=Ha(t),r=e<0,i=n?t.length:0,o=function(t,e,n){var r=-1,i=n.length;for(;++r<i;){var o=n[r],a=o.size;switch(o.type){case"drop":t+=a;break;case"dropRight":e-=a;break;case"take":e=bn(e,t+a);break;case"takeRight":t=_n(t,e-a)}}return{start:t,end:e}}(0,i,this.__views__),a=o.start,s=o.end,u=s-a,l=r?s:a-1,c=this.__iteratees__,f=c.length,h=0,d=bn(u,this.__takeCount__);if(!n||!r&&i==u&&d==u)return mi(t,this.__actions__);var p=[];t:for(;u--&&h<d;){for(var v=-1,m=t[l+=e];++v<f;){var g=c[v],y=g.iteratee,x=g.type,_=y(m);if(2==x)m=_;else if(!_){if(1==x)continue t;break t}}p[h++]=m}return p},Qn.prototype.at=ga,Qn.prototype.chain=function(){return va(this)},Qn.prototype.commit=function(){return new Vn(this.value(),this.__chain__)},Qn.prototype.next=function(){this.__values__===i&&(this.__values__=vs(this.value()));var t=this.__index__>=this.__values__.length;return{done:t,value:t?i:this.__values__[this.__index__++]}},Qn.prototype.plant=function(t){for(var e,n=this;n instanceof Bn;){var r=Qo(n);r.__index__=0,r.__values__=i,e?o.__wrapped__=r:e=r;var o=r;n=n.__wrapped__}return o.__wrapped__=t,e},Qn.prototype.reverse=function(){var t=this.__wrapped__;if(t instanceof Yn){var e=t;return this.__actions__.length&&(e=new Yn(this)),(e=e.reverse()).__actions__.push({func:ma,args:[ra],thisArg:i}),new Vn(e,this.__chain__)}return this.thru(ra)},Qn.prototype.toJSON=Qn.prototype.valueOf=Qn.prototype.value=function(){return mi(this.__wrapped__,this.__actions__)},Qn.prototype.first=Qn.prototype.head,te&&(Qn.prototype[te]=function(){return this}),Qn}();de._=gn,(r=function(){return gn}.call(e,n,e,t))===i||(t.exports=r)}.call(this)}},e={};function n(r){var i=e[r];if(void 0!==i)return i.exports;var o=e[r]={id:r,loaded:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.loaded=!0,o.exports}n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),n.nmd=t=>(t.paths=[],t.children||(t.children=[]),t),(()=>{"use strict";const t=THREE;function e(t,n=""){return Object.keys(t).reduce(((r,i)=>{const o=n.length?`${n}.`:"";return"object"==typeof t[i]&&null!==t[i]&&Object.keys(t[i]).length?Object.assign(r,e(t[i],o+i)):r[o+i]=t[i],r}),{})}const r="d~i-f*f";let i;const o="string",a="number",s="boolean";function u(t){const{types:e}=i;return e.includes(typeof t)}function l(t,n,i,a,s){const l=function(t,e,n=[],r=[]){typeof n===o&&(n=n.split(",")),typeof r===o&&(r=r.split(","));const i=Object.keys(t);let a=n.length?i.filter((t=>n.includes(t))):i.filter((t=>!r.includes(t)));return e&&(a=a.filter((t=>t!==e))),a.sort()}(t,n,i,a),c=e(Object.keys(t).filter((t=>l.includes(t))).reduce(((e,n)=>Object.assign(e,{[n]:t[n]})),{})),f=Object.keys(c).filter((t=>u(c[t]))).reduce(((t,e)=>Object.assign(t,{[e]:c[e]})),{});if(!s)return f;const h=function(t,e){let n=0;return Object.keys(t).sort().reduce(((r,i)=>{const o=t[i];return o!==e[i]&&(r[i]=o,r["d~i-f*f"].push(n)),n++,r}),{[r]:[]})}(f,e(s));return s||delete h["d~i-f*f"],h}function c(t,e,n){if(void 0!==n[t])return typeof n[t]===s?Boolean(e):typeof n[t]===a?Number(e):e}function f(t){const{digits:e}=i;if(typeof t!==a||Number.isInteger(t)||!e)return t;const n=Math.pow(10,e);return t=Math.round(t*n)/n}i={name:"winlo",separator:"~",overwrite:!0,types:[o,a,s],digits:3,diffSeparator:".",reset:function(){i.hash="",i.search=""},init:function(){i.search||i.hash||(i.hash="/",i.reset())},save:function(t,e=!0,{hash:n,include:r,exclude:o,reference:a}={}){const{name:s,overwrite:c,separator:h,search:d,diffSeparator:p}=i,v=new URLSearchParams(c?void 0:d),m=t[n];m&&u(m)?i.hash=m:n=!1;const g=l(t,n,r,o,a),y=Object.entries(g);if(!y.length)return;let x;if(y.forEach((([t,e])=>g[t]=f(e))),e){x=!0===e?s:e;const t=g["d~i-f*f"],n=t?t.join(p):"";delete g["d~i-f*f"];let r=Object.keys(g).sort().map((t=>g[t])).join(h);if(n.length){r+=`${`${h}${h}`}${n}`}r.length&&v.set(x,r)}else{delete g["d~i-f*f"];new URLSearchParams(g).forEach(((t,e)=>{e=c?e:`${s}.${e}`,v.set(e,t)}))}return i.search=v,t},load:function(t,n=!0,{hash:r,include:o,exclude:a}={}){const{name:s,separator:u,search:h,diffSeparator:d}=i,p=new URLSearchParams(h);if(r&&void 0!==t[r]){let e=window.location.hash;e&&(e=e.substring(1),t[r]=c(r,e,t))}let v=e(t);if(n){const e=function(t){return Object.keys(t).sort()}(l(t,r,o,a));if(!e.length)return;const i=!0===n?s:n;let f=p.get(i);if(!f)return;const h=`${u}${u}`;let m;if(f.includes(h)){const t=f.split(h);m=t[1].split(d),f=t[0]}let g=f.split(u);if(g.length!==e.length&&!m)return;let y=0;e.forEach((t=>{(!m||m.includes(y.toString()))&&(v[t]=c(t,g.shift(),v)),y++}))}else p.forEach(((t,e)=>{const n=c(e,t,v);void 0!==c&&(v[e]=n)}));v=function(t){return Object.keys(t).reduce(((e,n)=>(n.split(".").reduce(((e,r,i,o)=>e[r]||(e[r]=isNaN(Number(o[i+1]))?o.length-1===i?t[n]:{}:[])),e),e)),{})}(v);for(let e in v)t[e]=f(v[e]);return t},round:f,get hash(){let t=window.location.hash;if(t&&(t=t.substring(1)),t.length)return t},set hash(t){t.length&&"#"!==t.charAt(0)&&(t="#"+t),window.location.hash=t},get search(){return window.location.search},set search(t){window.location.search=t}};const h=i;function d(t){return d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},d(t)}function p(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function v(t,e){return v=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},v(t,e)}function m(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=y(t);if(e){var i=y(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return g(this,n)}}function g(t,e){if(e&&("object"===d(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function y(t){return y=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},y(t)}var x=function(e){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&v(t,e)}(a,e);var n,r,i,o=m(a);function a(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),o.call(this,{glslVersion:t.GLSL3,uniforms:{tMap:new t.Uniform(null),uBluriness:new t.Uniform(1),uDirection:new t.Uniform(new t.Vector2(1,0)),uResolution:new t.Uniform(new t.Vector2)},vertexShader:"in vec2 uv;\r\nin vec3 position;\r\n\r\nout vec2 vUv;\r\n\r\nvoid main() {\r\n    vUv = uv;\r\n\r\n    gl_Position = vec4(position, 1.0);\r\n}",fragmentShader:"precision highp float;\r\n\r\nuniform sampler2D tMap;\r\nuniform float uBluriness;\r\nuniform vec2 uDirection;\r\nuniform vec2 uResolution;\r\n\r\nin vec2 vUv;\r\n\r\nout vec4 FragColor;\r\n\r\nvec4 blur13(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\r\n  vec4 color = vec4(0.0);\r\n  vec2 off1 = vec2(1.411764705882353) * direction;\r\n  vec2 off2 = vec2(3.2941176470588234) * direction;\r\n  vec2 off3 = vec2(5.176470588235294) * direction;\r\n  color += texture(image, uv) * 0.1964825501511404;\r\n  color += texture(image, uv + (off1 / resolution)) * 0.2969069646728344;\r\n  color += texture(image, uv - (off1 / resolution)) * 0.2969069646728344;\r\n  color += texture(image, uv + (off2 / resolution)) * 0.09447039785044732;\r\n  color += texture(image, uv - (off2 / resolution)) * 0.09447039785044732;\r\n  color += texture(image, uv + (off3 / resolution)) * 0.010381362401148057;\r\n  color += texture(image, uv - (off3 / resolution)) * 0.010381362401148057;\r\n  return color;\r\n}\r\n\r\nvoid main() {\r\n    FragColor = blur13(tMap, vUv, uResolution, smoothstep(0.5 + uBluriness * 0.5, 0.0, vUv.y) * uDirection);\r\n}",blending:t.NoBlending,depthWrite:!1,depthTest:!1})}return n=a,r&&p(n.prototype,r),i&&p(n,i),Object.defineProperty(n,"prototype",{writable:!1}),n}(t.RawShaderMaterial);function _(t){return _="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_(t)}function b(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function A(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function T(t,e){return T=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},T(t,e)}function w(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=N(t);if(e){var i=N(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return S(this,n)}}function S(t,e){if(e&&("object"===_(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function N(t){return N=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},N(t)}var F=function(e){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&T(t,e)}(a,e);var n,r,i,o=w(a);function a(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=n.width,i=void 0===r?512:r,s=n.height,u=void 0===s?512:s,l=n.clipBias,c=void 0===l?0:l,f=n.blurIterations,h=void 0===f?8:f,d=n.blurFactor,p=void 0===d?1:d;return b(this,a),(e=o.call(this)).clipBias=c,e.blurIterations=h,e.reflectorPlane=new t.Plane,e.normal=new t.Vector3,e.reflectorWorldPosition=new t.Vector3,e.cameraWorldPosition=new t.Vector3,e.rotationMatrix=new t.Matrix4,e.lookAtPosition=new t.Vector3(0,0,-1),e.clipPlane=new t.Vector4,e.view=new t.Vector3,e.target=new t.Vector3,e.q=new t.Vector4,e.textureMatrix=new t.Matrix4,e.virtualCamera=new t.PerspectiveCamera,e.textureMatrixUniform=new t.Uniform(e.textureMatrix),e.renderTarget=new t.WebGLRenderTarget(i,u,{format:t.RGBFormat,depthBuffer:!1}),e.renderTargetRead=e.renderTarget.clone(),e.renderTargetWrite=e.renderTarget.clone(),e.renderTarget.depthBuffer=!0,e.renderTargetUniform=e.blurIterations>0?new t.Uniform(e.renderTargetRead.texture):new t.Uniform(e.renderTarget.texture),e.blurMaterial=new x,e.blurMaterial.uniforms.uBluriness.value=p,e.blurMaterial.uniforms.uResolution.value.set(i,u),e.screenScene=new t.Scene,e.screenCamera=new t.OrthographicCamera(-1,1,1,-1,0,1),e.screenGeometry=a.getFullscreenTriangle(),e.screen=new t.Mesh(e.screenGeometry,e.blurMaterial),e.screen.frustumCulled=!1,e.screenScene.add(e.screen),e}return n=a,r=[{key:"setSize",value:function(t,e){this.renderTarget.setSize(t,e),this.renderTargetRead.setSize(t,e),this.renderTargetWrite.setSize(t,e),this.blurMaterial.uniforms.uResolution.value.set(t,e)}},{key:"update",value:function(t,e,n){if(this.reflectorWorldPosition.setFromMatrixPosition(this.matrixWorld),this.cameraWorldPosition.setFromMatrixPosition(n.matrixWorld),this.rotationMatrix.extractRotation(this.matrixWorld),this.normal.set(0,0,1),this.normal.applyMatrix4(this.rotationMatrix),this.view.subVectors(this.reflectorWorldPosition,this.cameraWorldPosition),!(this.view.dot(this.normal)>0)){this.view.reflect(this.normal).negate(),this.view.add(this.reflectorWorldPosition),this.rotationMatrix.extractRotation(n.matrixWorld),this.lookAtPosition.set(0,0,-1),this.lookAtPosition.applyMatrix4(this.rotationMatrix),this.lookAtPosition.add(this.cameraWorldPosition),this.target.subVectors(this.reflectorWorldPosition,this.lookAtPosition),this.target.reflect(this.normal).negate(),this.target.add(this.reflectorWorldPosition),this.virtualCamera.position.copy(this.view),this.virtualCamera.up.set(0,1,0),this.virtualCamera.up.applyMatrix4(this.rotationMatrix),this.virtualCamera.up.reflect(this.normal),this.virtualCamera.lookAt(this.target),this.virtualCamera.far=n.far,this.virtualCamera.updateMatrixWorld(),this.virtualCamera.projectionMatrix.copy(n.projectionMatrix),this.textureMatrix.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),this.textureMatrix.multiply(this.virtualCamera.projectionMatrix),this.textureMatrix.multiply(this.virtualCamera.matrixWorldInverse),this.textureMatrix.multiply(this.matrixWorld),this.reflectorPlane.setFromNormalAndCoplanarPoint(this.normal,this.reflectorWorldPosition),this.reflectorPlane.applyMatrix4(this.virtualCamera.matrixWorldInverse),this.clipPlane.set(this.reflectorPlane.normal.x,this.reflectorPlane.normal.y,this.reflectorPlane.normal.z,this.reflectorPlane.constant);var r=this.virtualCamera.projectionMatrix;this.q.x=(Math.sign(this.clipPlane.x)+r.elements[8])/r.elements[0],this.q.y=(Math.sign(this.clipPlane.y)+r.elements[9])/r.elements[5],this.q.z=-1,this.q.w=(1+r.elements[10])/r.elements[14],this.clipPlane.multiplyScalar(2/this.clipPlane.dot(this.q)),r.elements[2]=this.clipPlane.x,r.elements[6]=this.clipPlane.y,r.elements[10]=this.clipPlane.z+1-this.clipBias,r.elements[14]=this.clipPlane.w;var i=t.getRenderTarget(),o=t.xr.enabled,a=t.shadowMap.autoUpdate;t.xr.enabled=!1,t.shadowMap.autoUpdate=!1,t.setRenderTarget(this.renderTarget),t.state.buffers.depth.setMask(!0),!1===t.autoClear&&t.clear(),t.render(e,this.virtualCamera);for(var s=this.blurIterations,u=0;u<s;u++){this.blurMaterial.uniforms.tMap.value=0===u?this.renderTarget.texture:this.renderTargetRead.texture;var l=.5*(s-u-1);this.blurMaterial.uniforms.uDirection.value.set(u%2==0?l:0,u%2==0?0:l),t.setRenderTarget(this.renderTargetWrite),!1===t.autoClear&&t.clear(),t.render(this.screenScene,this.screenCamera);var c=this.renderTargetRead;this.renderTargetRead=this.renderTargetWrite,this.renderTargetWrite=c,this.renderTargetUniform.value=this.renderTargetRead.texture}t.xr.enabled=o,t.shadowMap.autoUpdate=a,t.setRenderTarget(i)}}},{key:"destroy",value:function(){for(var t in this.renderTargetWrite.dispose(),this.renderTargetRead.dispose(),this.renderTarget.dispose(),this.blurMaterial.dispose(),this.screenGeometry.dispose(),this)this[t]=null;return null}}],r&&A(n.prototype,r),i&&A(n,i),Object.defineProperty(n,"prototype",{writable:!1}),a}(t.Group);F.getFullscreenTriangle=function(){var e=new t.BufferGeometry,n=new Float32Array([-1,-1,3,-1,-1,3]),r=new Float32Array([0,0,2,0,0,2]);return e.setAttribute("position",new t.BufferAttribute(n,2)),e.setAttribute("uv",new t.BufferAttribute(r,2)),e};const P="in vec3 position;\r\nin vec2 uv;\r\n\r\nuniform mat4 modelViewMatrix;\r\nuniform mat4 projectionMatrix;\r\n\r\nuniform mat3 uMapTransform;\r\nuniform mat4 uMatrix;\r\n\r\nout vec2 vUv;\r\nout vec4 vCoord;\r\n\r\nvoid main() {\r\n    vUv = (uMapTransform * vec3(uv, 1.0)).xy;\r\n    vCoord = uMatrix * vec4(position, 1.0);\r\n\r\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\r\n}",L="precision highp float;\r\n\r\nuniform sampler2D tMap;\r\nuniform sampler2D tReflect;\r\nuniform vec3 uColor;\r\n\r\n#ifdef USE_FOG\r\n    uniform vec3 uFogColor;\r\n    uniform float uFogNear;\r\n    uniform float uFogFar;\r\n#endif\r\n\r\nin vec2 vUv;\r\nin vec4 vCoord;\r\n\r\nout vec4 FragColor;\r\n\r\nfloat blendOverlay(float x, float y) {\r\n    return (x < 0.5) ? (2.0 * x * y) : (1.0 - 2.0 * (1.0 - x) * (1.0 - y));\r\n}\r\n\r\nvec4 blendOverlay(vec4 x, vec4 y, float opacity) {\r\n    vec4 z = vec4(blendOverlay(x.r, y.r), blendOverlay(x.g, y.g), blendOverlay(x.b, y.b), blendOverlay(x.a, y.a));\r\n    return z * opacity + x * (1.0 - opacity);\r\n}\r\n\r\nfloat random(vec2 co) {\r\n    float a = 12.9898;\r\n    float b = 78.233;\r\n    float c = 43758.5453;\r\n    float dt = dot(co.xy, vec2(a, b));\r\n    float sn = mod(dt, 3.14);\r\n    return fract(sin(sn) * c);\r\n}\r\n\r\nvec3 dither(vec3 color) {\r\n    // Calculate grid position\r\n    float grid_position = random(gl_FragCoord.xy);\r\n\r\n    // Shift the individual colors differently, thus making it even harder to see the dithering pattern\r\n    vec3 dither_shift_RGB = vec3(0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0);\r\n\r\n    // Modify shift acording to grid position\r\n    dither_shift_RGB = mix(2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position);\r\n\r\n    // Shift the color by dither_shift\r\n    return color + dither_shift_RGB;\r\n}\r\n\r\nvoid main() {\r\n    vec4 base = texture(tMap, vUv);\r\n    vec4 blend = textureProj(tReflect, vCoord);\r\n\r\n    FragColor = base * blend;\r\n\r\n    base = FragColor;\r\n    blend = vec4(uColor, 1.0);\r\n\r\n    FragColor = blendOverlay(base, blend, 1.0);\r\n\r\n    #ifdef USE_FOG\r\n        float fogDepth = gl_FragCoord.z / gl_FragCoord.w;\r\n        float fogFactor = smoothstep(uFogNear, uFogFar, fogDepth);\r\n\r\n        FragColor.rgb = mix(FragColor.rgb, uFogColor, fogFactor);\r\n    #endif\r\n\r\n    #ifdef DITHERING\r\n        FragColor.rgb = dither(FragColor.rgb);\r\n    #endif\r\n}";function O(t){return O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},O(t)}function E(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function C(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function I(t,e){return I=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},I(t,e)}function U(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=M(t);if(e){var i=M(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}function R(t,e){if(e&&("object"===O(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function M(t){return M=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},M(t)}var z=function(e){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&I(t,e)}(a,e);var n,r,i,o=U(a);function a(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.color,r=void 0===n?new t.Color(8355711):n,i=e.map,s=void 0===i?null:i,u=e.fog,l=void 0===u?null:u,c=e.dithering,f=void 0!==c&&c;C(this,a);var h={glslVersion:t.GLSL3,defines:{},uniforms:{tMap:new t.Uniform(null),tReflect:new t.Uniform(null),uMapTransform:new t.Uniform(new t.Matrix3),uMatrix:new t.Uniform(new t.Matrix4),uColor:new t.Uniform(r instanceof t.Color?r:new t.Color(r))},vertexShader:P,fragmentShader:L};return s&&(s.updateMatrix(),h.uniforms=Object.assign(h.uniforms,{tMap:new t.Uniform(s),uMapTransform:new t.Uniform(s.matrix)})),l&&(h.defines=Object.assign(h.defines,{USE_FOG:""}),h.uniforms=Object.assign(h.uniforms,{uFogColor:new t.Uniform(l.color),uFogNear:new t.Uniform(l.near),uFogFar:new t.Uniform(l.far)})),f&&(h.defines=Object.assign(h.defines,{DITHERING:""})),o.call(this,h)}return n=a,r&&E(n.prototype,r),i&&E(n,i),Object.defineProperty(n,"prototype",{writable:!1}),n}(t.RawShaderMaterial),D=new t.Scene;D.background=new t.Color(2237222),D.fog=new t.Fog(D.background,1,50);var X=new t.PerspectiveCamera(30);X.position.set(0,0,8.5),X.near=.5,X.far=50;var j=new t.HemisphereLight(6316128,4210752),J=new t.DirectionalLight(16777215);J.position.set(1,1,1);var Q={hemisphere:j,directional:J};Object.values(Q).forEach((function(t){return D.add(t)}));var k={scene:D,camera:X,lights:Q,resize:function(t,e){X.aspect=t/e,X.updateProjectionMatrix()}};function B(t){return B="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},B(t)}function V(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Y(t,e){return Y=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Y(t,e)}function H(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=G(t);if(e){var i=G(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return W(this,n)}}function W(t,e){if(e&&("object"===B(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function G(t){return G=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},G(t)}var q=function(e){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Y(t,e)}(a,e);var n,r,i,o=H(a);function a(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(t=o.call(this)).reflector=new F,t}return n=a,r=[{key:"init",value:function(e){var n=this,r=new t.PlaneGeometry(110,110);e&&(e.wrapS=t.RepeatWrapping,e.wrapT=t.RepeatWrapping,e.repeat.set(16,16));var i=k.scene.fog,o=new z({map:e,fog:i,dithering:!0});o.uniforms.tReflect=this.reflector.renderTargetUniform,o.uniforms.uMatrix=this.reflector.textureMatrixUniform;var a=new t.Mesh(r,o);a.rotation.x=-Math.PI/2,a.add(this.reflector),a.onBeforeRender=function(t,e,r){n.visible=!1,n.reflector.update(t,e,r),n.visible=!0},this.add(a)}},{key:"resize",value:function(e,n,r){e=Math.round(e/r),n=Math.round(n/r),e=t.MathUtils.floorPowerOfTwo(e)/2,n=1024,this.reflector.setSize(e,n)}}],r&&V(n.prototype,r),i&&V(n,i),Object.defineProperty(n,"prototype",{writable:!1}),a}(t.Group);var $=n(486);function K(t){var e,n=this,r=(e=4022871197,function(t){t=String(t);for(var n=0;n<t.length;n++){var r=.02519603282416938*(e+=t.charCodeAt(n));r-=e=r>>>0,e=(r*=e)>>>0,e+=4294967296*(r-=e)}return 2.3283064365386963e-10*(e>>>0)});n.random=function(){var t=2091639*n.s0+2.3283064365386963e-10*n.c;return n.s0=n.s1,n.s1=n.s2,n.s2=t-(n.c=0|t)},n.c=1,n.s0=r(" "),n.s1=r(" "),n.s2=r(" "),n.s0-=r(t),n.s0<0&&(n.s0+=1),n.s1-=r(t),n.s1<0&&(n.s1+=1),n.s2-=r(t),n.s2<0&&(n.s2+=1)}function Z(t,e){return Math.floor(Math.random()*(e-t+1)+t)}function tt(t){return Z(0,t)}const et={random:{int:Z,uint:tt,item:function(t){return t[tt(t.length-1)]},boolean:function(){return Math.random()<.5}}},nt=[["black","white","red","green","blue","pink","purple","orange","silver","golden","iron","stone","velvet","opal","ivory","coral","broken","pearl","silk","fire","ice","thunder","falling","rising","diamond","turquoise","ruby","emerald","onyx","lapis","jade","amber"],["shield","sword","spear","arrow","knight","king","queen","phoenix","box","garden","flower","apple","echo","gambit","fist","dragon","sun","moon","star","cloud","rain","wind","dawn","storm","eagle","tiger","lion","puma","wolf","panther","dove","fox"]],rt=[["loud","adorab","glad","zealous","grumpi","happi","polite","expert","awkward","warm","sincere","shy","quiet","lazi","mad","bold"].map((t=>`${t}ly`)),["beam","giggl","paint","smil","danc","laugh","sing","sneez","clapp","whistl","hopp","cheer","fly","greet","wav","juggl"].map((t=>`${t}ing`)),["smart","creative","bubbly","fun","cute","tiny","giant","laidback","upbeat","kind","cool","brave","dumb","tipsy","popular","generous"],["puppy","kitten","monkey","pumpkin","robot","nun","ninja","giraffe","baby","penguin","panda","koala","bear","wizard","pirate","knight"]],it="abcdefghijklmnopqrstuvwxyz".split(""),ot="aeiou".split(""),at=it.filter((t=>!ot.includes(t))),st={alphabet:it,vowels:ot,consonnants:at},ut={CODENAME:"codename",DESCRIPTION:"description",GIBBERISH:"gibberish",SERIAL:"serial"};const lt={NONE:"",DASH:"-",DOT:".",TILDE:"~",UNDERSCORE:"_"};let ct="";function ft(t){return et.random.item(t)}function ht(){const{verbose:t,separator:e}=gt;return(t?[...nt.map(ft),et.random.uint(999)]:nt.map(ft)).join(e)}function dt(){const{verbose:t,separator:e}=gt;return(t?rt:[rt[1],rt[3]]).map(ft).join(e)}function pt(){const{verbose:t}=gt,{vowels:e,consonnants:n}=st,r=t?8:4;return Array.from({length:r},((t,r)=>{const i=r%2?e:n;return et.random.item(i)})).join("")}function vt(){const{verbose:t}=gt,e=t?8:4,n=st.alphabet.filter((t=>!"ilo".includes(t)));return Array.from({length:e},(()=>gt.bool()?et.random.item(n).toUpperCase():et.random.int(1,9))).join("")}function mt(){const{mode:t}=gt,e={codename:ht,description:dt,gibberish:pt,serial:vt}[t]||ht;return gt.seed=e(),gt.seed}const gt={modes:ut,mode:ut.CODENAME,separators:lt,separator:lt.NONE,verbose:!1,prng:new K(ct),codename:ht,description:dt,gibberish:pt,serial:vt,autoseed:mt,reset:function(){gt.prng=new K(gt.seed)},random:function(t=0,e=1,n=!1){const{prng:r}=gt,i=r.random();return isNaN(t)||isNaN(e)?i:n?Math.floor(i*(e-t+1)+t):i*(e-t)+t},int:function(t,e){return gt.random(t,e,!0)},uint:function(t){return gt.int(0,t)},item:function(t){return t[gt.uint(t.length-1)]},bool:function(){return gt.random()<.5},char:function(t){return t.charAt(gt.uint(t.length-1))},get seed(){return ct},set seed(t){ct=t,this.reset()}};mt();const yt=gt;var xt=30,_t={defaults:{adjustments:{hue:0,saturation:1.5},bloom:{threshold:.6,strength:.2,radius:.8},orb:{passes:3,speed:6,smoothness:7,value1:.7,value2:.9,rotationSpeed:{x:0,y:9,z:0}}},random:{adjustments:{hue:{min:0,max:2*Math.PI},saturation:{min:0,max:3}},orb:{passes:{min:2,max:4,round:!0},speed:{min:1,max:xt,round:!0},smoothness:{min:5,max:10,round:!0},value1:{min:0,max:1},value2:{min:0,max:1}},rotationSpeed:{x:{min:-30,max:xt,round:!0},y:{min:-30,max:xt,round:!0},z:{min:-30,max:xt,round:!0}}}};const bt=GUI;var At={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform float opacity;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 texel = texture2D( tDiffuse, vUv );\n\t\t\tgl_FragColor = opacity * texel;\n\n\t\t}"};class Tt{constructor(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}const wt=new t.OrthographicCamera(-1,1,1,-1,0,1),St=new t.BufferGeometry;St.setAttribute("position",new t.Float32BufferAttribute([-1,3,0,-1,-1,0,3,-1,0],3)),St.setAttribute("uv",new t.Float32BufferAttribute([0,2,0,0,2,0],2));class Nt{constructor(e){this._mesh=new t.Mesh(St,e)}dispose(){this._mesh.geometry.dispose()}render(t){t.render(this._mesh,wt)}get material(){return this._mesh.material}set material(t){this._mesh.material=t}}class Ft extends Tt{constructor(e,n){super(),this.textureID=void 0!==n?n:"tDiffuse",e instanceof t.ShaderMaterial?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=t.UniformsUtils.clone(e.uniforms),this.material=new t.ShaderMaterial({defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new Nt(this.material)}render(t,e,n){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=n.texture),this.fsQuad.material=this.material,this.renderToScreen?(t.setRenderTarget(null),this.fsQuad.render(t)):(t.setRenderTarget(e),this.clear&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),this.fsQuad.render(t))}}class Pt extends Tt{constructor(t,e){super(),this.scene=t,this.camera=e,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(t,e,n){const r=t.getContext(),i=t.state;let o,a;i.buffers.color.setMask(!1),i.buffers.depth.setMask(!1),i.buffers.color.setLocked(!0),i.buffers.depth.setLocked(!0),this.inverse?(o=0,a=1):(o=1,a=0),i.buffers.stencil.setTest(!0),i.buffers.stencil.setOp(r.REPLACE,r.REPLACE,r.REPLACE),i.buffers.stencil.setFunc(r.ALWAYS,o,4294967295),i.buffers.stencil.setClear(a),i.buffers.stencil.setLocked(!0),t.setRenderTarget(n),this.clear&&t.clear(),t.render(this.scene,this.camera),t.setRenderTarget(e),this.clear&&t.clear(),t.render(this.scene,this.camera),i.buffers.color.setLocked(!1),i.buffers.depth.setLocked(!1),i.buffers.stencil.setLocked(!1),i.buffers.stencil.setFunc(r.EQUAL,1,4294967295),i.buffers.stencil.setOp(r.KEEP,r.KEEP,r.KEEP),i.buffers.stencil.setLocked(!0)}}class Lt extends Tt{constructor(){super(),this.needsSwap=!1}render(t){t.state.buffers.stencil.setLocked(!1),t.state.buffers.stencil.setTest(!1)}}new t.OrthographicCamera(-1,1,1,-1,0,1);const Ot=new t.BufferGeometry;Ot.setAttribute("position",new t.Float32BufferAttribute([-1,3,0,-1,-1,0,3,-1,0],3)),Ot.setAttribute("uv",new t.Float32BufferAttribute([0,2,0,0,2,0],2));class Et extends Tt{constructor(e,n,r,i,o){super(),this.scene=e,this.camera=n,this.overrideMaterial=r,this.clearColor=i,this.clearAlpha=void 0!==o?o:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new t.Color}render(t,e,n){const r=t.autoClear;let i,o;t.autoClear=!1,void 0!==this.overrideMaterial&&(o=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(t.getClearColor(this._oldClearColor),i=t.getClearAlpha(),t.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&t.clearDepth(),t.setRenderTarget(this.renderToScreen?null:n),this.clear&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),t.render(this.scene,this.camera),this.clearColor&&t.setClearColor(this._oldClearColor,i),void 0!==this.overrideMaterial&&(this.scene.overrideMaterial=o),t.autoClear=r}}class Ct{constructor(t={}){this.name=t.name,this.type=t.type,this.node=t.node,this.needsUpdate=t.needsUpdate}get value(){return this.node.value}set value(t){this.node.value=t}}const It={elements:["x","y","z","w"],addShortcuts:function(){function t(t,e,n){return n?{get:function(){return this[t][e][n]},set:function(r){this[t][e][n]=r}}:{get:function(){return this[t][e]},set:function(n){this[t][e]=n}}}return function(e,n,r){const i={};for(let e=0;e<r.length;++e){const o=r[e].split("."),a=o[0],s=o[1];i[a]=t(n,a,s)}Object.defineProperties(e,i)}}()},Ut={nodes:{},keywords:{},add:function(t){this.nodes[t.name]=t},addKeyword:function(t,e,n){n=void 0===n||n,this.keywords[t]={callback:e,cache:n}},remove:function(t){delete this.nodes[t.name]},removeKeyword:function(t){delete this.keywords[t]},get:function(t){return this.nodes[t]},getKeyword:function(t,e){return this.keywords[t].callback.call(this,e)},getKeywordData:function(t){return this.keywords[t]},contains:function(t){return void 0!==this.nodes[t]},containsKeyword:function(t){return void 0!==this.keywords[t]}};class Rt{constructor(e){this.uuid=t.MathUtils.generateUUID(),this.name="",this.type=e,this.userData={}}analyze(t,e={}){t.analyzing=!0,this.build(t.addFlow(e.slot,e.cache,e.context),"v4"),t.clearVertexNodeCode(),t.clearFragmentNodeCode(),t.removeFlow(),t.analyzing=!1}analyzeAndFlow(t,e,n={}){return this.analyze(t,n),this.flow(t,e,n)}flow(t,e,n={}){t.addFlow(n.slot,n.cache,n.context);const r={};return r.result=this.build(t,e),r.code=t.clearNodeCode(),r.extra=t.context.extra,t.removeFlow(),r}build(t,e,n){e=e||this.getType(t,e);const r=t.getNodeData(n||this);return t.analyzing&&this.appendDepsNode(t,r,e),-1===t.nodes.indexOf(this)&&t.nodes.push(this),void 0!==this.updateFrame&&-1===t.updaters.indexOf(this)&&t.updaters.push(this),this.generate(t,e,n)}generate(){}getHash(){let t,e,n="{";for(t in this)e=this[t],e instanceof Rt&&(n+='"'+t+'":'+e.getHash()+",");if(this.hashProperties)for(let r=0;r<this.hashProperties.length;r++)t=this.hashProperties[r],e=this[t],n+='"'+t+'":"'+String(e)+'",';return n+='"id":"'+this.uuid+'"}',n}appendDepsNode(t,e,n){e.deps=(e.deps||0)+1;const r=t.getTypeLength(n);(r>(e.outputMax||0)||this.getType(t,n))&&(e.outputMax=r,e.output=n)}setName(t){return this.name=t,this}getName(){return this.name}getType(t,e){return"sampler2D"===e||"samplerCube"===e?e:this.type}getJSONNode(t){if(!(void 0===t||"string"==typeof t)&&void 0!==t.nodes[this.uuid])return t.nodes[this.uuid]}copy(t){return void 0!==t.name&&(this.name=t.name),void 0!==t.userData&&(this.userData=JSON.parse(JSON.stringify(t.userData))),this}createJSONNode(t){const e=void 0===t||"string"==typeof t,n={};if("string"!=typeof this.nodeType)throw new Error("Node does not allow serialization.");return n.uuid=this.uuid,n.nodeType=this.nodeType,""!==this.name&&(n.name=this.name),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),e||(t.nodes[this.uuid]=n),n}toJSON(t){return this.getJSONNode(t)||this.createJSONNode(t)}}Rt.prototype.isNode=!0,Rt.prototype.hashProperties=void 0;class Mt extends Rt{constructor(t,e={}){super(t),this.shared=void 0===e.shared||e.shared,this.unique=void 0!==e.unique&&e.unique}build(e,n,r,i){if(n=n||this.getType(e),this.getShared(e,n)){const o=this.getUnique(e,n);o&&void 0===this.constructor.uuid&&(this.constructor.uuid=t.MathUtils.generateUUID()),r=e.getUuid(r||this.getUuid(),!o);const a=e.getNodeData(r),s=a.output||this.getType(e);if(e.analyzing)return(a.deps||0)>0||this.getLabel()?(this.appendDepsNode(e,a,n),this.generate(e,n,r)):super.build(e,n,r);if(o)return a.name=a.name||super.build(e,n,r),a.name;if(!this.getLabel()&&(!this.getShared(e,s)||e.context.ignoreCache||1===a.deps))return super.build(e,n,r);r=this.getUuid(!1);let u=this.getTemp(e,r);if(u)return e.format(u,s,n);{u=Mt.prototype.generate.call(this,e,n,r,a.output,i);const t=this.generate(e,s,r);return e.addNodeCode(u+" = "+t+";"),e.format(u,s,n)}}return super.build(e,n,r)}getShared(t,e){return"sampler2D"!==e&&"samplerCube"!==e&&this.shared}getUnique(){return this.unique}setLabel(t){return this.label=t,this}getLabel(){return this.label}getUuid(t){let e=(t||null==t)&&this.constructor.uuid||this.uuid;return"string"==typeof this.scope&&(e=this.scope+"-"+e),e}getTemp(t,e){e=e||this.uuid;const n=t.getVars()[e];return n?n.name:void 0}generate(t,e,n,r,i){return this.getShared(t,e)||console.error("THREE.TempNode is not shared!"),n=n||this.uuid,t.getTempVar(n,r||this.getType(t),i,this.getLabel()).name}}const zt=/^\s*([a-z_0-9]+)\s+([a-z_0-9]+)\s*\(([\s\S]*?)\)/i,Dt=/[a-z_0-9]+/gi;class Xt extends Mt{constructor(t,e,n,r,i){super(i),this.isMethod=void 0===i,this.isInterface=!1,this.parse(t,e,n,r)}getShared(){return!this.isMethod}getType(t){return t.getTypeByFormat(this.type)}getInputByName(t){let e=this.inputs.length;for(;e--;)if(this.inputs[e].name===t)return this.inputs[e]}getIncludeByName(t){let e=this.includes.length;for(;e--;)if(this.includes[e].name===t)return this.includes[e]}generate(t,e){let n,r=0,i=this.src;for(let e=0;e<this.includes.length;e++)t.include(this.includes[e],this);for(const e in this.extensions)t.extensions[e]=!0;const o=[];for(;n=Dt.exec(this.src);)o.push(n);for(let e=0;e<o.length;e++){const n=o[e],a=n[0],s=!this.isMethod||!this.getInputByName(a);let u=a;if(this.keywords[a]||this.useKeywords&&s&&Ut.containsKeyword(a)){let e=this.keywords[a];if(!e){const n=Ut.getKeywordData(a);n.cache&&(e=t.keywords[a]),e=e||Ut.getKeyword(a,t),n.cache&&(t.keywords[a]=e)}u=e.build(t)}a!==u&&(i=i.substring(0,n.index+r)+u+i.substring(n.index+a.length+r),r+=u.length-a.length),void 0===this.getIncludeByName(u)&&Ut.contains(u)&&t.include(Ut.get(u))}return"source"===e?i:this.isMethod?(this.isInterface||t.include(this,!1,i),this.name):t.format("( "+i+" )",this.getType(t),e)}parse(t,e,n,r){if(this.src=t||"",this.includes=e||[],this.extensions=n||{},this.keywords=r||{},this.isMethod){const t=this.src.match(zt);if(this.inputs=[],t&&4==t.length){this.type=t[1],this.name=t[2];const e=t[3].match(Dt);if(e){let t=0;for(;t<e.length;){let n,r=e[t++];"in"===r||"out"===r||"inout"===r?n=e[t++]:(n=r,r="");const i=e[t++];this.inputs.push({name:i,type:n,qualifier:r})}}this.isInterface=-1===this.src.indexOf("{")}else this.type="",this.name=""}}copy(t){return super.copy(t),this.isMethod=t.isMethod,this.useKeywords=t.useKeywords,this.parse(t.src,t.includes,t.extensions,t.keywords),void 0!==t.type&&(this.type=t.type),this}toJSON(t){let e=this.getJSONNode(t);if(!e){e=this.createJSONNode(t),e.src=this.src,e.isMethod=this.isMethod,e.useKeywords=this.useKeywords,this.isMethod||(e.type=this.type),e.extensions=JSON.parse(JSON.stringify(this.extensions)),e.keywords={};for(const n in this.keywords)e.keywords[n]=this.keywords[n].toJSON(t).uuid;if(this.includes.length){e.includes=[];for(let n=0;n<this.includes.length;n++)e.includes.push(this.includes[n].toJSON(t).uuid)}}return e}}Xt.prototype.nodeType="Function",Xt.prototype.useKeywords=!0;const jt=/^([a-z_0-9]+)\s([a-z_0-9]+)\s?\=?\s?(.*?)(\;|$)/i;class Jt extends Mt{constructor(t,e){super(),this.parse(t||Jt.PI,e)}getType(t){return t.getTypeByFormat(this.type)}parse(t,e){this.src=t||"";let n,r,i="";const o=this.src.match(jt);this.useDefine=e||"#"===this.src.charAt(0),o&&o.length>1?(r=o[1],n=o[2],i=o[3]):(n=this.src,r="f"),this.name=n,this.type=r,this.value=i}build(t,e){return"source"!==e?(t.include(this),t.format(this.name,this.getType(t),e)):this.value?this.useDefine?"#define "+this.name+" "+this.value:"const "+this.type+" "+this.name+" = "+this.value+";":this.useDefine?this.src:void 0}generate(t,e){return t.format(this.name,this.getType(t),e)}copy(t){return super.copy(t),this.parse(t.src,t.useDefine),this}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),e.src=this.src,!0===e.useDefine&&(e.useDefine=!0)),e}}Jt.prototype.nodeType="Const",Jt.PI="PI",Jt.PI2="PI2",Jt.RECIPROCAL_PI="RECIPROCAL_PI",Jt.RECIPROCAL_PI2="RECIPROCAL_PI2",Jt.LOG2="LOG2",Jt.EPSILON="EPSILON";const Qt=/^struct\s*([a-z_0-9]+)\s*{\s*((.|\n)*?)}/gim,kt=/\s*(\w*?)\s*(\w*?)(\=|\;)/gim;class Bt extends Mt{constructor(t){super(),this.parse(t)}getType(t){return t.getTypeByFormat(this.name)}getInputByName(t){let e=this.inputs.length;for(;e--;)if(this.inputs[e].name===t)return this.inputs[e]}generate(t,e){return"source"===e?this.src+";":t.format("( "+this.src+" )",this.getType(t),e)}parse(t=""){this.src=t,this.inputs=[];const e=Qt.exec(this.src);if(e){const t=e[2];let n;for(;n=kt.exec(t);)this.inputs.push({type:n[1],name:n[2]});this.name=e[1]}else this.name="";this.type=this.name}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),e.src=this.src),e}}Bt.prototype.nodeType="Struct";class Vt extends Mt{constructor(t,e){(e=e||{}).shared=void 0!==e.shared&&e.shared,super(t,e),this.readonly=!1}setReadonly(t){return this.readonly=t,this.hashProperties=this.readonly?["value"]:void 0,this}getReadonly(){return this.readonly}copy(t){return super.copy(t),void 0!==t.readonly&&(this.readonly=t.readonly),this}createJSONNode(t){const e=super.createJSONNode(t);return!0===this.readonly&&(e.readonly=this.readonly),e}generate(t,e,n,r,i,o){n=t.getUuid(n||this.getUuid()),r=r||this.getType(t);const a=t.getNodeData(n);return this.getReadonly(t)&&void 0!==this.generateReadonly?this.generateReadonly(t,e,n,r,i,o):t.isShader("vertex")?(a.vertex||(a.vertex=t.createVertexUniform(r,this,i,o,this.getLabel())),t.format(a.vertex.name,r,e)):(a.fragment||(a.fragment=t.createFragmentUniform(r,this,i,o,this.getLabel())),t.format(a.fragment.name,r,e))}}class Yt extends Vt{constructor(e,n){super("v2"),this.value=e instanceof t.Vector2?e:new t.Vector2(e,n)}generateReadonly(t,e,n,r){return t.format("vec2( "+this.x+", "+this.y+" )",r,e)}copy(t){return super.copy(t),this.value.copy(t),this}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),e.x=this.x,e.y=this.y,!0===this.readonly&&(e.readonly=!0)),e}}Yt.prototype.nodeType="Vector2",It.addShortcuts(Yt.prototype,"value",["x","y"]);class Ht extends Vt{constructor(e,n,r){super("v3"),this.value=e instanceof t.Vector3?e:new t.Vector3(e,n,r)}generateReadonly(t,e,n,r){return t.format("vec3( "+this.x+", "+this.y+", "+this.z+" )",r,e)}copy(t){return super.copy(t),this.value.copy(t),this}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),e.x=this.x,e.y=this.y,e.z=this.z,!0===this.readonly&&(e.readonly=!0)),e}}Ht.prototype.nodeType="Vector3",It.addShortcuts(Ht.prototype,"value",["x","y","z"]);class Wt extends Vt{constructor(e,n,r,i){super("v4"),this.value=e instanceof t.Vector4?e:new t.Vector4(e,n,r,i)}generateReadonly(t,e,n,r){return t.format("vec4( "+this.x+", "+this.y+", "+this.z+", "+this.w+" )",r,e)}copy(t){return super.copy(t),this.value.copy(t),this}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),e.x=this.x,e.y=this.y,e.z=this.z,e.w=this.w,!0===this.readonly&&(e.readonly=!0)),e}}Wt.prototype.nodeType="Vector4",It.addShortcuts(Wt.prototype,"value",["x","y","z","w"]);class Gt extends Mt{constructor(t){super("v2",{shared:!1}),this.index=t||0}generate(t,e){t.requires.uv[this.index]=!0;const n=this.index>0?this.index+1:"",r=t.isShader("vertex")?"uv"+n:"vUv"+n;return t.format(r,this.getType(t),e)}copy(t){return super.copy(t),this.index=t.index,this}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),e.index=this.index),e}}Gt.prototype.nodeType="UV",Ut.addKeyword("uv",(function(){return new Gt})),Ut.addKeyword("uv2",(function(){return new Gt(1)}));class qt extends Mt{constructor(t,e){super("v4"),this.input=t,this.method=e||qt.LINEAR_TO_LINEAR}generate(t,e){const n=this.input.build(t,"v4"),r=this.getType(t),i=qt.Nodes[this.method],o=t.include(i);if(o===qt.LINEAR_TO_LINEAR)return t.format(n,r,e);if(2===i.inputs.length){const i=this.factor.build(t,"f");return t.format(o+"( "+n+", "+i+" )",r,e)}return t.format(o+"( "+n+" )",r,e)}fromEncoding(t){const e=qt.getEncodingComponents(t);this.method="LinearTo"+e[0],this.factor=e[1]}fromDecoding(t){const e=qt.getEncodingComponents(t);this.method=e[0]+"ToLinear",this.factor=e[1]}copy(t){return super.copy(t),this.input=t.input,this.method=t.method,this}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),e.input=this.input.toJSON(t).uuid,e.method=this.method),e}}qt.Nodes={LinearToLinear:new Xt("\n\t\tvec4 LinearToLinear( in vec4 value ) {\n\n\t\t\treturn value;\n\n\t\t}"),sRGBToLinear:new Xt("\n\t\tvec4 sRGBToLinear( in vec4 value ) {\n\n\t\t\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );\n\n\t\t}"),LinearTosRGB:new Xt("\n\t\tvec4 LinearTosRGB( in vec4 value ) {\n\n\t\t\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );\n\n\t\t}")},qt.LINEAR_TO_LINEAR="LinearToLinear",qt.SRGB_TO_LINEAR="sRGBToLinear",qt.LINEAR_TO_SRGB="LinearTosRGB",qt.getEncodingComponents=function(e){switch(e){case t.LinearEncoding:return["Linear"];case t.sRGBEncoding:return["sRGB"]}},qt.prototype.nodeType="ColorSpace",qt.prototype.hashProperties=["method"];class $t extends Xt{constructor(t,e,n,r,i){super(t,i,r,n,e)}}$t.prototype.nodeType="Expression";class Kt extends Vt{constructor(t,e,n,r){super("v4",{shared:!0}),this.value=t,this.uv=e||new Gt,this.bias=n,this.project=void 0!==r&&r}getTexture(t,e){return super.generate(t,e,this.value.uuid,"t")}generate(t,e){if("sampler2D"===e)return this.getTexture(t,e);const n=this.getTexture(t,e),r=this.uv.build(t,this.project?"v4":"v2");let i,o,a=this.bias?this.bias.build(t,"f"):void 0;void 0===a&&t.context.bias&&(a=t.context.bias.setTexture(this).build(t,"f")),i=this.project?"texture2DProj":a?"tex2DBias":"tex2D",o=a?i+"( "+n+", "+r+", "+a+" )":i+"( "+n+", "+r+" )";const s={include:t.isShader("vertex"),ignoreCache:!0},u=this.getType(t);return t.addContext(s),this.colorSpace=this.colorSpace||new qt(new $t("",u)),this.colorSpace.fromDecoding(t.getTextureEncodingFromMap(this.value)),this.colorSpace.input.parse(o),o=this.colorSpace.build(t,u),t.removeContext(),t.format(o,u,e)}copy(t){return super.copy(t),t.value&&(this.value=t.value),this.uv=t.uv,t.bias&&(this.bias=t.bias),void 0!==t.project&&(this.project=t.project),this}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),this.value&&(e.value=this.value.uuid),e.uv=this.uv.toJSON(t).uuid,e.project=this.project,this.bias&&(e.bias=this.bias.toJSON(t).uuid)),e}}Kt.prototype.nodeType="Texture";class Zt extends Mt{constructor(t){super("v3"),this.scope=t||Zt.LOCAL}getType(){return this.scope===Zt.PROJECTION?"v4":this.type}getShared(){switch(this.scope){case Zt.LOCAL:case Zt.WORLD:return!1}return!0}generate(t,e){let n;switch(this.scope){case Zt.LOCAL:t.isShader("vertex")?n="transformed":(t.requires.position=!0,n="vPosition");break;case Zt.WORLD:if(t.isShader("vertex"))return"( modelMatrix * vec4( transformed, 1.0 ) ).xyz";t.requires.worldPosition=!0,n="vWPosition";break;case Zt.VIEW:n=t.isShader("vertex")?"-mvPosition.xyz":"vViewPosition";break;case Zt.PROJECTION:n=t.isShader("vertex")?"( projectionMatrix * modelViewMatrix * vec4( position, 1.0 ) )":"vec4( 0.0 )"}return t.format(n,this.getType(t),e)}copy(t){return super.copy(t),this.scope=t.scope,this}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),e.scope=this.scope),e}}Zt.LOCAL="local",Zt.WORLD="world",Zt.VIEW="view",Zt.PROJECTION="projection",Zt.prototype.nodeType="Position",Ut.addKeyword("position",(function(){return new Zt})),Ut.addKeyword("worldPosition",(function(){return new Zt(Zt.WORLD)})),Ut.addKeyword("viewPosition",(function(){return new Zt(Zt.VIEW)}));class te extends Mt{constructor(t){super("v3"),this.scope=t||te.VIEW}getShared(){return this.scope===te.WORLD}build(t,e,n,r){const i=t.context[this.scope+"Normal"];return i?i.build(t,e,n,r):super.build(t,e,n)}generate(t,e){let n;switch(this.scope){case te.VIEW:n=t.isShader("vertex")?"transformedNormal":"geometryNormal";break;case te.LOCAL:t.isShader("vertex")?n="objectNormal":(t.requires.normal=!0,n="vObjectNormal");break;case te.WORLD:t.isShader("vertex")?n="inverseTransformDirection( transformedNormal, viewMatrix ).xyz":(t.requires.worldNormal=!0,n="vWNormal")}return t.format(n,this.getType(t),e)}copy(t){return super.copy(t),this.scope=t.scope,this}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),e.scope=this.scope),e}}te.LOCAL="local",te.WORLD="world",te.VIEW="view",te.prototype.nodeType="Normal",Ut.addKeyword("viewNormal",(function(){return new te(te.VIEW)})),Ut.addKeyword("localNormal",(function(){return new te(te.NORMAL)})),Ut.addKeyword("worldNormal",(function(){return new te(te.WORLD)}));class ee extends Mt{constructor(t){super("v3"),this.scope=t||ee.CUBE}getUnique(t){return!t.context.viewNormal}getType(){return this.scope===ee.SPHERE?"v2":this.type}generate(t,e){const n=this.getUnique(t);if(t.isShader("fragment")){let r,i,o;switch(this.scope){case ee.VECTOR:const e=new te(te.VIEW),a=t.context.roughness,s=e.build(t,"v3"),u=new Zt(Zt.VIEW).build(t,"v3"),l=a?a.build(t,"f"):void 0;let c=`reflect( -normalize( ${u} ), ${s} )`;l&&(c=`normalize( mix( ${c}, ${s}, ${l} * ${l} ) )`),i=`inverseTransformDirection( ${c}, viewMatrix )`,n?(t.addNodeCode(`vec3 reflectVec = ${i};`),r="reflectVec"):r=i;break;case ee.CUBE:o=new ee(ee.VECTOR).build(t,"v3"),i="vec3( -"+o+".x, "+o+".yz )",n?(t.addNodeCode(`vec3 reflectCubeVec = ${i};`),r="reflectCubeVec"):r=i;break;case ee.SPHERE:o=new ee(ee.VECTOR).build(t,"v3"),i="normalize( ( viewMatrix * vec4( "+o+", 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) ).xy * 0.5 + 0.5",n?(t.addNodeCode(`vec2 reflectSphereVec = ${i};`),r="reflectSphereVec"):r=i}return t.format(r,this.getType(t),e)}return console.warn("THREE.ReflectNode is not compatible with "+t.shader+" shader."),t.format("vec3( 0.0 )",this.type,e)}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),e.scope=this.scope),e}}ee.CUBE="cube",ee.SPHERE="sphere",ee.VECTOR="vector",ee.prototype.nodeType="Reflect";class ne extends Vt{constructor(t,e,n){super("v4",{shared:!0}),this.value=t,this.uv=e||new ee,this.bias=n}getTexture(t,e){return super.generate(t,e,this.value.uuid,"tc")}generate(t,e){if("samplerCube"===e)return this.getTexture(t,e);const n=this.getTexture(t,e),r=this.uv.build(t,"v3");let i,o=this.bias?this.bias.build(t,"f"):void 0;void 0===o&&t.context.bias&&(o=t.context.bias.setTexture(this).build(t,"f")),i=o?"texCubeBias( "+n+", "+r+", "+o+" )":"texCube( "+n+", "+r+" )";const a={include:t.isShader("vertex"),ignoreCache:!0},s=this.getType(t);return t.addContext(a),this.colorSpace=this.colorSpace||new qt(new $t("",s)),this.colorSpace.fromDecoding(t.getTextureEncodingFromMap(this.value)),this.colorSpace.input.parse(i),i=this.colorSpace.build(t,s),t.removeContext(),t.format(i,s,e)}copy(t){return super.copy(t),t.value&&(this.value=t.value),this.uv=t.uv,t.bias&&(this.bias=t.bias),this}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),e.value=this.value.uuid,e.uv=this.uv.toJSON(t).uuid,this.bias&&(e.bias=this.bias.toJSON(t).uuid)),e}}ne.prototype.nodeType="CubeTexture";class re extends Vt{constructor(t){super("f"),this.value=t||0}generateReadonly(t,e,n,r){return t.format(this.value+(this.value%1?"":".0"),r,e)}copy(t){return super.copy(t),this.value=t.value,this}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),e.value=this.value,!0===this.readonly&&(e.readonly=!0)),e}}re.prototype.nodeType="Float";class ie extends Mt{constructor(t,e){super(),this.setFunction(t,e)}setFunction(t,e=[]){this.value=t,this.inputs=e}getFunction(){return this.value}getType(t){return this.value.getType(t)}generate(t,e){const n=this.getType(t),r=this.value;let i=r.build(t,e)+"( ";const o=[];for(let e=0;e<r.inputs.length;e++){const n=r.inputs[e],i=this.inputs[e]||this.inputs[n.name];o.push(i.build(t,t.getTypeByFormat(n.type)))}return i+=o.join(", ")+" )",t.format(i,n,e)}copy(t){super.copy(t);for(const e in t.inputs)this.inputs[e]=t.inputs[e];return this.value=t.value,this}toJSON(t){let e=this.getJSONNode(t);if(!e){const n=this.value;if(e=this.createJSONNode(t),e.value=this.value.toJSON(t).uuid,n.inputs.length){e.inputs={};for(let r=0;r<n.inputs.length;r++){const i=n.inputs[r],o=this.inputs[r]||this.inputs[i.name];e.inputs[i.name]=o.toJSON(t).uuid}}}return e}}ie.prototype.nodeType="FunctionCall";class oe extends Mt{constructor(t,e,n){super(),this.a=t,this.b=e,this.op=n}getType(t){const e=this.a.getType(t),n=this.b.getType(t);return t.isTypeMatrix(e)?"v4":t.getTypeLength(n)>t.getTypeLength(e)?n:e}generate(t,e){const n=this.getType(t),r=this.a.build(t,n),i=this.b.build(t,n);return t.format("( "+r+" "+this.op+" "+i+" )",n,e)}copy(t){return super.copy(t),this.a=t.a,this.b=t.b,this.op=t.op,this}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),e.a=this.a.toJSON(t).uuid,e.b=this.b.toJSON(t).uuid,e.op=this.op),e}}oe.ADD="+",oe.SUB="-",oe.MUL="*",oe.DIV="/",oe.prototype.nodeType="Operator";class ae extends Mt{constructor(t,e,n,r){super(),this.a=t,"string"!=typeof e?this.b=e:r=e,"string"!=typeof n?this.c=n:r=n,this.method=r}getNumInputs(){switch(this.method){case ae.ARCTAN:return this.b?2:1;case ae.MIX:case ae.CLAMP:case ae.REFRACT:case ae.SMOOTHSTEP:case ae.FACEFORWARD:return 3;case ae.MIN:case ae.MAX:case ae.MOD:case ae.STEP:case ae.REFLECT:case ae.DISTANCE:case ae.DOT:case ae.CROSS:case ae.POW:return 2;default:return 1}}getInputType(t){const e=t.getTypeLength(this.a.getType(t)),n=this.b?t.getTypeLength(this.b.getType(t)):0,r=this.c?t.getTypeLength(this.c.getType(t)):0;return e>n&&e>r?this.a.getType(t):n>r?this.b.getType(t):this.c.getType(t)}getType(t){switch(this.method){case ae.LENGTH:case ae.DISTANCE:case ae.DOT:return"f";case ae.CROSS:return"v3"}return this.getInputType(t)}generate(t,e){let n,r,i;const o=this.a?t.getTypeLength(this.a.getType(t)):0,a=this.b?t.getTypeLength(this.b.getType(t)):0,s=this.c?t.getTypeLength(this.c.getType(t)):0,u=this.getInputType(t),l=this.getType(t);switch(this.method){case ae.NEGATE:return t.format("( -"+this.a.build(t,u)+" )",u,e);case ae.INVERT:return t.format("( 1.0 - "+this.a.build(t,u)+" )",u,e);case ae.CROSS:n=this.a.build(t,"v3"),r=this.b.build(t,"v3");break;case ae.STEP:n=this.a.build(t,1===o?"f":u),r=this.b.build(t,u);break;case ae.MIN:case ae.MAX:case ae.MOD:n=this.a.build(t,u),r=this.b.build(t,1===a?"f":u);break;case ae.REFRACT:n=this.a.build(t,u),r=this.b.build(t,u),i=this.c.build(t,"f");break;case ae.MIX:n=this.a.build(t,u),r=this.b.build(t,u),i=this.c.build(t,1===s?"f":u);break;default:n=this.a.build(t,u),this.b&&(r=this.b.build(t,u)),this.c&&(i=this.c.build(t,u))}const c=[];c.push(n),r&&c.push(r),i&&c.push(i);const f=this.getNumInputs(t);if(c.length!==f)throw Error(`Arguments not match used in "${this.method}". Require ${f}, currently ${c.length}.`);return t.format(this.method+"( "+c.join(", ")+" )",l,e)}copy(t){return super.copy(t),this.a=t.a,this.b=t.b,this.c=t.c,this.method=t.method,this}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),e.a=this.a.toJSON(t).uuid,this.b&&(e.b=this.b.toJSON(t).uuid),this.c&&(e.c=this.c.toJSON(t).uuid),e.method=this.method),e}}ae.RAD="radians",ae.DEG="degrees",ae.EXP="exp",ae.EXP2="exp2",ae.LOG="log",ae.LOG2="log2",ae.SQRT="sqrt",ae.INV_SQRT="inversesqrt",ae.FLOOR="floor",ae.CEIL="ceil",ae.NORMALIZE="normalize",ae.FRACT="fract",ae.SATURATE="saturate",ae.SIN="sin",ae.COS="cos",ae.TAN="tan",ae.ASIN="asin",ae.ACOS="acos",ae.ARCTAN="atan",ae.ABS="abs",ae.SIGN="sign",ae.LENGTH="length",ae.NEGATE="negate",ae.INVERT="invert",ae.MIN="min",ae.MAX="max",ae.MOD="mod",ae.STEP="step",ae.REFLECT="reflect",ae.DISTANCE="distance",ae.DOT="dot",ae.CROSS="cross",ae.POW="pow",ae.MIX="mix",ae.CLAMP="clamp",ae.REFRACT="refract",ae.SMOOTHSTEP="smoothstep",ae.FACEFORWARD="faceforward",ae.prototype.nodeType="Math",ae.prototype.hashProperties=["method"];class se extends Mt{constructor(t,e,n){super("v4"),this.value=t,this.uv=e,this.bias=n}bilinearCubeUV(t,e,n,r){const i=new ie(se.Nodes.bilinearCubeUV,[e,n,r]);this.colorSpaceTL=this.colorSpaceTL||new qt(new $t("","v4")),this.colorSpaceTL.input.parse(i.build(t)+".tl"),this.colorSpaceTR=this.colorSpaceTR||new qt(new $t("","v4")),this.colorSpaceTR.input.parse(i.build(t)+".tr"),this.colorSpaceBL=this.colorSpaceBL||new qt(new $t("","v4")),this.colorSpaceBL.input.parse(i.build(t)+".bl"),this.colorSpaceBR=this.colorSpaceBR||new qt(new $t("","v4")),this.colorSpaceBR.input.parse(i.build(t)+".br");const o={include:t.isShader("vertex"),ignoreCache:!0};t.addContext(o),this.colorSpaceTLExp=new $t(this.colorSpaceTL.build(t,"v4"),"v4"),this.colorSpaceTRExp=new $t(this.colorSpaceTR.build(t,"v4"),"v4"),this.colorSpaceBLExp=new $t(this.colorSpaceBL.build(t,"v4"),"v4"),this.colorSpaceBRExp=new $t(this.colorSpaceBR.build(t,"v4"),"v4"),t.removeContext();const a=new $t("mix( mix( cubeUV_TL, cubeUV_TR, cubeUV.f.x ), mix( cubeUV_BL, cubeUV_BR, cubeUV.f.x ), cubeUV.f.y )","v4");return a.keywords.cubeUV_TL=this.colorSpaceTLExp,a.keywords.cubeUV_TR=this.colorSpaceTRExp,a.keywords.cubeUV_BL=this.colorSpaceBLExp,a.keywords.cubeUV_BR=this.colorSpaceBRExp,a.keywords.cubeUV=i,a}generate(t,e){if(t.isShader("fragment")){const n=this.uv,r=this.bias||t.context.roughness,i=new ie(se.Nodes.roughnessToMip,[r]),o=new ae(i,se.Nodes.m0,se.Nodes.cubeUV_maxMipLevel,ae.CLAMP),a=new ae(o,ae.FLOOR),s=new ae(o,ae.FRACT),u=this.bilinearCubeUV(t,this.value,n,a),l=this.bilinearCubeUV(t,this.value,n,new oe(a,new re(1).setReadonly(!0),oe.ADD)),c=new ae(u,l,s,ae.MIX);return t.format(c.build(t),"v4",e)}return console.warn("THREE.TextureCubeUVNode is not compatible with "+t.shader+" shader."),t.format("vec4( 0.0 )",this.getType(t),e)}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),e.value=this.value.toJSON(t).uuid,e.uv=this.uv.toJSON(t).uuid,e.bias=this.bias.toJSON(t).uuid),e}}se.Nodes=function(){const t=new Bt("struct TextureCubeUVData {\n\t\t\tvec4 tl;\n\t\t\tvec4 tr;\n\t\t\tvec4 br;\n\t\t\tvec4 bl;\n\t\t\tvec2 f;\n\t\t}"),e=new Jt("float cubeUV_maxMipLevel 8.0",!0),n=new Jt("float cubeUV_minMipLevel 4.0",!0),r=new Jt("float cubeUV_maxTileSize 256.0",!0),i=new Jt("float cubeUV_minTileSize 16.0",!0),o=new Xt("float getFace(vec3 direction) {\n\t\t\t\tvec3 absDirection = abs(direction);\n\t\t\t\tfloat face = -1.0;\n\t\t\t\tif (absDirection.x > absDirection.z) {\n\t\t\t\t\tif (absDirection.x > absDirection.y)\n\t\t\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\t\t\telse\n\t\t\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t\t\t} else {\n\t\t\t\t\tif (absDirection.z > absDirection.y)\n\t\t\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\t\t\telse\n\t\t\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t\t\t}\n\t\t\t\treturn face;\n\t\t}");o.useKeywords=!1;const a=new Xt("vec2 getUV(vec3 direction, float face) {\n\t\t\t\tvec2 uv;\n\t\t\t\tif (face == 0.0) {\n\t\t\t\t\tuv = vec2(direction.z, direction.y) / abs(direction.x); // pos x\n\t\t\t\t} else if (face == 1.0) {\n\t\t\t\t\tuv = vec2(-direction.x, -direction.z) / abs(direction.y); // pos y\n\t\t\t\t} else if (face == 2.0) {\n\t\t\t\t\tuv = vec2(-direction.x, direction.y) / abs(direction.z); // pos z\n\t\t\t\t} else if (face == 3.0) {\n\t\t\t\t\tuv = vec2(-direction.z, direction.y) / abs(direction.x); // neg x\n\t\t\t\t} else if (face == 4.0) {\n\t\t\t\t\tuv = vec2(-direction.x, direction.z) / abs(direction.y); // neg y\n\t\t\t\t} else {\n\t\t\t\t\tuv = vec2(direction.x, direction.y) / abs(direction.z); // neg z\n\t\t\t\t}\n\t\t\t\treturn 0.5 * (uv + 1.0);\n\t\t}");a.useKeywords=!1;const s=new Xt("TextureCubeUVData bilinearCubeUV(sampler2D envMap, vec3 direction, float mipInt) {\n\n\t\t\tfloat face = getFace(direction);\n\t\t\tfloat filterInt = max(cubeUV_minMipLevel - mipInt, 0.0);\n\t\t\tmipInt = max(mipInt, cubeUV_minMipLevel);\n\t\t\tfloat faceSize = exp2(mipInt);\n\n\t\t\tfloat texelSize = 1.0 / (3.0 * cubeUV_maxTileSize);\n\n\t\t\tvec2 uv = getUV(direction, face) * (faceSize - 1.0);\n\t\t\tvec2 f = fract(uv);\n\t\t\tuv += 0.5 - f;\n\t\t\tif (face > 2.0) {\n\t\t\t\tuv.y += faceSize;\n\t\t\t\tface -= 3.0;\n\t\t\t}\n\t\t\tuv.x += face * faceSize;\n\t\t\tif(mipInt < cubeUV_maxMipLevel){\n\t\t\t\tuv.y += 2.0 * cubeUV_maxTileSize;\n\t\t\t}\n\t\t\tuv.y += filterInt * 2.0 * cubeUV_minTileSize;\n\t\t\tuv.x += 3.0 * max(0.0, cubeUV_maxTileSize - 2.0 * faceSize);\n\t\t\tuv *= texelSize;\n\n\t\t\tvec4 tl = texture2D(envMap, uv);\n\t\t\tuv.x += texelSize;\n\t\t\tvec4 tr = texture2D(envMap, uv);\n\t\t\tuv.y += texelSize;\n\t\t\tvec4 br = texture2D(envMap, uv);\n\t\t\tuv.x -= texelSize;\n\t\t\tvec4 bl = texture2D(envMap, uv);\n\n\t\t\treturn TextureCubeUVData( tl, tr, br, bl, f );\n\t\t}",[t,o,a,e,n,r,i]);s.useKeywords=!1;const u=new Jt("float r0 1.0",!0),l=new Jt("float v0 0.339",!0),c=new Jt("float m0 -2.0",!0),f=new Jt("float r1 0.8",!0),h=new Jt("float v1 0.276",!0),d=new Jt("float m1 -1.0",!0),p=new Jt("float r4 0.4",!0),v=new Jt("float v4 0.046",!0),m=new Jt("float m4 2.0",!0),g=new Jt("float r5 0.305",!0),y=new Jt("float v5 0.016",!0),x=new Jt("float m5 3.0",!0),_=new Jt("float r6 0.21",!0),b=new Jt("float v6 0.0038",!0),A=new Jt("float m6 4.0",!0);return{bilinearCubeUV:s,roughnessToMip:new Xt("float roughnessToMip(float roughness) {\n\t\t\tfloat mip = 0.0;\n\t\t\tif (roughness >= r1) {\n\t\t\t\tmip = (r0 - roughness) * (m1 - m0) / (r0 - r1) + m0;\n\t\t\t} else if (roughness >= r4) {\n\t\t\t\tmip = (r1 - roughness) * (m4 - m1) / (r1 - r4) + m1;\n\t\t\t} else if (roughness >= r5) {\n\t\t\t\tmip = (r4 - roughness) * (m5 - m4) / (r4 - r5) + m4;\n\t\t\t} else if (roughness >= r6) {\n\t\t\t\tmip = (r5 - roughness) * (m6 - m5) / (r5 - r6) + m5;\n\t\t\t} else {\n\t\t\t\tmip = -2.0 * log2(1.16 * roughness);// 1.16 = 1.79^0.25\n\t\t\t}\n\t\t\treturn mip;\n\t\t}",[u,l,c,f,h,d,p,v,m,g,y,x,_,b,A]),m0:c,cubeUV_maxMipLevel:e}}(),se.prototype.nodeType="TextureCubeUV";class ue extends Mt{constructor(t,e,n){super("v4"),this.value=t,this.radianceNode=new se(this.value,e||new ee(ee.VECTOR),n),this.irradianceNode=new se(this.value,new te(te.WORLD),new re(1).setReadonly(!0))}generate(t,e){if(t.isShader("fragment")){t.require("irradiance"),t.context.bias&&t.context.bias.setTexture(this.value);return("irradiance"===t.slot?this.irradianceNode:this.radianceNode).build(t,e)}return console.warn("THREE.TextureCubeNode is not compatible with "+t.shader+" shader."),t.format("vec4( 0.0 )",this.getType(t),e)}copy(t){return super.copy(t),this.value=t.value,this}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),e.value=this.value.toJSON(t).uuid),e}}ue.prototype.nodeType="TextureCube";const le=It.elements,ce=["float","vec2","vec3","vec4"],fe={float:"f",vec2:"v2",vec3:"v3",vec4:"v4",mat4:"v4",int:"i",bool:"b"},he={t:"sampler2D",tc:"samplerCube",b:"bool",i:"int",f:"float",c:"vec3",v2:"vec2",v3:"vec3",v4:"vec4",m3:"mat3",m4:"mat4"};class de{constructor(){this.slots=[],this.caches=[],this.contexts=[],this.keywords={},this.nodeData={},this.requires={uv:[],color:[],lights:!1,fog:!1,transparent:!1,irradiance:!1},this.includes={consts:[],functions:[],structs:[]},this.attributes={},this.prefixCode="\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\n\t\t\t\t#define texCube(a, b) textureCube(a, b)\n\t\t\t\t#define texCubeBias(a, b, c) textureCubeLodEXT(a, b, c)\n\n\t\t\t\t#define tex2D(a, b) texture2D(a, b)\n\t\t\t\t#define tex2DBias(a, b, c) texture2DLodEXT(a, b, c)\n\n\t\t\t#else\n\n\t\t\t\t#define texCube(a, b) textureCube(a, b)\n\t\t\t\t#define texCubeBias(a, b, c) textureCube(a, b, c)\n\n\t\t\t\t#define tex2D(a, b) texture2D(a, b)\n\t\t\t\t#define tex2DBias(a, b, c) texture2D(a, b, c)\n\n\t\t\t#endif\n\n\t\t\t#include <packing>\n\t\t\t#include <common>",this.parsCode={vertex:"",fragment:""},this.code={vertex:"",fragment:""},this.nodeCode={vertex:"",fragment:""},this.resultCode={vertex:"",fragment:""},this.finalCode={vertex:"",fragment:""},this.inputs={uniforms:{list:[],vertex:[],fragment:[]},vars:{varying:[],vertex:[],fragment:[]}},this.defines={},this.uniforms={},this.extensions={},this.updaters=[],this.nodes=[],this.analyzing=!1}build(t,e){this.buildShader("vertex",t),this.buildShader("fragment",e);for(let t=0;t<this.requires.uv.length;t++)if(this.requires.uv[t]){const e=t>0?t+1:"";this.addVaryCode("varying vec2 vUv"+e+";"),t>0&&this.addVertexParsCode("attribute vec2 uv"+e+";"),this.addVertexFinalCode("vUv"+e+" = uv"+e+";")}return this.requires.color[0]&&(this.addVaryCode("varying vec4 vColor;"),this.addVertexParsCode("attribute vec4 color;"),this.addVertexFinalCode("vColor = color;")),this.requires.color[1]&&(this.addVaryCode("varying vec4 vColor2;"),this.addVertexParsCode("attribute vec4 color2;"),this.addVertexFinalCode("vColor2 = color2;")),this.requires.position&&(this.addVaryCode("varying vec3 vPosition;"),this.addVertexFinalCode("vPosition = transformed;")),this.requires.worldPosition&&(this.addVaryCode("varying vec3 vWPosition;"),this.addVertexFinalCode("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;")),this.requires.normal&&(this.addVaryCode("varying vec3 vObjectNormal;"),this.addVertexFinalCode("vObjectNormal = normal;")),this.requires.worldNormal&&(this.addVaryCode("varying vec3 vWNormal;"),this.addVertexFinalCode("vWNormal = inverseTransformDirection( transformedNormal, viewMatrix ).xyz;")),this}buildShader(t,e){this.resultCode[t]=e.build(this.setShader(t),"v4")}setMaterial(t,e){return this.material=t,this.renderer=e,this.requires.lights=t.lights,this.requires.fog=t.fog,this.mergeDefines(t.defines),this}addFlow(t,e,n){return this.addSlot(t).addCache(e).addContext(n)}removeFlow(){return this.removeSlot().removeCache().removeContext()}addCache(t){return this.cache=t||"",this.caches.push(this.cache),this}removeCache(){return this.caches.pop(),this.cache=this.caches[this.caches.length-1]||"",this}addContext(t){return this.context=Object.assign({},this.context,t),this.context.extra=this.context.extra||{},this.contexts.push(this.context),this}removeContext(){return this.contexts.pop(),this.context=this.contexts[this.contexts.length-1]||{},this}addSlot(t=""){return this.slot=t,this.slots.push(this.slot),this}removeSlot(){return this.slots.pop(),this.slot=this.slots[this.slots.length-1]||"",this}addVertexCode(t){this.addCode(t,"vertex")}addFragmentCode(t){this.addCode(t,"fragment")}addCode(t,e){this.code[e||this.shader]+=t+"\n"}addVertexNodeCode(t){this.addNodeCode(t,"vertex")}addFragmentNodeCode(t){this.addNodeCode(t,"fragment")}addNodeCode(t,e){this.nodeCode[e||this.shader]+=t+"\n"}clearNodeCode(t){t=t||this.shader;const e=this.nodeCode[t];return this.nodeCode[t]="",e}clearVertexNodeCode(){return this.clearNodeCode("vertex")}clearFragmentNodeCode(){return this.clearNodeCode("fragment")}addVertexFinalCode(t){this.addFinalCode(t,"vertex")}addFragmentFinalCode(t){this.addFinalCode(t,"fragment")}addFinalCode(t,e){this.finalCode[e||this.shader]+=t+"\n"}addVertexParsCode(t){this.addParsCode(t,"vertex")}addFragmentParsCode(t){this.addParsCode(t,"fragment")}addParsCode(t,e){this.parsCode[e||this.shader]+=t+"\n"}addVaryCode(t){this.addVertexParsCode(t),this.addFragmentParsCode(t)}isCache(t){return-1!==this.caches.indexOf(t)}isSlot(t){return-1!==this.slots.indexOf(t)}define(t,e){this.defines[t]=void 0===e?1:e}require(t){this.requires[t]=!0}isDefined(t){return void 0!==this.defines[t]}getVar(t,e,n,r="varying",i="V",o=""){const a=this.getVars(r);let s=a[t];if(!s){const r=a.length;s={name:n||"node"+i+r+(o?"_"+o:""),type:e},a.push(s),a[t]=s}return s}getTempVar(t,e,n,r){return this.getVar(t,e,n,this.shader,"T",r)}getAttribute(t,e){if(!this.attributes[t]){const n=this.getVar(t,e);this.addVertexParsCode("attribute "+e+" "+t+";"),this.addVertexFinalCode(n.name+" = "+t+";"),this.attributes[t]={varying:n,name:t,type:e}}return this.attributes[t]}getCode(t){return[this.prefixCode,this.parsCode[t],this.getVarListCode(this.getVars("varying"),"varying"),this.getVarListCode(this.inputs.uniforms[t],"uniform"),this.getIncludesCode("consts",t),this.getIncludesCode("structs",t),this.getIncludesCode("functions",t),"void main() {",this.getVarListCode(this.getVars(t)),this.code[t],this.resultCode[t],this.finalCode[t],"}"].join("\n")}getVarListCode(t,e=""){let n="";for(let r=0,i=t.length;r<i;++r){const i=t[r],o=i.type,a=i.name,s=this.getFormatByType(o);if(void 0===s)throw new Error("Node pars "+s+" not found.");n+=e+" "+s+" "+a+";\n"}return n}getVars(t){return this.inputs.vars[t||this.shader]}getNodeData(t){const e=t.isNode?t.uuid:t;return this.nodeData[e]=this.nodeData[e]||{}}createUniform(t,e,n,r,i,o){const a=this.inputs.uniforms,s=a.list.length,u=new Ct({type:e,name:r||"nodeU"+s+(o?"_"+o:""),node:n,needsUpdate:i});return a.list.push(u),a[t].push(u),a[t][u.name]=u,this.uniforms[u.name]=u,u}createVertexUniform(t,e,n,r,i){return this.createUniform("vertex",t,e,n,r,i)}createFragmentUniform(t,e,n,r,i){return this.createUniform("fragment",t,e,n,r,i)}include(t,e,n){let r;if(t="string"==typeof t?Ut.get(t):t,!1===this.context.include)return t.name;t instanceof Xt?r=this.includes.functions:t instanceof Jt?r=this.includes.consts:t instanceof Bt&&(r=this.includes.structs);const i=r[this.shader]=r[this.shader]||[];if(t){let r=i[t.name];if(r||(r=i[t.name]={node:t,deps:[]},i.push(r),r.src=t.build(this,"source")),t instanceof Xt&&e&&i[e.name]&&-1==i[e.name].deps.indexOf(t)&&(i[e.name].deps.push(t),t.includes&&t.includes.length)){let n=0;do{this.include(t.includes[n++],e)}while(n<t.includes.length)}return n&&(r.src=n),t.name}throw new Error("Include not found.")}colorToVectorProperties(t){return t.replace("r","x").replace("g","y").replace("b","z").replace("a","w")}colorToVector(t){return t.replace(/c/g,"v3")}getIncludes(t,e){return this.includes[t][e||this.shader]}getIncludesCode(t,e){let n=this.getIncludes(t,e);if(!n)return"";let r="";n=n.sort(pe);for(let t=0;t<n.length;t++)n[t].src&&(r+=n[t].src+"\n");return r}getConstructorFromLength(t){return ce[t-1]}isTypeMatrix(t){return/^m/.test(t)}getTypeLength(t){return"f"===t?1:parseInt(this.colorToVector(t).substr(1))}getTypeFromLength(t){return 1===t?"f":"v"+t}findNode(){for(let t=0;t<arguments.length;t++){const e=arguments[t];if(void 0!==e&&e.isNode)return e}}resolve(){for(let e=0;e<arguments.length;e++){const n=arguments[e];if(void 0!==n){if(n.isNode)return n;if(n.isTexture)switch(n.mapping){case t.CubeReflectionMapping:case t.CubeRefractionMapping:return new ne(n);case t.CubeUVReflectionMapping:case t.CubeUVRefractionMapping:return new ue(new Kt(n));default:return new Kt(n)}else{if(n.isVector2)return new Yt(n);if(n.isVector3)return new Ht(n);if(n.isVector4)return new Wt(n)}}}}format(t,e,n){switch(this.colorToVector(n+" <- "+e)){case"f <- v2":case"f <- v3":case"f <- v4":return t+".x";case"f <- i":case"f <- b":return"float( "+t+" )";case"v2 <- f":return"vec2( "+t+" )";case"v2 <- v3":case"v2 <- v4":return t+".xy";case"v2 <- i":case"v2 <- b":case"v3 <- i":case"v3 <- b":return"vec2( float( "+t+" ) )";case"v3 <- f":return"vec3( "+t+" )";case"v3 <- v2":return"vec3( "+t+", 0.0 )";case"v3 <- v4":return t+".xyz";case"v4 <- f":return"vec4( "+t+" )";case"v4 <- v2":return"vec4( "+t+", 0.0, 1.0 )";case"v4 <- v3":return"vec4( "+t+", 1.0 )";case"v4 <- i":case"v4 <- b":return"vec4( float( "+t+" ) )";case"i <- f":case"i <- b":return"int( "+t+" )";case"i <- v2":case"i <- v3":case"i <- v4":return"int( "+t+".x )";case"b <- f":return"( "+t+" != 0.0 )";case"b <- v2":return"( "+t+" != vec2( 0.0 ) )";case"b <- v3":return"( "+t+" != vec3( 0.0 ) )";case"b <- v4":return"( "+t+" != vec4( 0.0 ) )";case"b <- i":return"( "+t+" != 0 )"}return t}getTypeByFormat(t){return fe[t]||t}getFormatByType(t){return he[t]||t}getUuid(t,e){return(e=void 0===e||e)&&this.cache&&(t=this.cache+"-"+t),t}getElementByIndex(t){return le[t]}getIndexByElement(t){return le.indexOf(t)}isShader(t){return this.shader===t}setShader(t){return this.shader=t,this}mergeDefines(t){for(const e in t)this.defines[e]=t[e];return this.defines}mergeUniform(t){for(const e in t)this.uniforms[e]=t[e];return this.uniforms}getTextureEncodingFromMap(e){let n;return e?e.isTexture?n=e.encoding:e.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),n=e.texture.encoding):n=t.LinearEncoding,n===t.LinearEncoding&&this.context.gamma&&(n=t.sRGBEncoding),n}}function pe(t,e){return t.deps.length-e.deps.length}class ve extends Vt{constructor(e,n,r){super("c"),this.value=e instanceof t.Color?e:new t.Color(e||0,n,r)}generateReadonly(t,e,n,r){return t.format("vec3( "+this.r+", "+this.g+", "+this.b+" )",r,e)}copy(t){return super.copy(t),this.value.copy(t),this}toJSON(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).r=this.r,e.g=this.g,e.b=this.b,!0===this.readonly&&(e.readonly=!0)),e}}ve.prototype.nodeType="Color",It.addShortcuts(ve.prototype,"value",["r","g","b"]);class me extends Rt{constructor(t){super("v4"),this.value=t}generate(t){const e=this.value.analyzeAndFlow(t,this.type);let n=e.code+"\n";return t.isShader("vertex")?n+="gl_Position = "+e.result+";":n+="gl_FragColor = "+e.result+";",n}copy(t){return super.copy(t),this.value=t.value,this}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),e.value=this.value.toJSON(t).uuid),e}}me.prototype.nodeType="Raw";class ge extends t.ShaderMaterial{constructor(t,e){super(),this.vertex=t||new me(new Zt(Zt.PROJECTION)),this.fragment=e||new me(new ve(16711680)),this.updaters=[],this.type="NodeMaterial"}get properties(){return this.fragment.properties}get needsUpdate(){return this.needsCompile}set needsUpdate(t){!0===t&&this.version++,this.needsCompile=t}onBeforeCompile(t,e){this.build({renderer:e}),t.defines=this.defines,t.uniforms=this.uniforms,t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.extensionDerivatives=!0===this.extensions.derivatives,t.extensionFragDepth=!0===this.extensions.fragDepth,t.extensionDrawBuffers=!0===this.extensions.drawBuffers,t.extensionShaderTextureLOD=!0===this.extensions.shaderTextureLOD}customProgramCacheKey(){return this.getHash()}getHash(){let t="{";return t+='"vertex":'+this.vertex.getHash()+",",t+='"fragment":'+this.fragment.getHash(),t+="}",t}updateFrame(t){for(let e=0;e<this.updaters.length;++e)t.updateNode(this.updaters[e])}build(e={}){const n=e.builder||new de;return n.setMaterial(this,e.renderer),n.build(this.vertex,this.fragment),this.vertexShader=n.getCode("vertex"),this.fragmentShader=n.getCode("fragment"),this.defines=n.defines,this.uniforms=n.uniforms,this.extensions=n.extensions,this.updaters=n.updaters,this.fog=n.requires.fog,this.lights=n.requires.lights,this.transparent=n.requires.transparent||this.blending>t.NormalBlending,this}copy(t){const e=this.uuid;for(const e in t)this[e]=t[e];return this.uuid=e,void 0!==t.userData&&(this.userData=JSON.parse(JSON.stringify(t.userData))),this}toJSON(e){if((void 0===e||"string"==typeof e)&&(e={nodes:{}}),e&&!e.materials&&(e.materials={}),!e.materials[this.uuid]){const n={};n.uuid=this.uuid,n.type=this.type,e.materials[n.uuid]=n,""!==this.name&&(n.name=this.name),void 0!==this.size&&(n.size=this.size),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==t.NormalBlending&&(n.blending=this.blending),!0===this.flatShading&&(n.flatShading=this.flatShading),this.side!==t.FrontSide&&(n.side=this.side),this.vertexColors!==t.NoColors&&(n.vertexColors=this.vertexColors),this.depthFunc!==t.LessEqualDepth&&(n.depthFunc=this.depthFunc),!1===this.depthTest&&(n.depthTest=this.depthTest),!1===this.depthWrite&&(n.depthWrite=this.depthWrite),1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!1===this.visible&&(n.visible=!1),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),n.fog=this.fog,n.lights=this.lights,n.vertex=this.vertex.toJSON(e).uuid,n.fragment=this.fragment.toJSON(e).uuid}return e.material=this.uuid,e}}ge.prototype.isNodeMaterial=!0;class ye extends Kt{constructor(t){super(void 0,t)}getUnique(){return!0}getTexture(t,e){return Vt.prototype.generate.call(this,t,e,this.getUuid(),"t","renderTexture")}}ye.prototype.nodeType="Screen";class xe extends Ft{constructor(){super(),this.name="",this.uuid=t.MathUtils.generateUUID(),this.userData={},this.textureID="renderTexture",this.input=new ye,this.material=new ge,this.needsUpdate=!0}render(){this.needsUpdate&&(this.material.dispose(),this.material.fragment.value=this.input,this.needsUpdate=!1),this.uniforms=this.material.uniforms,super.render(...arguments)}copy(t){return this.input=t.input,this}toJSON(t){if((void 0===t||"string"==typeof t)&&(t={nodes:{}}),t&&!t.passes&&(t.passes={}),!t.passes[this.uuid]){var e={};e.uuid=this.uuid,e.type="NodePass",t.passes[this.uuid]=e,""!==this.name&&(e.name=this.name),"{}"!==JSON.stringify(this.userData)&&(e.userData=this.userData),e.input=this.input.toJSON(t).uuid}return t.pass=this.uuid,t}}(class extends Rt{constructor(t,e){super(t),this.value=e}getType(t){return t.getTypeByFormat(this.type)}generate(t,e){const n=t.getVar(this.uuid,this.type);return this.value&&t.isShader("vertex")&&t.addNodeCode(n.name+" = "+this.value.build(t,this.getType(t))+";"),t.format(n.name,this.getType(t),e)}copy(t){return super.copy(t),this.type=t.type,this.value=t.value,this}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),e.type=this.type,this.value&&(e.value=this.value.toJSON(t).uuid)),e}}).prototype.nodeType="Var";(class extends Rt{constructor(t,e){super(e),this.name=t}getAttributeType(t){return"number"==typeof this.type?t.getConstructorFromLength(this.type):this.type}getType(t){const e=this.getAttributeType(t);return t.getTypeByFormat(e)}generate(t,e){const n=this.getAttributeType(t),r=t.getAttribute(this.name,n),i=t.isShader("vertex")?this.name:r.varying.name;return t.format(i,this.getType(t),e)}copy(t){return super.copy(t),this.type=t.type,this}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),e.type=this.type),e}}).prototype.nodeType="Attribute";(class extends Vt{constructor(t){super("b"),this.value=Boolean(t)}generateReadonly(t,e,n,r){return t.format(this.value,r,e)}copy(t){return super.copy(t),this.value=t.value,this}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),e.value=this.value,!0===this.readonly&&(e.readonly=!0)),e}}).prototype.nodeType="Bool";class _e extends Vt{constructor(t){super("i"),this.value=Math.floor(t||0)}generateReadonly(t,e,n,r){return t.format(this.value,r,e)}copy(t){return super.copy(t),this.value=t.value,this}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),e.value=this.value,!0===this.readonly&&(e.readonly=!0)),e}}_e.prototype.nodeType="Int";class be extends Vt{constructor(e){super("m3"),this.value=e||new t.Matrix3}get elements(){return this.value.elements}set elements(t){this.value.elements=t}generateReadonly(t,e,n,r){return t.format("mat3( "+this.value.elements.join(", ")+" )",r,e)}copy(t){return super.copy(t),this.value.fromArray(t.elements),this}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),e.elements=this.value.elements.concat()),e}}be.prototype.nodeType="Matrix3";class Ae extends Vt{constructor(e){super("m4"),this.value=e||new t.Matrix4}get elements(){return this.value.elements}set elements(t){this.value.elements=t}generateReadonly(t,e,n,r){return t.format("mat4( "+this.value.elements.join(", ")+" )",r,e)}copy(t){return super.copy(t),this.scope.value.fromArray(t.elements),this}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),e.elements=this.value.elements.concat()),e}}Ae.prototype.nodeType="Matrix4";(class extends Mt{constructor(t){super("v4"),t&&this.setMirror(t)}setMirror(t){this.mirror=t,this.textureMatrix=new Ae(this.mirror.material.uniforms.textureMatrix.value),this.localPosition=new Zt(Zt.LOCAL),this.uv=new oe(this.textureMatrix,this.localPosition,oe.MUL),this.uvResult=new oe(null,this.uv,oe.ADD),this.texture=new Kt(this.mirror.material.uniforms.tDiffuse.value,this.uv,null,!0)}generate(t,e){return t.isShader("fragment")?(this.uvResult.a=this.offset,this.texture.uv=this.offset?this.uvResult:this.uv,"sampler2D"===e?this.texture.build(t,e):t.format(this.texture.build(t,this.type),this.type,e)):(console.warn("THREE.ReflectorNode is not compatible with "+t.shader+" shader."),t.format("vec4( 0.0 )",this.type,e))}copy(t){return Vt.prototype.copy.call(this,t),this.scope.mirror=t.mirror,this}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),e.mirror=this.mirror.uuid,this.offset&&(e.offset=this.offset.toJSON(t).uuid)),e}}).prototype.nodeType="Reflector";class Te extends Vt{constructor(t,e,n){super(n),this.object=t,this.property=e}get value(){return this.object[this.property]}set value(t){this.object[this.property]=t}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),e.value=this.value,e.property=this.property),e}}Te.prototype.nodeType="Property";(class extends Kt{constructor(e,n,r,i={}){const o=new t.WebGLRenderTarget(e,n,i);super(o.texture),this.input=r,this.clear=void 0===i.clear||i.clear,this.renderTarget=o,this.material=new ge,this.camera=new t.OrthographicCamera(-1,1,1,-1,0,1),this.scene=new t.Scene,this.quad=new t.Mesh(new t.PlaneGeometry(2,2),this.material),this.quad.frustumCulled=!1,this.scene.add(this.quad),this.render=!0}build(t,e,n){const r=new de;return r.nodes=t.nodes,r.updaters=t.updaters,this.material.fragment.value=this.input,this.material.build({builder:r}),super.build(t,e,n)}updateFramesaveTo(e){if(this.saveTo.render=!1,this.saveTo!==this.saveToCurrent){this.saveToMaterial&&this.saveToMaterial.dispose();const e=new ge;e.fragment.value=this,e.build();const n=new t.Scene,r=new t.Mesh(new t.PlaneGeometry(2,2),e);r.frustumCulled=!1,n.add(r),this.saveToScene=n,this.saveToMaterial=e}this.saveToCurrent=this.saveTo,e.renderer.setRenderTarget(this.saveTo.renderTarget),this.saveTo.clear&&e.renderer.clear(),e.renderer.render(this.saveToScene,this.camera)}updateFrame(t){t.renderer?(this.saveTo&&!1===this.saveTo.render&&this.updateFramesaveTo(t),this.render&&(this.material.uniforms.renderTexture&&(this.material.uniforms.renderTexture.value=t.renderTexture),t.renderer.setRenderTarget(this.renderTarget),this.clear&&t.renderer.clear(),t.renderer.render(this.scene,this.camera)),this.saveTo&&!0===this.saveTo.render&&this.updateFramesaveTo(t)):console.warn("RTTNode need a renderer in NodeFrame")}copy(t){return super.copy(t),this.saveTo=t.saveTo,this}toJSON(t){let e=this.getJSONNode(t);return e||(e=super.toJSON(t),this.saveTo&&(e.saveTo=this.saveTo.toJSON(t).uuid)),e}}).prototype.nodeType="RTT";var we=["color","color2"],Se=["vColor","vColor2"];(class extends Mt{constructor(t){super("v4",{shared:!1}),this.index=t||0}generate(t,e){t.requires.color[this.index]=!0;const n=t.isShader("vertex")?we[this.index]:Se[this.index];return t.format(n,this.getType(t),e)}copy(t){return super.copy(t),this.index=t.index,this}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),e.index=this.index),e}}).prototype.nodeType="Colors";class Ne extends Mt{constructor(t,e){super("v3"),this.setScope(t||Ne.POSITION),this.setCamera(e)}setCamera(t){this.camera=t,this.updateFrame=void 0!==t?this.onUpdateFrame:void 0}setScope(t){if(this.scope===Ne.DEPTH)delete this.near,delete this.far;if(this.scope=t,t===Ne.DEPTH){const t=this.camera;this.near=new re(t?t.near:1),this.far=new re(t?t.far:1200)}}getType(){return this.scope===Ne.DEPTH?"f":this.type}getUnique(){switch(this.scope){case Ne.DEPTH:case Ne.TO_VERTEX:return!0}return!1}getShared(){return this.scope!==Ne.POSITION}generate(t,e){let n;switch(this.scope){case Ne.POSITION:n="cameraPosition";break;case Ne.DEPTH:n=t.include(Ne.Nodes.depthColor)+"( "+this.near.build(t,"f")+", "+this.far.build(t,"f")+" )";break;case Ne.TO_VERTEX:n="normalize( "+new Zt(Zt.WORLD).build(t,"v3")+" - cameraPosition )"}return t.format(n,this.getType(t),e)}onUpdateFrame(){if(this.scope===Ne.DEPTH){const t=this.camera;this.near.value=t.near,this.far.value=t.far}}copy(t){if(super.copy(t),this.setScope(t.scope),t.camera&&this.setCamera(t.camera),t.scope===Ne.DEPTH)this.near.number=t.near,this.far.number=t.far;return this}toJSON(t){let e=this.getJSONNode(t);if(!e&&(e=this.createJSONNode(t),e.scope=this.scope,this.camera&&(e.camera=this.camera.uuid),this.scope===Ne.DEPTH))e.near=this.near.value,e.far=this.far.value;return e}}Ne.Nodes={depthColor:new Xt("\n\t\tfloat depthColor( float mNear, float mFar ) {\n\n\t\t\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\t\t\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;\n\n\t\t\t#else\n\n\t\t\t\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n\n\t\t\t#endif\n\n\t\t\treturn 1.0 - smoothstep( mNear, mFar, depth );\n\n\t\t}")},Ne.POSITION="position",Ne.DEPTH="depth",Ne.TO_VERTEX="toVertex",Ne.prototype.nodeType="Camera";class Fe extends Mt{constructor(t){super("v3",{shared:!1}),this.scope=t||Fe.TOTAL}generate(t,e){return t.isCache("light")?t.format("reflectedLight.directDiffuse",this.type,e):(console.warn('THREE.LightNode is only compatible in "light" channel.'),t.format("vec3( 0.0 )",this.type,e))}copy(t){return super.copy(t),this.scope=t.scope,this}toJSON(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).scope=this.scope),e}}Fe.TOTAL="total",Fe.prototype.nodeType="Light";class Pe extends Yt{constructor(){super(),this.size=new t.Vector2}updateFrame(t){if(t.renderer){t.renderer.getSize(this.size);const e=t.renderer.getPixelRatio();this.x=this.size.width*e,this.y=this.size.height*e}else console.warn("ResolutionNode need a renderer in NodeFrame")}copy(t){return super.copy(t),this.renderer=t.renderer,this}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),e.renderer=this.renderer.uuid),e}}Pe.prototype.nodeType="Resolution";(class extends Mt{constructor(t){super("v2"),this.resolution=t||new Pe}generate(t,e){let n;return t.isShader("fragment")?n="( gl_FragCoord.xy / "+this.resolution.build(t,"v2")+")":(console.warn("THREE.ScreenUVNode is not compatible with "+t.shader+" shader."),n="vec2( 0.0 )"),t.format(n,this.getType(t),e)}copy(t){return super.copy(t),this.resolution=t.resolution,this}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),e.resolution=this.resolution.toJSON(t).uuid),e}}).prototype.nodeType="ScreenUV";class Le extends Mt{constructor(t,e,n,r,i){super(),this.a=t,this.b=e,this.op=n,this.ifNode=r,this.elseNode=i}getType(t){if(this.ifNode){const e=this.ifNode.getType(t),n=this.elseNode.getType(t);return t.getTypeLength(n)>t.getTypeLength(e)?n:e}return"b"}getCondType(t){return t.getTypeLength(this.b.getType(t))>t.getTypeLength(this.a.getType(t))?this.b.getType(t):this.a.getType(t)}generate(t,e){const n=this.getType(t),r=this.getCondType(t),i=this.a.build(t,r),o=this.b.build(t,r);let a;if(this.ifNode){const e=this.ifNode.build(t,n),r=this.elseNode.build(t,n);a="( "+[i,this.op,o,"?",e,":",r].join(" ")+" )"}else a="( "+i+" "+this.op+" "+o+" )";return t.format(a,this.getType(t),e)}copy(t){return super.copy(t),this.a=t.a,this.b=t.b,this.op=t.op,this.ifNode=t.ifNode,this.elseNode=t.elseNode,this}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),e.a=this.a.toJSON(t).uuid,e.b=this.b.toJSON(t).uuid,e.op=this.op,e.ifNode&&(e.ifNode=this.ifNode.toJSON(t).uuid),e.elseNode&&(e.elseNode=this.elseNode.toJSON(t).uuid)),e}}Le.EQUAL="==",Le.NOT_EQUAL="!=",Le.GREATER=">",Le.GREATER_EQUAL=">=",Le.LESS="<",Le.LESS_EQUAL="<=",Le.AND="&&",Le.OR="||",Le.prototype.nodeType="Cond";const Oe="\nvec3 mod289( vec3 x ) {\n\n\treturn x - floor( x * ( 1.0 / 289.0 ) ) * 289.0;\n\n}\n\nvec4 mod289( vec4 x ) {\n\n\treturn x - floor( x * ( 1.0 / 289.0 ) ) * 289.0;\n\n}\n\nvec4 permute( vec4 x ) {\n\n\treturn mod289( ( ( x * 34.0 ) + 1.0 ) * x );\n\n}\n\nvec4 taylorInvSqrt( vec4 r ) {\n\n\treturn 1.79284291400159 - 0.85373472095314 * r;\n\n}\n\nvec2 fade( vec2 t ) {\n\n\treturn t * t * t * ( t * ( t * 6.0 - 15.0 ) + 10.0 );\n\n}\n\nvec3 fade( vec3 t ) {\n\n\treturn t * t * t * ( t * ( t * 6.0 - 15.0 ) + 10.0 );\n\n}\n".trim(),Ee="\nfloat noise2d( vec2 P, float amplitude, float pivot ) {\n\n\tvec4 Pi = floor(P.xyxy) + vec4(0.0, 0.0, 1.0, 1.0);\n\tvec4 Pf = fract(P.xyxy) - vec4(0.0, 0.0, 1.0, 1.0);\n\tPi = mod289(Pi); // To avoid truncation effects in permutation\n\tvec4 ix = Pi.xzxz;\n\tvec4 iy = Pi.yyww;\n\tvec4 fx = Pf.xzxz;\n\tvec4 fy = Pf.yyww;\n\n\tvec4 i = permute(permute(ix) + iy);\n\n\tvec4 gx = fract(i * (1.0 / 41.0)) * 2.0 - 1.0 ;\n\tvec4 gy = abs(gx) - 0.5 ;\n\tvec4 tx = floor(gx + 0.5);\n\tgx = gx - tx;\n\n\tvec2 g00 = vec2(gx.x,gy.x);\n\tvec2 g10 = vec2(gx.y,gy.y);\n\tvec2 g01 = vec2(gx.z,gy.z);\n\tvec2 g11 = vec2(gx.w,gy.w);\n\n\tvec4 norm = taylorInvSqrt(vec4(dot(g00, g00), dot(g01, g01), dot(g10, g10), dot(g11, g11)));\n\tg00 *= norm.x;\n\tg01 *= norm.y;\n\tg10 *= norm.z;\n\tg11 *= norm.w;\n\n\tfloat n00 = dot(g00, vec2(fx.x, fy.x));\n\tfloat n10 = dot(g10, vec2(fx.y, fy.y));\n\tfloat n01 = dot(g01, vec2(fx.z, fy.z));\n\tfloat n11 = dot(g11, vec2(fx.w, fy.w));\n\n\tvec2 fade_xy = fade(Pf.xy);\n\tvec2 n_x = mix(vec2(n00, n01), vec2(n10, n11), fade_xy.x);\n\tfloat n_xy = mix(n_x.x, n_x.y, fade_xy.y);\n\treturn 2.3 * n_xy * amplitude + pivot;\n\n}\n".trim();class Ce extends Mt{constructor(t=new Gt,e=new re(1),n=new re(0)){super("f"),this.uv=t,this.amplitude=e,this.pivot=n}generate(t,e){const n=new ie(Ce.Nodes.noise2d,[this.uv,this.amplitude,this.pivot]);return t.format(n.generate(t,e),this.getType(t),e)}copy(t){super.copy(t),this.uv=t.uv,this.amplitude=t.amplitude,this.pivot=t.pivot}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),e.uv=this.uv.toJSON(t).uuid,e.amplitude=this.amplitude.toJSON(t).uuid,e.pivot=this.pivot.toJSON(t).uuid),e}}Ce.prototype.nodeType="Noise2D",Ce.Nodes=function(){const t=new Xt(Oe),e=new Xt(Ee);return e.includes=[t],{noiseCommon:t,noise2d:e}}();const Ie="\nfloat noise3d( vec3 P, float amplitude, float pivot ) {\n\n\tvec3 Pi0 = floor(P); // Integer part for indexing\n\tvec3 Pi1 = Pi0 + vec3(1.0); // Integer part + 1\n\tPi0 = mod289(Pi0);\n\tPi1 = mod289(Pi1);\n\tvec3 Pf0 = fract(P); // Fractional part for interpolation\n\tvec3 Pf1 = Pf0 - vec3(1.0); // Fractional part - 1.0\n\tvec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);\n\tvec4 iy = vec4(Pi0.yy, Pi1.yy);\n\tvec4 iz0 = Pi0.zzzz;\n\tvec4 iz1 = Pi1.zzzz;\n\n\tvec4 ixy = permute(permute(ix) + iy);\n\tvec4 ixy0 = permute(ixy + iz0);\n\tvec4 ixy1 = permute(ixy + iz1);\n\n\tvec4 gx0 = ixy0 * (1.0 / 7.0);\n\tvec4 gy0 = fract(floor(gx0) * (1.0 / 7.0)) - 0.5;\n\tgx0 = fract(gx0);\n\tvec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);\n\tvec4 sz0 = step(gz0, vec4(0.0));\n\tgx0 -= sz0 * (step(0.0, gx0) - 0.5);\n\tgy0 -= sz0 * (step(0.0, gy0) - 0.5);\n\n\tvec4 gx1 = ixy1 * (1.0 / 7.0);\n\tvec4 gy1 = fract(floor(gx1) * (1.0 / 7.0)) - 0.5;\n\tgx1 = fract(gx1);\n\tvec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);\n\tvec4 sz1 = step(gz1, vec4(0.0));\n\tgx1 -= sz1 * (step(0.0, gx1) - 0.5);\n\tgy1 -= sz1 * (step(0.0, gy1) - 0.5);\n\n\tvec3 g000 = vec3(gx0.x,gy0.x,gz0.x);\n\tvec3 g100 = vec3(gx0.y,gy0.y,gz0.y);\n\tvec3 g010 = vec3(gx0.z,gy0.z,gz0.z);\n\tvec3 g110 = vec3(gx0.w,gy0.w,gz0.w);\n\tvec3 g001 = vec3(gx1.x,gy1.x,gz1.x);\n\tvec3 g101 = vec3(gx1.y,gy1.y,gz1.y);\n\tvec3 g011 = vec3(gx1.z,gy1.z,gz1.z);\n\tvec3 g111 = vec3(gx1.w,gy1.w,gz1.w);\n\n\tvec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));\n\tg000 *= norm0.x;\n\tg010 *= norm0.y;\n\tg100 *= norm0.z;\n\tg110 *= norm0.w;\n\tvec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));\n\tg001 *= norm1.x;\n\tg011 *= norm1.y;\n\tg101 *= norm1.z;\n\tg111 *= norm1.w;\n\n\tfloat n000 = dot(g000, Pf0);\n\tfloat n100 = dot(g100, vec3(Pf1.x, Pf0.yz));\n\tfloat n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));\n\tfloat n110 = dot(g110, vec3(Pf1.xy, Pf0.z));\n\tfloat n001 = dot(g001, vec3(Pf0.xy, Pf1.z));\n\tfloat n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));\n\tfloat n011 = dot(g011, vec3(Pf0.x, Pf1.yz));\n\tfloat n111 = dot(g111, Pf1);\n\n\tvec3 fade_xyz = fade(Pf0);\n\tvec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);\n\tvec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);\n\tfloat n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x);\n\treturn 2.2 * n_xyz * amplitude + pivot;\n\n}\n".trim();class Ue extends Mt{constructor(t=new Zt,e=new re(1),n=new re(0)){super("f"),this.position=t,this.amplitude=e,this.pivot=n}generate(t,e){const n=new ie(Ue.Nodes.noise3d,[this.position,this.amplitude,this.pivot]);return t.format(n.generate(t,e),this.getType(t),e)}copy(t){super.copy(t),this.position=t.position,this.amplitude=t.amplitude,this.pivot=t.pivot}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),e.position=this.position.toJSON(t).uuid,e.amplitude=this.amplitude.toJSON(t).uuid,e.pivot=this.pivot.toJSON(t).uuid),e}}Ue.prototype.nodeType="Noise3D",Ue.Nodes=function(){const t=new Xt(Ie);return t.includes=[Ce.Nodes.noiseCommon],{noise3d:t}}();class Re extends Mt{constructor(t){super("f"),this.uv=t||new Gt}generate(t,e){const n=t.include(Re.Nodes.checker);return t.format(n+"( "+this.uv.build(t,"v2")+" )",this.getType(t),e)}copy(t){return super.copy(t),this.uv=t.uv,this}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),e.uv=this.uv.toJSON(t).uuid),e}}Re.Nodes={checker:new Xt("\n\t\tfloat checker( vec2 uv ) {\n\n\t\t\tfloat cx = floor( uv.x );\n\t\t\tfloat cy = floor( uv.y );\n\t\t\tfloat result = mod( cx + cy, 2.0 );\n\n\t\t\treturn sign( result );\n\n\t\t}")},Re.prototype.nodeType="Noise";const Me="\nfloat fractal3d( vec3 p, float amplitude, int octaves, float lacunarity, float diminish ) {\n\n\tfloat result = 0.0;\n\n\tfor (int i = 0;  i < octaves; ++i) {\n\n\t\tresult += noise3d(p, amplitude, 0.0);\n\t\tamplitude *= diminish;\n\t\tp *= lacunarity;\n\n\t}\n\n\treturn result;\n\n}\n".trim();class ze extends Mt{constructor(t=new Zt,e=new re(1),n=3,r=2,i=.5){super("f"),this.position=t,this.amplitude=e,this.octaves=new _e(n).setReadonly(!0),this.lacunarity=new re(r).setReadonly(!0),this.diminish=new re(i).setReadonly(!0)}generate(t,e){const n=new ie(ze.Nodes.fractal3d,[this.position,this.amplitude,this.octaves,this.lacunarity,this.diminish]);return t.format(n.generate(t,e),this.getType(t),e)}copy(t){super.copy(t),this.position=t.position,this.amplitude=t.amplitude,this.octaves=t.octaves,this.lacunarity=t.lacunarity,this.diminish=t.diminish}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),e.position=this.position.toJSON(t).uuid,e.amplitude=this.amplitude.toJSON(t).uuid,e.octaves=this.octaves.toJSON(t).uuid,e.lacunarity=this.lacunarity.toJSON(t).uuid,e.diminish=this.diminish.toJSON(t).uuid),e}}ze.prototype.nodeType="Fractal3D",ze.Nodes=function(){const t=new Xt(Me);return t.includes=[Ue.Nodes.noise3d],{fractal3d:t}}();class De extends Mt{constructor(t,e){super("v3"),this.value=t,this.scale=e||new Yt(1,1)}generate(e,n){if(e.isShader("fragment")){const r=e.include(De.Nodes.perturbNormal2Arb);this.normal=this.normal||new te,this.position=this.position||new Zt(Zt.VIEW),this.uv=this.uv||new Gt;let i=this.scale.build(e,"v2");return e.material.side===t.BackSide&&(i="-"+i),e.format(r+"( -"+this.position.build(e,"v3")+", "+this.normal.build(e,"v3")+", "+this.value.build(e,"v3")+", "+this.uv.build(e,"v2")+", "+i+" )",this.getType(e),n)}return console.warn("THREE.NormalMapNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),n)}copy(t){return super.copy(t),this.value=t.value,this.scale=t.scale,this}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),e.value=this.value.toJSON(t).uuid,e.scale=this.scale.toJSON(t).uuid),e}}De.Nodes={perturbNormal2Arb:new Xt("vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 map, vec2 vUv, vec2 normalScale ) {\n\n\t\t// Workaround for Adreno 3XX dFd*( vec3 ) bug. See #9988\n\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\n\t\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s ); // we do not care about the magnitude\n\n\t\tvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n\t\tvec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n\t\tvec3 N = normalize( surf_norm );\n\n\t\tvec3 mapN = map * 2.0 - 1.0;\n\n\t\tmapN.xy *= normalScale;\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\t// Workaround for Adreno GPUs gl_FrontFacing bug. See #15850 and #10331\n\n\t\t\tif ( dot( cross( S, T ), N ) < 0.0 ) mapN.xy *= - 1.0;\n\n\t\t#else\n\n\t\t\tmapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\n\t\t#endif\n\n\t\tmat3 tsn = mat3( S, T, N );\n\t\treturn normalize( tsn * mapN );\n\n\t}",null,{derivatives:!0})},De.prototype.nodeType="NormalMap";class Xe extends Mt{constructor(t,e){super("v3"),this.value=t,this.scale=e||new re(1),this.toNormalMap=!1}generate(t,e){if(t.isShader("fragment")){if(this.toNormalMap){const n=t.include(Xe.Nodes.bumpToNormal);return t.format(n+"( "+this.value.build(t,"sampler2D")+", "+this.value.uv.build(t,"v2")+", "+this.scale.build(t,"f")+" )",this.getType(t),e)}{const n=t.include(Xe.Nodes.dHdxy_fwd),r=t.include(Xe.Nodes.perturbNormalArb);this.normal=this.normal||new te,this.position=this.position||new Zt(Zt.VIEW);const i=n+"( "+this.value.build(t,"sampler2D")+", "+this.value.uv.build(t,"v2")+", "+this.scale.build(t,"f")+" )";return t.format(r+"( -"+this.position.build(t,"v3")+", "+this.normal.build(t,"v3")+", "+i+" )",this.getType(t),e)}}return console.warn("THREE.BumpMapNode is not compatible with "+t.shader+" shader."),t.format("vec3( 0.0 )",this.getType(t),e)}copy(t){return super.copy(t),this.value=t.value,this.scale=t.scale,this}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),e.value=this.value.toJSON(t).uuid,e.scale=this.scale.toJSON(t).uuid),e}}Xe.Nodes=function(){const t=new Xt("\n\n\t\tvec2 dHdxy_fwd( sampler2D bumpMap, vec2 vUv, float bumpScale ) {\n\n\t\t\tvec2 dSTdx = dFdx( vUv );\n\t\t\tvec2 dSTdy = dFdy( vUv );\n\n\t\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\n\t\t\treturn vec2( dBx, dBy );\n\n\t\t}",null,{derivatives:!0});return{dHdxy_fwd:t,perturbNormalArb:new Xt("\n\n\t\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\n\t\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\t\tvec3 vN = surf_norm; // normalized\n\n\t\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\t\tvec3 R2 = cross( vN, vSigmaX );\n\n\t\t\tfloat fDet = dot( vSigmaX, R1 );\n\n\t\t\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\n\t\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\n\t\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\n\t\t}",[t],{derivatives:!0}),bumpToNormal:new Xt("\n\t\tvec3 bumpToNormal( sampler2D bumpMap, vec2 uv, float scale ) {\n\n\t\t\tvec2 dSTdx = dFdx( uv );\n\t\t\tvec2 dSTdy = dFdy( uv );\n\n\t\t\tfloat Hll = texture2D( bumpMap, uv ).x;\n\t\t\tfloat dBx = texture2D( bumpMap, uv + dSTdx ).x - Hll;\n\t\t\tfloat dBy = texture2D( bumpMap, uv + dSTdy ).x - Hll;\n\n\t\t\treturn vec3( .5 - ( dBx * scale ), .5 - ( dBy * scale ), 1.0 );\n\n\t\t}",null,{derivatives:!0})}}(),Xe.prototype.nodeType="BumpMap",Xe.prototype.hashProperties=["toNormalMap"];(class extends Rt{constructor(t,e){super(),this.code=t,this.value=e}getType(t){return this.value?this.value.getType(t):t.isShader("fragment")?"f":"void"}generate(t,e){const n=this.code.build(t,e)+";";return t.addNodeCode(n),t.isShader("vertex")?this.value?this.value.build(t,e):void 0:this.value?this.value.build(t,e):t.format("0.0","f",e)}copy(t){return super.copy(t),this.code=t.code,this.value=t.value,this}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),e.code=this.code.toJSON(t).uuid,this.value&&(e.value=this.value.toJSON(t).uuid)),e}}).prototype.nodeType="Bypass";const je=It.elements;(class extends Mt{constructor(t,e,n,r){super("f"),this.x=t,this.y=e,this.z=n,this.w=r}getNumElements(){let t=je.length;for(;t--;)if(void 0!==this[je[t]]){++t;break}return Math.max(t,2)}getType(t){return t.getTypeFromLength(this.getNumElements())}generate(t,e){const n=this.getType(t),r=this.getNumElements(),i=[];for(let e=0;e<r;e++){const n=this[je[e]];i.push(n?n.build(t,"f"):"0.0")}const o=(r>1?t.getConstructorFromLength(r):"")+"( "+i.join(", ")+" )";return t.format(o,n,e)}copy(t){super.copy(t);for(const e in t.inputs)this[e]=t.inputs[e];return this}toJSON(t){let e=this.getJSONNode(t);if(!e){e=this.createJSONNode(t),e.inputs={};const n=this.getNumElements();for(let r=0;r<n;r++){const n=this[je[r]];n&&(e.inputs[je[r]]=n.toJSON(t).uuid)}}return e}}).prototype.nodeType="Join";class Je extends Rt{constructor(t,e){super(),this.node=t,this.components=e||"x"}getType(t){return t.getTypeFromLength(this.components.length)}generate(t,e){const n=this.node.getType(t),r=t.getTypeLength(n)-1;let i=this.node.build(t,n);if(r>0){let n=0;const o=t.colorToVectorProperties(this.components);let a;const s=o.length;for(a=0;a<s;a++)n=Math.max(n,t.getIndexByElement(o.charAt(a)));for(n>r&&(n=r),i+=".",a=0;a<s;a++){let e=t.getIndexByElement(o.charAt(a));e>n&&(e=n),i+=t.getElementByIndex(e)}return t.format(i,this.getType(t),e)}return t.format(i,n,e)}copy(t){return super.copy(t),this.node=t.node,this.components=t.components,this}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),e.node=this.node.toJSON(t).uuid,e.components=this.components),e}}Je.prototype.nodeType="Switch";const Qe="\nfloat remap( float value, float inLow, float inHigh, float outLow, float outHigh ) {\n\n\tfloat x = ( value - inLow ) / ( inHigh - inLow );\n\treturn outLow + ( outHigh - outLow ) * x;\n\n}\n\nvec2 remap( vec2 value, vec2 inLow, vec2 inHigh, vec2 outLow, vec2 outHigh ) {\n\n\treturn vec2(\n\t\tremap( value.x, inLow.x, inHigh.x, outLow.x, outHigh.x ),\n\t\tremap( value.y, inLow.y, inHigh.y, outLow.y, outHigh.y )\n\t);\n\n}\n\nvec2 remap( vec2 value, float inLow, float inHigh, float outLow, float outHigh ) {\n\n\treturn vec2(\n\t\tremap( value.x, inLow, inHigh, outLow, outHigh ),\n\t\tremap( value.y, inLow, inHigh, outLow, outHigh )\n\t);\n\n}\n\nvec3 remap( vec3 value, vec3 inLow, vec3 inHigh, vec3 outLow, vec3 outHigh ) {\n\n\treturn vec3(\n\t\tremap( value.x, inLow.x, inHigh.x, outLow.x, outHigh.x ),\n\t\tremap( value.y, inLow.y, inHigh.y, outLow.y, outHigh.y ),\n\t\tremap( value.z, inLow.z, inHigh.z, outLow.z, outHigh.z )\n\t);\n\n}\n\nvec3 remap( vec3 value, float inLow, float inHigh, float outLow, float outHigh ) {\n\n\treturn vec3(\n\t\tremap( value.x, inLow, inHigh, outLow, outHigh ),\n\t\tremap( value.y, inLow, inHigh, outLow, outHigh ),\n\t\tremap( value.z, inLow, inHigh, outLow, outHigh )\n\t);\n\n}\n\nvec4 remap( vec4 value, vec4 inLow, vec4 inHigh, vec4 outLow, vec4 outHigh ) {\n\n\treturn vec4(\n\t\tremap( value.x, inLow.x, inHigh.x, outLow.x, outHigh.x ),\n\t\tremap( value.y, inLow.y, inHigh.y, outLow.y, outHigh.y ),\n\t\tremap( value.z, inLow.z, inHigh.z, outLow.z, outHigh.z ),\n\t\tremap( value.w, inLow.w, inHigh.w, outLow.w, outHigh.w )\n\t);\n\n}\n\nvec4 remap( vec4 value, float inLow, float inHigh, float outLow, float outHigh ) {\n\n\treturn vec4(\n\t\tremap( value.x, inLow, inHigh, outLow, outHigh ),\n\t\tremap( value.y, inLow, inHigh, outLow, outHigh ),\n\t\tremap( value.z, inLow, inHigh, outLow, outHigh ),\n\t\tremap( value.w, inLow, inHigh, outLow, outHigh )\n\t);\n\n}\n".trim();class ke extends Mt{constructor(t,e,n,r,i){super("f"),this.value=t,this.inLow=e,this.inHigh=n,this.outLow=r,this.outHigh=i}generate(t,e){const n=t.include(ke.Nodes.remap);return t.format(n+"( "+[this.value.build(t),this.inLow.build(t),this.inHigh.build(t),this.outLow.build(t),this.outHigh.build(t)].join(", ")+" )",this.getType(t),e)}getType(t){return this.value.getType(t)}copy(t){super.copy(t),this.value=t.value,this.inLow=t.inLow,this.inHigh=t.inHigh,this.outLow=t.outLow,this.outHigh=t.outHigh}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),e.value=this.value.toJSON(t).uuid,e.inLow=this.inLow.toJSON(t).uuid,e.inHigh=this.inHigh.toJSON(t).uuid,e.outLow=this.outLow.toJSON(t).uuid,e.outHigh=this.outHigh.toJSON(t).uuid),e}}ke.prototype.nodeType="Remap",ke.Nodes={remap:new Xt(Qe)};class Be extends re{constructor(t,e,n){super(),this.scale=void 0!==t?t:1,this.scope=e||Be.GLOBAL,this.timeScale=void 0!==n?n:void 0!==t}getReadonly(){return!1}getUnique(){return this.timeScale&&(this.scope===Be.GLOBAL||this.scope===Be.DELTA)}updateFrame(t){const e=this.timeScale?this.scale:1;switch(this.scope){case Be.LOCAL:this.value+=t.delta*e;break;case Be.DELTA:this.value=t.delta*e;break;default:this.value=t.time*e}}copy(t){return super.copy(t),this.scope=t.scope,this.scale=t.scale,this.timeScale=t.timeScale,this}toJSON(t){const e=super.toJSON(t);return e.scope=this.scope,e.scale=this.scale,e.timeScale=this.timeScale,e}}Be.GLOBAL="global",Be.LOCAL="local",Be.DELTA="delta",Be.prototype.nodeType="Timer",Ut.addKeyword("time",(function(){return new Be}));(class extends Ht{constructor(e,n){super(),this.params={},this.velocity=new t.Vector3,this.setTarget(e),this.setParams(n)}getReadonly(){return!1}setParams(e){if("elastic"===this.params.type)delete this.moment,delete this.speed,delete this.springVelocity,delete this.lastVelocity;if(this.params=e||{},"elastic"===this.params.type)this.moment=new t.Vector3,this.speed=new t.Vector3,this.springVelocity=new t.Vector3,this.lastVelocity=new t.Vector3}setTarget(e){this.target&&(delete this.position,delete this.oldPosition),this.target=e,e&&(this.position=e.getWorldPosition(this.position||new t.Vector3),this.oldPosition=this.position.clone())}updateFrameVelocity(){this.target&&(this.position=this.target.getWorldPosition(this.position||new t.Vector3),this.velocity.subVectors(this.position,this.oldPosition),this.oldPosition.copy(this.position))}updateFrame(t){if(this.updateFrameVelocity(t),"elastic"===this.params.type){const e=t.delta*(this.params.fps||60),n=Math.pow(this.params.spring,e),r=Math.pow(this.params.damping,e);this.velocity.multiplyScalar(Math.exp(-this.params.damping*e)),this.velocity.add(this.springVelocity),this.velocity.add(this.speed.multiplyScalar(r).multiplyScalar(1-n)),this.speed.subVectors(this.velocity,this.lastVelocity),this.springVelocity.add(this.speed),this.springVelocity.multiplyScalar(n),this.moment.add(this.springVelocity),this.moment.multiplyScalar(r),this.lastVelocity.copy(this.velocity),this.value.copy(this.moment)}else this.value.copy(this.velocity)}copy(t){return super.copy(t),t.target&&this.setTarget(t.target),this.setParams(t.params),this}toJSON(t){const e=super.toJSON(t);return this.target&&(e.target=this.target.uuid),e.params=JSON.parse(JSON.stringify(this.params)),e}}).prototype.nodeType="Velocity";(class extends $t{constructor(t,e){super("( uvTransform * vec3( uvNode, 1 ) ).xy","vec2"),this.uv=t||new Gt,this.position=e||new be}generate(t,e){return this.keywords.uvNode=this.uv,this.keywords.uvTransform=this.position,super.generate(t,e)}setUvTransform(t,e,n,r,i,o,a){o=void 0!==o?o:.5,a=void 0!==a?a:.5,this.position.value.setUvTransform(t,e,n,r,i,o,a)}copy(t){return super.copy(t),this.uv=t.uv,this.position=t.position,this}toJSON(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).uv=this.uv.toJSON(t).uuid,e.position=this.position.toJSON(t).uuid),e}}).prototype.nodeType="UVTransform";class Ve extends re{constructor(t){super(),this.texture=t,this.maxMIPLevel=0}get value(){if(0===this.maxMIPLevel){var t=this.texture.value.image;Array.isArray(t)&&(t=t[0]),this.maxMIPLevel=void 0!==t?Math.log(Math.max(t.width,t.height))*Math.LOG2E:0}return this.maxMIPLevel}set value(t){}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),e.texture=this.texture.uuid),e}}Ve.prototype.nodeType="MaxMIPLevel";class Ye extends Mt{constructor(t,e){super("f"),this.roughness=t,this.texture=e,this.maxMIPLevel=void 0}setTexture(t){return this.texture=t,this}generate(t,e){if(t.isShader("fragment")){this.maxMIPLevel=this.maxMIPLevel||new Ve,this.maxMIPLevel.texture=this.texture;const n=t.include(Ye.Nodes.getSpecularMIPLevel);return t.format(n+"( "+this.roughness.build(t,"f")+", "+this.maxMIPLevel.build(t,"f")+" )",this.type,e)}return console.warn("THREE.SpecularMIPLevelNode is not compatible with "+t.shader+" shader."),t.format("0.0",this.type,e)}copy(t){return super.copy(t),this.texture=t.texture,this.roughness=t.roughness,this}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),e.texture=this.texture,e.roughness=this.roughness),e}}Ye.Nodes={getSpecularMIPLevel:new Xt("\n\n\t\tfloat getSpecularMIPLevel( const in float roughness, const in float maxMIPLevelScalar ) {\n\n\t\t\tfloat sigma = PI * roughness * roughness / ( 1.0 + roughness );\n\t\t\tfloat desiredMIPLevel = maxMIPLevelScalar + log2( sigma );\n\n\t\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\n\t\t}")},Ye.prototype.nodeType="SpecularMIPLevel";(class extends Mt{constructor(t){super(),this.slots=t||{}}getType(t,e){return e}generate(t,e){return this.slots[t.slot]?this.slots[t.slot].build(t,e):t.format("0.0","f",e)}copy(t){super.copy(t);for(const e in t.slots)this.slots[e]=t.slots[e];return this}toJSON(t){let e=this.getJSONNode(t);if(!e){e=this.createJSONNode(t),e.slots={};for(const n in this.slots){const r=this.slots[n];r&&(e.slots[n]=r.toJSON(t).uuid)}}return e}}).prototype.nodeType="SubSlot";class He extends Mt{constructor(t,e,n,r){super("v4"),this.value=t,this.uv=e||new Gt,this.radius=n||new Yt(1,1),this.size=r,this.blurX=!0,this.blurY=!0,this.horizontal=new re(1/64),this.vertical=new re(1/64)}updateFrame(){if(this.size)this.horizontal.value=this.radius.x/this.size.x,this.vertical.value=this.radius.y/this.size.y;else if(this.value.value&&this.value.value.image){const t=this.value.value.image;this.horizontal.value=this.radius.x/t.width,this.vertical.value=this.radius.y/t.height}}generate(t,e){if(t.isShader("fragment")){const n=[];let r;const i=t.include(He.Nodes.blurX),o=t.include(He.Nodes.blurY);return this.blurX&&n.push(i+"( "+this.value.build(t,"sampler2D")+", "+this.uv.build(t,"v2")+", "+this.horizontal.build(t,"f")+" )"),this.blurY&&n.push(o+"( "+this.value.build(t,"sampler2D")+", "+this.uv.build(t,"v2")+", "+this.vertical.build(t,"f")+" )"),r=2==n.length?"( "+n.join(" + ")+" / 2.0 )":n.length?"( "+n[0]+" )":"vec4( 0.0 )",t.format(r,this.getType(t),e)}return console.warn("THREE.BlurNode is not compatible with "+t.shader+" shader."),t.format("vec4( 0.0 )",this.getType(t),e)}copy(e){return super.copy(e),this.value=e.value,this.uv=e.uv,this.radius=e.radius,void 0!==e.size&&(this.size=new t.Vector2(e.size.x,e.size.y)),this.blurX=e.blurX,this.blurY=e.blurY,this}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),e.value=this.value.toJSON(t).uuid,e.uv=this.uv.toJSON(t).uuid,e.radius=this.radius.toJSON(t).uuid,this.size&&(e.size={x:this.size.x,y:this.size.y}),e.blurX=this.blurX,e.blurY=this.blurY),e}}He.Nodes={blurX:new Xt("\n\t\tvec4 blurX( sampler2D tex, vec2 uv, float s ) {\n\t\t\tvec4 sum = vec4( 0.0 );\n\t\t\tsum += texture2D( tex, vec2( uv.x - 4.0 * s, uv.y ) ) * 0.051;\n\t\t\tsum += texture2D( tex, vec2( uv.x - 3.0 * s, uv.y ) ) * 0.0918;\n\t\t\tsum += texture2D( tex, vec2( uv.x - 2.0 * s, uv.y ) ) * 0.12245;\n\t\t\tsum += texture2D( tex, vec2( uv.x - 1.0 * s, uv.y ) ) * 0.1531;\n\t\t\tsum += texture2D( tex, vec2( uv.x, uv.y ) ) * 0.1633;\n\t\t\tsum += texture2D( tex, vec2( uv.x + 1.0 * s, uv.y ) ) * 0.1531;\n\t\t\tsum += texture2D( tex, vec2( uv.x + 2.0 * s, uv.y ) ) * 0.12245;\n\t\t\tsum += texture2D( tex, vec2( uv.x + 3.0 * s, uv.y ) ) * 0.0918;\n\t\t\tsum += texture2D( tex, vec2( uv.x + 4.0 * s, uv.y ) ) * 0.051;\n\t\t\treturn sum * .667;\n\t\t}"),blurY:new Xt("\n\t\tvec4 blurY( sampler2D tex, vec2 uv, float s ) {\n\t\t\tvec4 sum = vec4( 0.0 );\n\t\t\tsum += texture2D( tex, vec2( uv.x, uv.y - 4.0 * s ) ) * 0.051;\n\t\t\tsum += texture2D( tex, vec2( uv.x, uv.y - 3.0 * s ) ) * 0.0918;\n\t\t\tsum += texture2D( tex, vec2( uv.x, uv.y - 2.0 * s ) ) * 0.12245;\n\t\t\tsum += texture2D( tex, vec2( uv.x, uv.y - 1.0 * s ) ) * 0.1531;\n\t\t\tsum += texture2D( tex, vec2( uv.x, uv.y ) ) * 0.1633;\n\t\t\tsum += texture2D( tex, vec2( uv.x, uv.y + 1.0 * s ) ) * 0.1531;\n\t\t\tsum += texture2D( tex, vec2( uv.x, uv.y + 2.0 * s ) ) * 0.12245;\n\t\t\tsum += texture2D( tex, vec2( uv.x, uv.y + 3.0 * s ) ) * 0.0918;\n\t\t\tsum += texture2D( tex, vec2( uv.x, uv.y + 4.0 * s ) ) * 0.051;\n\t\t\treturn sum * .667;\n\t\t}")},He.prototype.nodeType="Blur",He.prototype.hashProperties=["blurX","blurY"];class We extends Mt{constructor(t){super("f"),this.rgb=t}generate(t,e){const n=t.include(We.Nodes.luminance);return t.format(n+"( "+this.rgb.build(t,"v3")+" )",this.getType(t),e)}copy(t){return super.copy(t),this.rgb=t.rgb,this}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),e.rgb=this.rgb.toJSON(t).uuid),e}}We.Nodes=function(){const t=new Jt("vec3 LUMA vec3( 0.2125, 0.7154, 0.0721 )");return{LUMA:t,luminance:new Xt("\n\n\t\tfloat luminance( vec3 rgb ) {\n\n\t\t\treturn dot( rgb, LUMA );\n\n\t\t}",[t])}}(),We.prototype.nodeType="Luminance";class Ge extends Mt{constructor(t,e,n){super("v3"),this.rgb=t,this.adjustment=e,this.method=n||Ge.SATURATION}generate(t,e){const n=this.rgb.build(t,"v3"),r=this.adjustment.build(t,"f");switch(this.method){case Ge.BRIGHTNESS:return t.format("( "+n+" + "+r+" )",this.getType(t),e);case Ge.CONTRAST:return t.format("( "+n+" * "+r+" )",this.getType(t),e)}const i=t.include(Ge.Nodes[this.method]);return t.format(i+"( "+n+", "+r+" )",this.getType(t),e)}copy(t){return super.copy(t),this.rgb=t.rgb,this.adjustment=t.adjustment,this.method=t.method,this}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),e.rgb=this.rgb.toJSON(t).uuid,e.adjustment=this.adjustment.toJSON(t).uuid,e.method=this.method),e}}Ge.Nodes={hue:new Xt("\n\t\tvec3 hue(vec3 rgb, float adjustment) {\n\n\t\t\tconst mat3 RGBtoYIQ = mat3(0.299, 0.587, 0.114, 0.595716, -0.274453, -0.321263, 0.211456, -0.522591, 0.311135);\n\t\t\tconst mat3 YIQtoRGB = mat3(1.0, 0.9563, 0.6210, 1.0, -0.2721, -0.6474, 1.0, -1.107, 1.7046);\n\n\t\t\tvec3 yiq = RGBtoYIQ * rgb;\n\n\t\t\tfloat hue = atan(yiq.z, yiq.y) + adjustment;\n\t\t\tfloat chroma = sqrt(yiq.z * yiq.z + yiq.y * yiq.y);\n\n\t\t\treturn YIQtoRGB * vec3(yiq.x, chroma * cos(hue), chroma * sin(hue));\n\n\t\t}"),saturation:new Xt("\n\t\tvec3 saturation(vec3 rgb, float adjustment) {\n\n\t\t\tvec3 intensity = vec3( luminance( rgb ) );\n\n\t\t\treturn mix( intensity, rgb, adjustment );\n\n\t\t}",[We.Nodes.luminance]),vibrance:new Xt("\n\n\t\tvec3 vibrance(vec3 rgb, float adjustment) {\n\n\t\t\tfloat average = (rgb.r + rgb.g + rgb.b) / 3.0;\n\n\t\t\tfloat mx = max(rgb.r, max(rgb.g, rgb.b));\n\t\t\tfloat amt = (mx - average) * (-3.0 * adjustment);\n\n\t\t\treturn mix(rgb.rgb, vec3(mx), amt);\n\n\t\t}")},Ge.SATURATION="saturation",Ge.HUE="hue",Ge.VIBRANCE="vibrance",Ge.BRIGHTNESS="brightness",Ge.CONTRAST="contrast",Ge.prototype.nodeType="ColorAdjustment",Ge.prototype.hashProperties=["method"];class qe extends Rt{constructor(){super(),this.color=new ve(16777215)}generate(t){let e;if(t.isShader("vertex")){const n=this.position?this.position.analyzeAndFlow(t,"v3",{cache:"position"}):void 0,r=["#include <beginnormal_vertex>","#include <morphnormal_vertex>","#include <skinnormal_vertex>","#include <defaultnormal_vertex>"];r.push("#include <begin_vertex>"),n&&r.push(n.code,n.result?"transformed = "+n.result+";":""),r.push("#include <morphtarget_vertex>","#include <skinning_vertex>","#include <project_vertex>","#include <logdepthbuf_vertex>","#include <worldpos_vertex>","#include <clipping_planes_vertex>","#include <fog_vertex>"),e=r.join("\n")}else{this.color.analyze(t,{slot:"color"}),this.alpha&&this.alpha.analyze(t),this.mask&&this.mask.analyze(t);const n=this.color.flow(t,"c",{slot:"color"}),r=this.alpha?this.alpha.flow(t,"f"):void 0,i=this.mask?this.mask.flow(t,"b"):void 0;t.requires.transparent=void 0!==r;const o=[n.code];i&&o.push(i.code,"if ( ! "+i.result+" ) discard;"),r&&o.push(r.code,"#ifdef ALPHATEST"," if ( "+r.result+" <= ALPHATEST ) discard;","#endif"),r?o.push("gl_FragColor = vec4("+n.result+", "+r.result+" );"):o.push("gl_FragColor = vec4("+n.result+", 1.0 );"),e=o.join("\n")}return e}copy(t){return super.copy(t),this.color=t.color,t.position&&(this.position=t.position),t.alpha&&(this.alpha=t.alpha),t.mask&&(this.mask=t.mask),this}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),e.color=this.color.toJSON(t).uuid,this.position&&(e.position=this.position.toJSON(t).uuid),this.alpha&&(e.alpha=this.alpha.toJSON(t).uuid),this.mask&&(e.mask=this.mask.toJSON(t).uuid)),e}}qe.prototype.nodeType="Basic";class $e extends Rt{constructor(){super(),this.color=new ve(15658734),this.spherical=!0}build(e){let n;if(e.define("SPRITE"),e.requires.lights=!1,e.requires.transparent=void 0!==this.alpha,e.isShader("vertex")){const r=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform(t.UniformsUtils.merge([t.UniformsLib.fog])),e.addParsCode("\n\t\t\t\t#include <fog_pars_vertex>\n\t\t\t\t#include <logdepthbuf_pars_vertex>\n\t\t\t\t#include <clipping_planes_pars_vertex>"),n=["#include <clipping_planes_fragment>","#include <begin_vertex>"],r&&n.push(r.code,r.result?"transformed = "+r.result+";":""),n.push("#include <project_vertex>","#include <fog_vertex>","mat4 modelViewMtx = modelViewMatrix;","mat4 modelMtx = modelMatrix;","modelMtx[3][0] = 0.0;","modelMtx[3][1] = 0.0;","modelMtx[3][2] = 0.0;"),this.spherical||n.push("modelMtx[1][1] = 1.0;"),n.push("modelViewMtx[0][0] = 1.0;","modelViewMtx[0][1] = 0.0;","modelViewMtx[0][2] = 0.0;"),this.spherical&&n.push("modelViewMtx[1][0] = 0.0;","modelViewMtx[1][1] = 1.0;","modelViewMtx[1][2] = 0.0;"),n.push("modelViewMtx[2][0] = 0.0;","modelViewMtx[2][1] = 0.0;","modelViewMtx[2][2] = 1.0;","gl_Position = projectionMatrix * modelViewMtx * modelMtx * vec4( transformed, 1.0 );","#include <logdepthbuf_vertex>","#include <clipping_planes_vertex>","#include <fog_vertex>")}else{e.addParsCode("\n\t\t\t\t#include <fog_pars_fragment>\n\t\t\t\t#include <logdepthbuf_pars_fragment>\n\t\t\t\t#include <clipping_planes_pars_fragment>"),e.addCode("\n\t\t\t\t#include <clipping_planes_fragment>\n\t\t\t\t#include <logdepthbuf_fragment>"),this.mask&&this.mask.analyze(e),this.alpha&&this.alpha.analyze(e),this.color.analyze(e,{slot:"color"});const t=this.mask?this.mask.flow(e,"b"):void 0,r=this.alpha?this.alpha.flow(e,"f"):void 0,i=this.color.flow(e,"c",{slot:"color"});n=[],t&&n.push(t.code,"if ( ! "+t.result+" ) discard;"),r?n.push(r.code,"#ifdef ALPHATEST","if ( "+r.result+" <= ALPHATEST ) discard;","#endif",i.code,"gl_FragColor = vec4( "+i.result+", "+r.result+" );"):n.push(i.code,"gl_FragColor = vec4( "+i.result+", 1.0 );"),n.push("#include <tonemapping_fragment>","#include <encodings_fragment>","#include <fog_fragment>")}return n.join("\n")}copy(t){return super.copy(t),t.position&&(this.position=t.position),this.color=t.color,void 0!==t.spherical&&(this.spherical=t.spherical),t.mask&&(this.mask=t.mask),t.alpha&&(this.alpha=t.alpha),this}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),this.position&&(e.position=this.position.toJSON(t).uuid),e.color=this.color.toJSON(t).uuid,!1===this.spherical&&(e.spherical=!1),this.mask&&(e.mask=this.mask.toJSON(t).uuid),this.alpha&&(e.alpha=this.alpha.toJSON(t).uuid)),e}}$e.prototype.nodeType="Sprite";class Ke extends Rt{constructor(){super(),this.color=new ve(15658734),this.specular=new ve(1118481),this.shininess=new re(30)}build(e){let n;if(e.define("PHONG"),e.requires.lights=!0,e.isShader("vertex")){const r=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform(t.UniformsUtils.merge([t.UniformsLib.fog,t.UniformsLib.lights])),e.addParsCode('\n\t\t\t\tvarying vec3 vViewPosition;\n\n\t\t\t\t//"#include <encodings_pars_fragment> // encoding functions\n\t\t\t\t#include <fog_pars_vertex>\n\t\t\t\t#include <normal_pars_vertex>\n\t\t\t\t#include <morphtarget_pars_vertex>\n\t\t\t\t#include <skinning_pars_vertex>\n\t\t\t\t#include <shadowmap_pars_vertex>\n\t\t\t\t#include <logdepthbuf_pars_vertex>\n\t\t\t\t#include <clipping_planes_pars_vertex>');const i=["#include <beginnormal_vertex>","#include <morphnormal_vertex>","#include <skinbase_vertex>","#include <skinnormal_vertex>","#include <defaultnormal_vertex>","#include <normal_vertex>","#include <begin_vertex>"];r&&i.push(r.code,r.result?"transformed = "+r.result+";":""),i.push("\t#include <morphtarget_vertex>","\t#include <skinning_vertex>","\t#include <project_vertex>","\t#include <fog_vertex>","\t#include <logdepthbuf_vertex>","\t#include <clipping_planes_vertex>","\tvViewPosition = - mvPosition.xyz;","\t#include <worldpos_vertex>","\t#include <shadowmap_vertex>","\t#include <fog_vertex>"),n=i.join("\n")}else{this.mask&&this.mask.analyze(e),this.color.analyze(e,{slot:"color"}),this.specular.analyze(e),this.shininess.analyze(e),this.alpha&&this.alpha.analyze(e),this.normal&&this.normal.analyze(e),this.light&&this.light.analyze(e,{cache:"light"}),this.ao&&this.ao.analyze(e),this.ambient&&this.ambient.analyze(e),this.shadow&&this.shadow.analyze(e),this.emissive&&this.emissive.analyze(e,{slot:"emissive"}),this.environment&&this.environment.analyze(e,{slot:"environment"}),this.environmentAlpha&&this.environment&&this.environmentAlpha.analyze(e);const t=this.mask?this.mask.flow(e,"b"):void 0,r=this.color.flow(e,"c",{slot:"color"}),i=this.specular.flow(e,"c"),o=this.shininess.flow(e,"f"),a=this.alpha?this.alpha.flow(e,"f"):void 0,s=this.normal?this.normal.flow(e,"v3"):void 0,u=this.light?this.light.flow(e,"v3",{cache:"light"}):void 0,l=this.ao?this.ao.flow(e,"f"):void 0,c=this.ambient?this.ambient.flow(e,"c"):void 0,f=this.shadow?this.shadow.flow(e,"c"):void 0,h=this.emissive?this.emissive.flow(e,"c",{slot:"emissive"}):void 0,d=this.environment?this.environment.flow(e,"c",{slot:"environment"}):void 0,p=this.environmentAlpha&&this.environment?this.environmentAlpha.flow(e,"f"):void 0;e.requires.transparent=void 0!==a,e.addParsCode("\n\t\t\t\t#include <fog_pars_fragment>\n\t\t\t\t#include <bsdfs>\n\t\t\t\t#include <lights_pars_begin>\n\t\t\t\t#include <normal_pars_fragment>\n\t\t\t\t#include <lights_phong_pars_fragment>\n\t\t\t\t#include <shadowmap_pars_fragment>\n\t\t\t\t#include <logdepthbuf_pars_fragment>");const v=["#include <normal_fragment_begin>","\tBlinnPhongMaterial material;"];t&&v.push(t.code,"if ( ! "+t.result+" ) discard;"),v.push(r.code,"\tvec3 diffuseColor = "+r.result+";","\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );","#include <logdepthbuf_fragment>",i.code,"\tvec3 specular = "+i.result+";",o.code,"\tfloat shininess = max( 0.0001, "+o.result+" );","\tfloat specularStrength = 1.0;"),a&&v.push(a.code,"#ifdef ALPHATEST","if ( "+a.result+" <= ALPHATEST ) discard;","#endif"),s&&v.push(s.code,"normal = "+s.result+";"),v.push("material.diffuseColor = "+(u?"vec3( 1.0 )":"diffuseColor")+";"),v.push("material.specularColor = specular;","material.specularShininess = shininess;","material.specularStrength = specularStrength;","#include <lights_fragment_begin>","#include <lights_fragment_end>"),u&&(v.push(u.code,"reflectedLight.directDiffuse = "+u.result+";"),v.push("reflectedLight.directDiffuse *= diffuseColor;","reflectedLight.indirectDiffuse *= diffuseColor;")),l&&v.push(l.code,"reflectedLight.indirectDiffuse *= "+l.result+";"),c&&v.push(c.code,"reflectedLight.indirectDiffuse += "+c.result+";"),f&&v.push(f.code,"reflectedLight.directDiffuse *= "+f.result+";","reflectedLight.directSpecular *= "+f.result+";"),h&&v.push(h.code,"reflectedLight.directDiffuse += "+h.result+";"),v.push("vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular;"),d&&(v.push(d.code),p?v.push(p.code,"outgoingLight = mix( outgoingLight, "+d.result+", "+p.result+" );"):v.push("outgoingLight = "+d.result+";")),a?v.push("gl_FragColor = vec4( outgoingLight, "+a.result+" );"):v.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),v.push("#include <tonemapping_fragment>","#include <encodings_fragment>","#include <fog_fragment>","#include <premultiplied_alpha_fragment>"),n=v.join("\n")}return n}copy(t){return super.copy(t),t.position&&(this.position=t.position),this.color=t.color,this.specular=t.specular,this.shininess=t.shininess,t.mask&&(this.mask=t.mask),t.alpha&&(this.alpha=t.alpha),t.normal&&(this.normal=t.normal),t.light&&(this.light=t.light),t.shadow&&(this.shadow=t.shadow),t.ao&&(this.ao=t.ao),t.emissive&&(this.emissive=t.emissive),t.ambient&&(this.ambient=t.ambient),t.environment&&(this.environment=t.environment),t.environmentAlpha&&(this.environmentAlpha=t.environmentAlpha),this}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),this.position&&(e.position=this.position.toJSON(t).uuid),e.color=this.color.toJSON(t).uuid,e.specular=this.specular.toJSON(t).uuid,e.shininess=this.shininess.toJSON(t).uuid,this.mask&&(e.mask=this.mask.toJSON(t).uuid),this.alpha&&(e.alpha=this.alpha.toJSON(t).uuid),this.normal&&(e.normal=this.normal.toJSON(t).uuid),this.light&&(e.light=this.light.toJSON(t).uuid),this.ao&&(e.ao=this.ao.toJSON(t).uuid),this.ambient&&(e.ambient=this.ambient.toJSON(t).uuid),this.shadow&&(e.shadow=this.shadow.toJSON(t).uuid),this.emissive&&(e.emissive=this.emissive.toJSON(t).uuid),this.environment&&(e.environment=this.environment.toJSON(t).uuid),this.environmentAlpha&&(e.environmentAlpha=this.environmentAlpha.toJSON(t).uuid)),e}}Ke.prototype.nodeType="Phong";class Ze extends Rt{constructor(){super(),this.color=new ve(16777215),this.roughness=new re(1),this.metalness=new re(0)}build(e){let n;e.define("STANDARD");const r=this.clearcoat||this.clearcoatRoughness||this.clearCoatNormal;if(r&&(e.define("CLEARCOAT"),e.define("USE_CLEARCOAT")),e.requires.lights=!0,e.extensions.derivatives=!0,e.extensions.shaderTextureLOD=!0,e.isShader("vertex")){const r=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform(t.UniformsUtils.merge([t.UniformsLib.fog,t.UniformsLib.lights])),t.UniformsLib.LTC_1&&(e.uniforms.ltc_1={value:void 0},e.uniforms.ltc_2={value:void 0}),e.addParsCode('\n\t\t\t\tvarying vec3 vViewPosition;\n\n\t\t\t\t#ifndef FLAT_SHADED\n\n\t\t\t\t\tvarying vec3 vNormal;\n\n\t\t\t\t#endif\n\n\t\t\t\t//"#include <encodings_pars_fragment> // encoding functions\n\t\t\t\t#include <fog_pars_vertex>\n\t\t\t\t#include <morphtarget_pars_vertex>\n\t\t\t\t#include <skinning_pars_vertex>\n\t\t\t\t#include <shadowmap_pars_vertex>\n\t\t\t\t#include <logdepthbuf_pars_vertex>\n\t\t\t\t#include <clipping_planes_pars_vertex>');const i=["#include <beginnormal_vertex>","#include <morphnormal_vertex>","#include <skinbase_vertex>","#include <skinnormal_vertex>","#include <defaultnormal_vertex>","#ifndef FLAT_SHADED","\tvNormal = normalize( transformedNormal );","#endif","#include <begin_vertex>"];r&&i.push(r.code,r.result?"transformed = "+r.result+";":""),i.push("#include <morphtarget_vertex>","#include <skinning_vertex>","#include <project_vertex>","#include <fog_vertex>","#include <logdepthbuf_vertex>","#include <clipping_planes_vertex>","\tvViewPosition = - mvPosition.xyz;","#include <worldpos_vertex>","#include <shadowmap_vertex>"),n=i.join("\n")}else{const t=new $t("material.roughness","f"),i=new $t("material.clearcoatRoughness","f"),o={roughness:t,bias:new Ye(t),viewNormal:new $t("normal","v3"),worldNormal:new $t("inverseTransformDirection( geometry.normal, viewMatrix )","v3"),gamma:!0},a={gamma:!0},s={roughness:i,bias:new Ye(i),viewNormal:new $t("clearcoatNormal","v3"),worldNormal:new $t("inverseTransformDirection( geometry.clearcoatNormal, viewMatrix )","v3"),gamma:!0};this.mask&&this.mask.analyze(e),this.color.analyze(e,{slot:"color",context:a}),this.roughness.analyze(e),this.metalness.analyze(e),this.alpha&&this.alpha.analyze(e),this.normal&&this.normal.analyze(e),this.clearcoat&&this.clearcoat.analyze(e),this.clearcoatRoughness&&this.clearcoatRoughness.analyze(e),this.clearcoatNormal&&this.clearcoatNormal.analyze(e),this.reflectivity&&this.reflectivity.analyze(e),this.light&&this.light.analyze(e,{cache:"light"}),this.ao&&this.ao.analyze(e),this.ambient&&this.ambient.analyze(e),this.shadow&&this.shadow.analyze(e),this.emissive&&this.emissive.analyze(e,{slot:"emissive"}),this.environment&&(this.environment.analyze(e,{cache:"radiance",context:o,slot:"radiance"}),e.requires.irradiance&&this.environment.analyze(e,{cache:"irradiance",context:o,slot:"irradiance"})),this.sheenColor&&this.sheenColor.analyze(e);const u=this.mask?this.mask.flow(e,"b"):void 0,l=this.color.flow(e,"c",{slot:"color",context:a}),c=this.roughness.flow(e,"f"),f=this.metalness.flow(e,"f"),h=this.alpha?this.alpha.flow(e,"f"):void 0,d=this.normal?this.normal.flow(e,"v3"):void 0,p=this.clearcoat?this.clearcoat.flow(e,"f"):void 0,v=this.clearcoatRoughness?this.clearcoatRoughness.flow(e,"f"):void 0,m=this.clearcoatNormal?this.clearcoatNormal.flow(e,"v3"):void 0,g=this.reflectivity?this.reflectivity.flow(e,"f"):void 0,y=this.light?this.light.flow(e,"v3",{cache:"light"}):void 0,x=this.ao?this.ao.flow(e,"f"):void 0,_=this.ambient?this.ambient.flow(e,"c"):void 0,b=this.shadow?this.shadow.flow(e,"c"):void 0,A=this.emissive?this.emissive.flow(e,"c",{slot:"emissive"}):void 0;let T;this.environment&&(T={radiance:this.environment.flow(e,"c",{cache:"radiance",context:o,slot:"radiance"})},e.requires.irradiance&&(T.irradiance=this.environment.flow(e,"c",{cache:"irradiance",context:o,slot:"irradiance"})));const w=r&&T?this.environment.flow(e,"c",{cache:"clearcoat",context:s,slot:"environment"}):void 0,S=this.sheenColor?this.sheenColor.flow(e,"c"):void 0;e.requires.transparent=void 0!==h,e.addParsCode("\n\t\t\t\tvarying vec3 vViewPosition;\n\n\t\t\t\t#define NODE_MAXIMUM_SPECULAR_COEFFICIENT 0.16\n\t\t\t\t#define NODE_DEFAULT_SPECULAR_COEFFICIENT 0.04\n\n\t\t\t\t#ifndef FLAT_SHADED\n\n\t\t\t\t\tvarying vec3 vNormal;\n\n\t\t\t\t#endif\n\n\t\t\t\t#include <dithering_pars_fragment>\n\t\t\t\t#include <fog_pars_fragment>\n\t\t\t\t#include <bsdfs>\n\t\t\t\t#include <lights_pars_begin>\n\t\t\t\t#include <lights_physical_pars_fragment>\n\t\t\t\t#include <shadowmap_pars_fragment>\n\t\t\t\t#include <logdepthbuf_pars_fragment>");const N=["#include <clipping_planes_fragment>","\t#include <normal_fragment_begin>","\t#include <clearcoat_normal_fragment_begin>","\tPhysicalMaterial material;","\tmaterial.diffuseColor = vec3( 1.0 );"];u&&N.push(u.code,"if ( ! "+u.result+" ) discard;"),N.push(l.code,"\tvec3 diffuseColor = "+l.result+";","\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );","#include <logdepthbuf_fragment>",c.code,"\tfloat roughnessFactor = "+c.result+";",f.code,"\tfloat metalnessFactor = "+f.result+";"),h&&N.push(h.code,"#ifdef ALPHATEST","\tif ( "+h.result+" <= ALPHATEST ) discard;","#endif"),d&&N.push(d.code,"normal = "+d.result+";"),m&&N.push(m.code,"clearcoatNormal = "+m.result+";"),N.push("vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );"),N.push("material.diffuseColor = "+(y?"vec3( 1.0 )":"diffuseColor * ( 1.0 - metalnessFactor )")+";","material.roughness = max( roughnessFactor, 0.0525 );","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.roughness = clamp( roughnessFactor, 0.04, 1.0 );"),p?N.push(p.code,"material.clearcoat = saturate( "+p.result+" );"):r&&N.push("material.clearcoat = 0.0;"),v?N.push(v.code,"material.clearcoatRoughness = max( "+v.result+", 0.0525 );","material.clearcoatRoughness += geometryRoughness;","material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );"):r&&N.push("material.clearcoatRoughness = 0.0;"),S&&N.push("material.sheenColor = "+S.result+";"),g?N.push(g.code,"material.specularColor = mix( vec3( NODE_MAXIMUM_SPECULAR_COEFFICIENT * pow2( "+g.result+" ) ), diffuseColor, metalnessFactor );"):N.push("material.specularColor = mix( vec3( NODE_DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor, metalnessFactor );"),N.push("#include <lights_fragment_begin>"),y&&(N.push(y.code,"reflectedLight.directDiffuse = "+y.result+";"),N.push("diffuseColor *= 1.0 - metalnessFactor;","reflectedLight.directDiffuse *= diffuseColor;","reflectedLight.indirectDiffuse *= diffuseColor;")),x&&N.push(x.code,"reflectedLight.indirectDiffuse *= "+x.result+";","float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );","reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, "+x.result+", material.roughness );"),_&&N.push(_.code,"reflectedLight.indirectDiffuse += "+_.result+";"),b&&N.push(b.code,"reflectedLight.directDiffuse *= "+b.result+";","reflectedLight.directSpecular *= "+b.result+";"),A&&N.push(A.code,"reflectedLight.directDiffuse += "+A.result+";"),T&&(N.push(T.radiance.code),e.requires.irradiance&&N.push(T.irradiance.code),w&&N.push(w.code,"clearcoatRadiance += "+w.result+";"),N.push("radiance += "+T.radiance.result+";"),e.requires.irradiance&&N.push("iblIrradiance += PI * "+T.irradiance.result+";")),N.push("#include <lights_fragment_end>"),N.push("vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular;"),h?N.push("gl_FragColor = vec4( outgoingLight, "+h.result+" );"):N.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),N.push("#include <tonemapping_fragment>","#include <encodings_fragment>","#include <fog_fragment>","#include <premultiplied_alpha_fragment>","#include <dithering_fragment>"),n=N.join("\n")}return n}copy(t){return super.copy(t),t.position&&(this.position=t.position),this.color=t.color,this.roughness=t.roughness,this.metalness=t.metalness,t.mask&&(this.mask=t.mask),t.alpha&&(this.alpha=t.alpha),t.normal&&(this.normal=t.normal),t.clearcoat&&(this.clearcoat=t.clearcoat),t.clearcoatRoughness&&(this.clearcoatRoughness=t.clearcoatRoughness),t.clearcoatNormal&&(this.clearcoatNormal=t.clearcoatNormal),t.reflectivity&&(this.reflectivity=t.reflectivity),t.light&&(this.light=t.light),t.shadow&&(this.shadow=t.shadow),t.ao&&(this.ao=t.ao),t.emissive&&(this.emissive=t.emissive),t.ambient&&(this.ambient=t.ambient),t.environment&&(this.environment=t.environment),t.sheenColor&&(this.sheenColor=t.sheenColor),this}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),this.position&&(e.position=this.position.toJSON(t).uuid),e.color=this.color.toJSON(t).uuid,e.roughness=this.roughness.toJSON(t).uuid,e.metalness=this.metalness.toJSON(t).uuid,this.mask&&(e.mask=this.mask.toJSON(t).uuid),this.alpha&&(e.alpha=this.alpha.toJSON(t).uuid),this.normal&&(e.normal=this.normal.toJSON(t).uuid),this.clearcoat&&(e.clearcoat=this.clearcoat.toJSON(t).uuid),this.clearcoatRoughness&&(e.clearcoatRoughness=this.clearcoatRoughness.toJSON(t).uuid),this.clearcoatNormal&&(e.clearcoatNormal=this.clearcoatNormal.toJSON(t).uuid),this.reflectivity&&(e.reflectivity=this.reflectivity.toJSON(t).uuid),this.light&&(e.light=this.light.toJSON(t).uuid),this.shadow&&(e.shadow=this.shadow.toJSON(t).uuid),this.ao&&(e.ao=this.ao.toJSON(t).uuid),this.emissive&&(e.emissive=this.emissive.toJSON(t).uuid),this.ambient&&(e.ambient=this.ambient.toJSON(t).uuid),this.environment&&(e.environment=this.environment.toJSON(t).uuid),this.sheenColor&&(e.sheenColor=this.sheenColor.toJSON(t).uuid)),e}}Ze.prototype.nodeType="Standard";class tn extends Ze{constructor(){super(),this.properties={color:new t.Color(16777215),roughness:.5,metalness:.5,normalScale:new t.Vector2(1,1)},this.inputs={color:new Te(this.properties,"color","c"),roughness:new Te(this.properties,"roughness","f"),metalness:new Te(this.properties,"metalness","f"),normalScale:new Te(this.properties,"normalScale","v2")}}build(t){const e=this.properties,n=this.inputs;if(t.isShader("fragment")){const r=t.findNode(e.color,n.color),i=t.resolve(e.map);this.color=i?new oe(r,i,oe.MUL):r;const o=t.findNode(e.roughness,n.roughness),a=t.resolve(e.roughnessMap);this.roughness=a?new oe(o,new Je(a,"g"),oe.MUL):o;const s=t.findNode(e.metalness,n.metalness),u=t.resolve(e.metalnessMap);this.metalness=u?new oe(s,new Je(u,"b"),oe.MUL):s,e.normalMap?(this.normal=new De(t.resolve(e.normalMap)),this.normal.scale=t.findNode(e.normalScale,n.normalScale)):this.normal=void 0,this.environment=t.resolve(e.envMap)}return super.build(t)}toJSON(t){let e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),console.warn(".toJSON not implemented in",this)),e}}tn.prototype.nodeType="MeshStandard";It.addShortcuts(class extends ge{constructor(){const t=new qe;super(t,t),this.type="BasicNodeMaterial"}}.prototype,"fragment",["color","alpha","mask","position"]);It.addShortcuts(class extends ge{constructor(){const t=new $e;super(t,t),this.type="SpriteNodeMaterial"}}.prototype,"fragment",["color","alpha","mask","position","spherical"]);It.addShortcuts(class extends ge{constructor(){const t=new Ke;super(t,t),this.type="PhongNodeMaterial"}}.prototype,"fragment",["color","alpha","specular","shininess","normal","emissive","ambient","light","shadow","ao","environment","environmentAlpha","mask","position"]);It.addShortcuts(class extends ge{constructor(){const t=new Ze;super(t,t),this.type="StandardNodeMaterial"}}.prototype,"fragment",["color","alpha","roughness","metalness","reflectivity","clearcoat","clearcoatRoughness","clearcoatNormal","normal","emissive","ambient","light","shadow","ao","environment","mask","position","sheenColor"]);It.addShortcuts(class extends ge{constructor(){const t=new tn;super(t,t),this.type="MeshStandardNodeMaterial"}}.prototype,"properties",["color","roughness","metalness","map","normalMap","normalScale","metalnessMap","roughnessMap","envMap"]);function en(t){return en="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},en(t)}function nn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function rn(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function on(t,e){return on=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},on(t,e)}function an(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=un(t);if(e){var i=un(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return sn(this,n)}}function sn(t,e){if(e&&("object"===en(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function un(t){return un=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},un(t)}var ln=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&on(t,e)}(o,t);var e,n,r,i=an(o);function o(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.hue,r=void 0===n?0:n,a=e.saturation,s=void 0===a?1:a,u=e.vibrance,l=void 0===u?0:u,c=e.brightness,f=void 0===c?0:c,h=e.contrast,d=void 0===h?1:h;nn(this,o),t=i.call(this),r=new re(r),s=new re(s),l=new re(l),f=new re(f),d=new re(d);var p=new ye,v=new Ge(p,r,Ge.HUE),m=new Ge(v,s,Ge.SATURATION),g=new Ge(m,l,Ge.VIBRANCE),y=new Ge(g,f,Ge.BRIGHTNESS),x=new Ge(y,d,Ge.CONTRAST);return t.input=x,t._hue=r,t._saturation=s,t._vibrance=l,t._brightness=f,t._contrast=d,t}return e=o,(n=[{key:"brightness",get:function(){return this._brightness.value},set:function(t){this._brightness.value=t}},{key:"contrast",get:function(){return this._contrast.value},set:function(t){this._contrast.value=t}},{key:"hue",get:function(){return this._hue.value},set:function(t){this._hue.value=t}},{key:"saturation",get:function(){return this._saturation.value},set:function(t){this._saturation.value=t}},{key:"vibrance",get:function(){return this._vibrance.value},set:function(t){this._vibrance.value=t}}])&&rn(e.prototype,n),r&&rn(e,r),Object.defineProperty(e,"prototype",{writable:!1}),o}(xe);const cn={shaderID:"luminosityHighPass",uniforms:{tDiffuse:{value:null},luminosityThreshold:{value:1},smoothWidth:{value:1},defaultColor:{value:new t.Color(0)},defaultOpacity:{value:0}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform vec3 defaultColor;\n\t\tuniform float defaultOpacity;\n\t\tuniform float luminosityThreshold;\n\t\tuniform float smoothWidth;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 texel = texture2D( tDiffuse, vUv );\n\n\t\t\tvec3 luma = vec3( 0.299, 0.587, 0.114 );\n\n\t\t\tfloat v = dot( texel.xyz, luma );\n\n\t\t\tvec4 outputColor = vec4( defaultColor.rgb, defaultOpacity );\n\n\t\t\tfloat alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );\n\n\t\t\tgl_FragColor = mix( outputColor, texel, alpha );\n\n\t\t}"};class fn extends Tt{constructor(e,n,r,i){super(),this.strength=void 0!==n?n:1,this.radius=r,this.threshold=i,this.resolution=void 0!==e?new t.Vector2(e.x,e.y):new t.Vector2(256,256),this.clearColor=new t.Color(0,0,0);const o={minFilter:t.LinearFilter,magFilter:t.LinearFilter,format:t.RGBAFormat};this.renderTargetsHorizontal=[],this.renderTargetsVertical=[],this.nMips=5;let a=Math.round(this.resolution.x/2),s=Math.round(this.resolution.y/2);this.renderTargetBright=new t.WebGLRenderTarget(a,s,o),this.renderTargetBright.texture.name="UnrealBloomPass.bright",this.renderTargetBright.texture.generateMipmaps=!1;for(let e=0;e<this.nMips;e++){const n=new t.WebGLRenderTarget(a,s,o);n.texture.name="UnrealBloomPass.h"+e,n.texture.generateMipmaps=!1,this.renderTargetsHorizontal.push(n);const r=new t.WebGLRenderTarget(a,s,o);r.texture.name="UnrealBloomPass.v"+e,r.texture.generateMipmaps=!1,this.renderTargetsVertical.push(r),a=Math.round(a/2),s=Math.round(s/2)}void 0===cn&&console.error("THREE.UnrealBloomPass relies on LuminosityHighPassShader");const u=cn;this.highPassUniforms=t.UniformsUtils.clone(u.uniforms),this.highPassUniforms.luminosityThreshold.value=i,this.highPassUniforms.smoothWidth.value=.01,this.materialHighPassFilter=new t.ShaderMaterial({uniforms:this.highPassUniforms,vertexShader:u.vertexShader,fragmentShader:u.fragmentShader,defines:{}}),this.separableBlurMaterials=[];const l=[3,5,7,9,11];a=Math.round(this.resolution.x/2),s=Math.round(this.resolution.y/2);for(let e=0;e<this.nMips;e++)this.separableBlurMaterials.push(this.getSeperableBlurMaterial(l[e])),this.separableBlurMaterials[e].uniforms.texSize.value=new t.Vector2(a,s),a=Math.round(a/2),s=Math.round(s/2);this.compositeMaterial=this.getCompositeMaterial(this.nMips),this.compositeMaterial.uniforms.blurTexture1.value=this.renderTargetsVertical[0].texture,this.compositeMaterial.uniforms.blurTexture2.value=this.renderTargetsVertical[1].texture,this.compositeMaterial.uniforms.blurTexture3.value=this.renderTargetsVertical[2].texture,this.compositeMaterial.uniforms.blurTexture4.value=this.renderTargetsVertical[3].texture,this.compositeMaterial.uniforms.blurTexture5.value=this.renderTargetsVertical[4].texture,this.compositeMaterial.uniforms.bloomStrength.value=n,this.compositeMaterial.uniforms.bloomRadius.value=.1,this.compositeMaterial.needsUpdate=!0;this.compositeMaterial.uniforms.bloomFactors.value=[1,.8,.6,.4,.2],this.bloomTintColors=[new t.Vector3(1,1,1),new t.Vector3(1,1,1),new t.Vector3(1,1,1),new t.Vector3(1,1,1),new t.Vector3(1,1,1)],this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,void 0===At&&console.error("THREE.UnrealBloomPass relies on CopyShader");const c=At;this.copyUniforms=t.UniformsUtils.clone(c.uniforms),this.copyUniforms.opacity.value=1,this.materialCopy=new t.ShaderMaterial({uniforms:this.copyUniforms,vertexShader:c.vertexShader,fragmentShader:c.fragmentShader,blending:t.AdditiveBlending,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this._oldClearColor=new t.Color,this.oldClearAlpha=1,this.basic=new t.MeshBasicMaterial,this.fsQuad=new Nt(null)}dispose(){for(let t=0;t<this.renderTargetsHorizontal.length;t++)this.renderTargetsHorizontal[t].dispose();for(let t=0;t<this.renderTargetsVertical.length;t++)this.renderTargetsVertical[t].dispose();this.renderTargetBright.dispose()}setSize(e,n){let r=Math.round(e/2),i=Math.round(n/2);this.renderTargetBright.setSize(r,i);for(let e=0;e<this.nMips;e++)this.renderTargetsHorizontal[e].setSize(r,i),this.renderTargetsVertical[e].setSize(r,i),this.separableBlurMaterials[e].uniforms.texSize.value=new t.Vector2(r,i),r=Math.round(r/2),i=Math.round(i/2)}render(t,e,n,r,i){t.getClearColor(this._oldClearColor),this.oldClearAlpha=t.getClearAlpha();const o=t.autoClear;t.autoClear=!1,t.setClearColor(this.clearColor,0),i&&t.state.buffers.stencil.setTest(!1),this.renderToScreen&&(this.fsQuad.material=this.basic,this.basic.map=n.texture,t.setRenderTarget(null),t.clear(),this.fsQuad.render(t)),this.highPassUniforms.tDiffuse.value=n.texture,this.highPassUniforms.luminosityThreshold.value=this.threshold,this.fsQuad.material=this.materialHighPassFilter,t.setRenderTarget(this.renderTargetBright),t.clear(),this.fsQuad.render(t);let a=this.renderTargetBright;for(let e=0;e<this.nMips;e++)this.fsQuad.material=this.separableBlurMaterials[e],this.separableBlurMaterials[e].uniforms.colorTexture.value=a.texture,this.separableBlurMaterials[e].uniforms.direction.value=fn.BlurDirectionX,t.setRenderTarget(this.renderTargetsHorizontal[e]),t.clear(),this.fsQuad.render(t),this.separableBlurMaterials[e].uniforms.colorTexture.value=this.renderTargetsHorizontal[e].texture,this.separableBlurMaterials[e].uniforms.direction.value=fn.BlurDirectionY,t.setRenderTarget(this.renderTargetsVertical[e]),t.clear(),this.fsQuad.render(t),a=this.renderTargetsVertical[e];this.fsQuad.material=this.compositeMaterial,this.compositeMaterial.uniforms.bloomStrength.value=this.strength,this.compositeMaterial.uniforms.bloomRadius.value=this.radius,this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,t.setRenderTarget(this.renderTargetsHorizontal[0]),t.clear(),this.fsQuad.render(t),this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetsHorizontal[0].texture,i&&t.state.buffers.stencil.setTest(!0),this.renderToScreen?(t.setRenderTarget(null),this.fsQuad.render(t)):(t.setRenderTarget(n),this.fsQuad.render(t)),t.setClearColor(this._oldClearColor,this.oldClearAlpha),t.autoClear=o}getSeperableBlurMaterial(e){return new t.ShaderMaterial({defines:{KERNEL_RADIUS:e,SIGMA:e},uniforms:{colorTexture:{value:null},texSize:{value:new t.Vector2(.5,.5)},direction:{value:new t.Vector2(.5,.5)}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"#include <common>\n\t\t\t\tvarying vec2 vUv;\n\t\t\t\tuniform sampler2D colorTexture;\n\t\t\t\tuniform vec2 texSize;\n\t\t\t\tuniform vec2 direction;\n\n\t\t\t\tfloat gaussianPdf(in float x, in float sigma) {\n\t\t\t\t\treturn 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;\n\t\t\t\t}\n\t\t\t\tvoid main() {\n\t\t\t\t\tvec2 invSize = 1.0 / texSize;\n\t\t\t\t\tfloat fSigma = float(SIGMA);\n\t\t\t\t\tfloat weightSum = gaussianPdf(0.0, fSigma);\n\t\t\t\t\tvec3 diffuseSum = texture2D( colorTexture, vUv).rgb * weightSum;\n\t\t\t\t\tfor( int i = 1; i < KERNEL_RADIUS; i ++ ) {\n\t\t\t\t\t\tfloat x = float(i);\n\t\t\t\t\t\tfloat w = gaussianPdf(x, fSigma);\n\t\t\t\t\t\tvec2 uvOffset = direction * invSize * x;\n\t\t\t\t\t\tvec3 sample1 = texture2D( colorTexture, vUv + uvOffset).rgb;\n\t\t\t\t\t\tvec3 sample2 = texture2D( colorTexture, vUv - uvOffset).rgb;\n\t\t\t\t\t\tdiffuseSum += (sample1 + sample2) * w;\n\t\t\t\t\t\tweightSum += 2.0 * w;\n\t\t\t\t\t}\n\t\t\t\t\tgl_FragColor = vec4(diffuseSum/weightSum, 1.0);\n\t\t\t\t}"})}getCompositeMaterial(e){return new t.ShaderMaterial({defines:{NUM_MIPS:e},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},dirtTexture:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\n\t\t\t\tuniform sampler2D blurTexture1;\n\t\t\t\tuniform sampler2D blurTexture2;\n\t\t\t\tuniform sampler2D blurTexture3;\n\t\t\t\tuniform sampler2D blurTexture4;\n\t\t\t\tuniform sampler2D blurTexture5;\n\t\t\t\tuniform sampler2D dirtTexture;\n\t\t\t\tuniform float bloomStrength;\n\t\t\t\tuniform float bloomRadius;\n\t\t\t\tuniform float bloomFactors[NUM_MIPS];\n\t\t\t\tuniform vec3 bloomTintColors[NUM_MIPS];\n\n\t\t\t\tfloat lerpBloomFactor(const in float factor) {\n\t\t\t\t\tfloat mirrorFactor = 1.2 - factor;\n\t\t\t\t\treturn mix(factor, mirrorFactor, bloomRadius);\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tgl_FragColor = bloomStrength * ( lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );\n\t\t\t\t}"})}}fn.BlurDirectionX=new t.Vector2(1,0),fn.BlurDirectionY=new t.Vector2(0,1);const hn="vec3 bayerMatrixDither( vec3 color ) {\r\n\r\n\tconst float BAYER_MATRIX[ 64 ] = float[ 64 ](\r\n\t\t0.0,  32.0,  8.0, 40.0,  2.0, 34.0, 10.0, 42.0,\r\n\t\t48.0, 16.0, 56.0, 24.0, 50.0, 18.0, 58.0, 26.0,\r\n\t\t12.0, 44.0,  4.0, 36.0, 14.0, 46.0,  6.0, 38.0,\r\n\t\t60.0, 28.0, 52.0, 20.0, 62.0, 30.0, 54.0, 22.0,\r\n\t\t3.0,  35.0, 11.0, 43.0,  1.0, 33.0,  9.0, 41.0,\r\n\t\t51.0, 19.0, 59.0, 27.0, 49.0, 17.0, 57.0, 25.0,\r\n\t\t15.0, 47.0,  7.0, 39.0, 13.0, 45.0,  5.0, 37.0,\r\n\t\t63.0, 31.0, 55.0, 23.0, 61.0, 29.0, 53.0, 21.0\r\n\t);\r\n\r\n\tfloat dithering = ( BAYER_MATRIX[  \r\n\t\tint( mod( gl_FragCoord.x - 0.5, 8.0 ) ) + \r\n\t\tint( mod( gl_FragCoord.y - 0.5, 8.0 ) * 8.0 )\r\n\t] / 255.0 ) / 32.0 - ( 1.0 / 128.0 );\r\n\r\n\treturn color + dithering;\r\n\t\r\n}";function dn(t){return dn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},dn(t)}function pn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function vn(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function mn(t,e){return mn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},mn(t,e)}function gn(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=xn(t);if(e){var i=xn(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return yn(this,n)}}function yn(t,e){if(e&&("object"===dn(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function xn(t){return xn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},xn(t)}var _n=function(e){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&mn(t,e)}(a,e);var n,r,i,o=gn(a);function a(){return pn(this,a),o.apply(this,arguments)}return n=a,(r=[{key:"getCompositeMaterial",value:function(e){return new t.ShaderMaterial({defines:{NUM_MIPS:e},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},dirtTexture:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\n\t\t\t\tuniform sampler2D blurTexture1;\n\t\t\t\tuniform sampler2D blurTexture2;\n\t\t\t\tuniform sampler2D blurTexture3;\n\t\t\t\tuniform sampler2D blurTexture4;\n\t\t\t\tuniform sampler2D blurTexture5;\n\t\t\t\tuniform sampler2D dirtTexture;\n\t\t\t\tuniform float bloomStrength;\n\t\t\t\tuniform float bloomRadius;\n\t\t\t\tuniform float bloomFactors[NUM_MIPS];\n\t\t\t\tuniform vec3 bloomTintColors[NUM_MIPS];\n\n\t\t\t\tfloat lerpBloomFactor(const in float factor) {\n\t\t\t\t\tfloat mirrorFactor = 1.2 - factor;\n\t\t\t\t\treturn mix(factor, mirrorFactor, bloomRadius);\n\t\t\t\t}\n\n\t\t\t\t".concat(hn,"\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tvec4 color = bloomStrength * ( \n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv)\n\t\t\t\t\t);\n\n\t\t\t\t\tcolor.rgb = bayerMatrixDither( color.rgb );\n\n\t\t\t\t\tgl_FragColor = color;\n\t\t\t\t}")})}}])&&vn(n.prototype,r),i&&vn(n,i),Object.defineProperty(n,"prototype",{writable:!1}),a}(fn);const bn={uniforms:{tDiffuse:{value:null},resolution:{value:new t.Vector2(1/1024,1/512)}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:'\n\n\t\tprecision highp float;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tuniform vec2 resolution;\n\n\t\tvarying vec2 vUv;\n\n\t\t#define FXAA_PC 1\n\t\t#define FXAA_GLSL_100 1\n\t\t#define FXAA_QUALITY_PRESET 12\n\n\t\t#define FXAA_GREEN_AS_LUMA 1\n\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#ifndef FXAA_PC_CONSOLE\n\t\t\t\t//\n\t\t\t\t// The console algorithm for PC is included\n\t\t\t\t// for developers targeting really low spec machines.\n\t\t\t\t// Likely better to just run FXAA_PC, and use a really low preset.\n\t\t\t\t//\n\t\t\t\t#define FXAA_PC_CONSOLE 0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#ifndef FXAA_GLSL_120\n\t\t\t\t#define FXAA_GLSL_120 0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#ifndef FXAA_GLSL_130\n\t\t\t\t#define FXAA_GLSL_130 0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#ifndef FXAA_HLSL_3\n\t\t\t\t#define FXAA_HLSL_3 0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#ifndef FXAA_HLSL_4\n\t\t\t\t#define FXAA_HLSL_4 0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#ifndef FXAA_HLSL_5\n\t\t\t\t#define FXAA_HLSL_5 0\n\t\t#endif\n\t\t/*==========================================================================*/\n\t\t#ifndef FXAA_GREEN_AS_LUMA\n\t\t\t\t//\n\t\t\t\t// For those using non-linear color,\n\t\t\t\t// and either not able to get luma in alpha, or not wanting to,\n\t\t\t\t// this enables FXAA to run using green as a proxy for luma.\n\t\t\t\t// So with this enabled, no need to pack luma in alpha.\n\t\t\t\t//\n\t\t\t\t// This will turn off AA on anything which lacks some amount of green.\n\t\t\t\t// Pure red and blue or combination of only R and B, will get no AA.\n\t\t\t\t//\n\t\t\t\t// Might want to lower the settings for both,\n\t\t\t\t//\t\tfxaaConsoleEdgeThresholdMin\n\t\t\t\t//\t\tfxaaQualityEdgeThresholdMin\n\t\t\t\t// In order to insure AA does not get turned off on colors\n\t\t\t\t// which contain a minor amount of green.\n\t\t\t\t//\n\t\t\t\t// 1 = On.\n\t\t\t\t// 0 = Off.\n\t\t\t\t//\n\t\t\t\t#define FXAA_GREEN_AS_LUMA 0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#ifndef FXAA_EARLY_EXIT\n\t\t\t\t//\n\t\t\t\t// Controls algorithm\'s early exit path.\n\t\t\t\t// On PS3 turning this ON adds 2 cycles to the shader.\n\t\t\t\t// On 360 turning this OFF adds 10ths of a millisecond to the shader.\n\t\t\t\t// Turning this off on console will result in a more blurry image.\n\t\t\t\t// So this defaults to on.\n\t\t\t\t//\n\t\t\t\t// 1 = On.\n\t\t\t\t// 0 = Off.\n\t\t\t\t//\n\t\t\t\t#define FXAA_EARLY_EXIT 1\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#ifndef FXAA_DISCARD\n\t\t\t\t//\n\t\t\t\t// Only valid for PC OpenGL currently.\n\t\t\t\t// Probably will not work when FXAA_GREEN_AS_LUMA = 1.\n\t\t\t\t//\n\t\t\t\t// 1 = Use discard on pixels which don\'t need AA.\n\t\t\t\t//\t\t For APIs which enable concurrent TEX+ROP from same surface.\n\t\t\t\t// 0 = Return unchanged color on pixels which don\'t need AA.\n\t\t\t\t//\n\t\t\t\t#define FXAA_DISCARD 0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#ifndef FXAA_FAST_PIXEL_OFFSET\n\t\t\t\t//\n\t\t\t\t// Used for GLSL 120 only.\n\t\t\t\t//\n\t\t\t\t// 1 = GL API supports fast pixel offsets\n\t\t\t\t// 0 = do not use fast pixel offsets\n\t\t\t\t//\n\t\t\t\t#ifdef GL_EXT_gpu_shader4\n\t\t\t\t\t\t#define FXAA_FAST_PIXEL_OFFSET 1\n\t\t\t\t#endif\n\t\t\t\t#ifdef GL_NV_gpu_shader5\n\t\t\t\t\t\t#define FXAA_FAST_PIXEL_OFFSET 1\n\t\t\t\t#endif\n\t\t\t\t#ifdef GL_ARB_gpu_shader5\n\t\t\t\t\t\t#define FXAA_FAST_PIXEL_OFFSET 1\n\t\t\t\t#endif\n\t\t\t\t#ifndef FXAA_FAST_PIXEL_OFFSET\n\t\t\t\t\t\t#define FXAA_FAST_PIXEL_OFFSET 0\n\t\t\t\t#endif\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#ifndef FXAA_GATHER4_ALPHA\n\t\t\t\t//\n\t\t\t\t// 1 = API supports gather4 on alpha channel.\n\t\t\t\t// 0 = API does not support gather4 on alpha channel.\n\t\t\t\t//\n\t\t\t\t#if (FXAA_HLSL_5 == 1)\n\t\t\t\t\t\t#define FXAA_GATHER4_ALPHA 1\n\t\t\t\t#endif\n\t\t\t\t#ifdef GL_ARB_gpu_shader5\n\t\t\t\t\t\t#define FXAA_GATHER4_ALPHA 1\n\t\t\t\t#endif\n\t\t\t\t#ifdef GL_NV_gpu_shader5\n\t\t\t\t\t\t#define FXAA_GATHER4_ALPHA 1\n\t\t\t\t#endif\n\t\t\t\t#ifndef FXAA_GATHER4_ALPHA\n\t\t\t\t\t\t#define FXAA_GATHER4_ALPHA 0\n\t\t\t\t#endif\n\t\t#endif\n\n\n\t\t/*============================================================================\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tFXAA QUALITY - TUNING KNOBS\n\t\t------------------------------------------------------------------------------\n\t\tNOTE the other tuning knobs are now in the shader function inputs!\n\t\t============================================================================*/\n\t\t#ifndef FXAA_QUALITY_PRESET\n\t\t\t\t//\n\t\t\t\t// Choose the quality preset.\n\t\t\t\t// This needs to be compiled into the shader as it effects code.\n\t\t\t\t// Best option to include multiple presets is to\n\t\t\t\t// in each shader define the preset, then include this file.\n\t\t\t\t//\n\t\t\t\t// OPTIONS\n\t\t\t\t// -----------------------------------------------------------------------\n\t\t\t\t// 10 to 15 - default medium dither (10=fastest, 15=highest quality)\n\t\t\t\t// 20 to 29 - less dither, more expensive (20=fastest, 29=highest quality)\n\t\t\t\t// 39\t\t\t - no dither, very expensive\n\t\t\t\t//\n\t\t\t\t// NOTES\n\t\t\t\t// -----------------------------------------------------------------------\n\t\t\t\t// 12 = slightly faster then FXAA 3.9 and higher edge quality (default)\n\t\t\t\t// 13 = about same speed as FXAA 3.9 and better than 12\n\t\t\t\t// 23 = closest to FXAA 3.9 visually and performance wise\n\t\t\t\t//\t_ = the lowest digit is directly related to performance\n\t\t\t\t// _\t= the highest digit is directly related to style\n\t\t\t\t//\n\t\t\t\t#define FXAA_QUALITY_PRESET 12\n\t\t#endif\n\n\n\t\t/*============================================================================\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t FXAA QUALITY - PRESETS\n\n\t\t============================================================================*/\n\n\t\t/*============================================================================\n\t\t\t\t\t\t\t\t\t\t\t\t FXAA QUALITY - MEDIUM DITHER PRESETS\n\t\t============================================================================*/\n\t\t#if (FXAA_QUALITY_PRESET == 10)\n\t\t\t\t#define FXAA_QUALITY_PS 3\n\t\t\t\t#define FXAA_QUALITY_P0 1.5\n\t\t\t\t#define FXAA_QUALITY_P1 3.0\n\t\t\t\t#define FXAA_QUALITY_P2 12.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 11)\n\t\t\t\t#define FXAA_QUALITY_PS 4\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 3.0\n\t\t\t\t#define FXAA_QUALITY_P3 12.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 12)\n\t\t\t\t#define FXAA_QUALITY_PS 5\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 4.0\n\t\t\t\t#define FXAA_QUALITY_P4 12.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 13)\n\t\t\t\t#define FXAA_QUALITY_PS 6\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 2.0\n\t\t\t\t#define FXAA_QUALITY_P4 4.0\n\t\t\t\t#define FXAA_QUALITY_P5 12.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 14)\n\t\t\t\t#define FXAA_QUALITY_PS 7\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 2.0\n\t\t\t\t#define FXAA_QUALITY_P4 2.0\n\t\t\t\t#define FXAA_QUALITY_P5 4.0\n\t\t\t\t#define FXAA_QUALITY_P6 12.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 15)\n\t\t\t\t#define FXAA_QUALITY_PS 8\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 2.0\n\t\t\t\t#define FXAA_QUALITY_P4 2.0\n\t\t\t\t#define FXAA_QUALITY_P5 2.0\n\t\t\t\t#define FXAA_QUALITY_P6 4.0\n\t\t\t\t#define FXAA_QUALITY_P7 12.0\n\t\t#endif\n\n\t\t/*============================================================================\n\t\t\t\t\t\t\t\t\t\t\t\t FXAA QUALITY - LOW DITHER PRESETS\n\t\t============================================================================*/\n\t\t#if (FXAA_QUALITY_PRESET == 20)\n\t\t\t\t#define FXAA_QUALITY_PS 3\n\t\t\t\t#define FXAA_QUALITY_P0 1.5\n\t\t\t\t#define FXAA_QUALITY_P1 2.0\n\t\t\t\t#define FXAA_QUALITY_P2 8.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 21)\n\t\t\t\t#define FXAA_QUALITY_PS 4\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 8.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 22)\n\t\t\t\t#define FXAA_QUALITY_PS 5\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 2.0\n\t\t\t\t#define FXAA_QUALITY_P4 8.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 23)\n\t\t\t\t#define FXAA_QUALITY_PS 6\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 2.0\n\t\t\t\t#define FXAA_QUALITY_P4 2.0\n\t\t\t\t#define FXAA_QUALITY_P5 8.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 24)\n\t\t\t\t#define FXAA_QUALITY_PS 7\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 2.0\n\t\t\t\t#define FXAA_QUALITY_P4 2.0\n\t\t\t\t#define FXAA_QUALITY_P5 3.0\n\t\t\t\t#define FXAA_QUALITY_P6 8.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 25)\n\t\t\t\t#define FXAA_QUALITY_PS 8\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 2.0\n\t\t\t\t#define FXAA_QUALITY_P4 2.0\n\t\t\t\t#define FXAA_QUALITY_P5 2.0\n\t\t\t\t#define FXAA_QUALITY_P6 4.0\n\t\t\t\t#define FXAA_QUALITY_P7 8.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 26)\n\t\t\t\t#define FXAA_QUALITY_PS 9\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 2.0\n\t\t\t\t#define FXAA_QUALITY_P4 2.0\n\t\t\t\t#define FXAA_QUALITY_P5 2.0\n\t\t\t\t#define FXAA_QUALITY_P6 2.0\n\t\t\t\t#define FXAA_QUALITY_P7 4.0\n\t\t\t\t#define FXAA_QUALITY_P8 8.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 27)\n\t\t\t\t#define FXAA_QUALITY_PS 10\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 2.0\n\t\t\t\t#define FXAA_QUALITY_P4 2.0\n\t\t\t\t#define FXAA_QUALITY_P5 2.0\n\t\t\t\t#define FXAA_QUALITY_P6 2.0\n\t\t\t\t#define FXAA_QUALITY_P7 2.0\n\t\t\t\t#define FXAA_QUALITY_P8 4.0\n\t\t\t\t#define FXAA_QUALITY_P9 8.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 28)\n\t\t\t\t#define FXAA_QUALITY_PS 11\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 2.0\n\t\t\t\t#define FXAA_QUALITY_P4 2.0\n\t\t\t\t#define FXAA_QUALITY_P5 2.0\n\t\t\t\t#define FXAA_QUALITY_P6 2.0\n\t\t\t\t#define FXAA_QUALITY_P7 2.0\n\t\t\t\t#define FXAA_QUALITY_P8 2.0\n\t\t\t\t#define FXAA_QUALITY_P9 4.0\n\t\t\t\t#define FXAA_QUALITY_P10 8.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 29)\n\t\t\t\t#define FXAA_QUALITY_PS 12\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 2.0\n\t\t\t\t#define FXAA_QUALITY_P4 2.0\n\t\t\t\t#define FXAA_QUALITY_P5 2.0\n\t\t\t\t#define FXAA_QUALITY_P6 2.0\n\t\t\t\t#define FXAA_QUALITY_P7 2.0\n\t\t\t\t#define FXAA_QUALITY_P8 2.0\n\t\t\t\t#define FXAA_QUALITY_P9 2.0\n\t\t\t\t#define FXAA_QUALITY_P10 4.0\n\t\t\t\t#define FXAA_QUALITY_P11 8.0\n\t\t#endif\n\n\t\t/*============================================================================\n\t\t\t\t\t\t\t\t\t\t\t\t FXAA QUALITY - EXTREME QUALITY\n\t\t============================================================================*/\n\t\t#if (FXAA_QUALITY_PRESET == 39)\n\t\t\t\t#define FXAA_QUALITY_PS 12\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.0\n\t\t\t\t#define FXAA_QUALITY_P2 1.0\n\t\t\t\t#define FXAA_QUALITY_P3 1.0\n\t\t\t\t#define FXAA_QUALITY_P4 1.0\n\t\t\t\t#define FXAA_QUALITY_P5 1.5\n\t\t\t\t#define FXAA_QUALITY_P6 2.0\n\t\t\t\t#define FXAA_QUALITY_P7 2.0\n\t\t\t\t#define FXAA_QUALITY_P8 2.0\n\t\t\t\t#define FXAA_QUALITY_P9 2.0\n\t\t\t\t#define FXAA_QUALITY_P10 4.0\n\t\t\t\t#define FXAA_QUALITY_P11 8.0\n\t\t#endif\n\n\n\n\t\t/*============================================================================\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAPI PORTING\n\n\t\t============================================================================*/\n\t\t#if (FXAA_GLSL_100 == 1) || (FXAA_GLSL_120 == 1) || (FXAA_GLSL_130 == 1)\n\t\t\t\t#define FxaaBool bool\n\t\t\t\t#define FxaaDiscard discard\n\t\t\t\t#define FxaaFloat float\n\t\t\t\t#define FxaaFloat2 vec2\n\t\t\t\t#define FxaaFloat3 vec3\n\t\t\t\t#define FxaaFloat4 vec4\n\t\t\t\t#define FxaaHalf float\n\t\t\t\t#define FxaaHalf2 vec2\n\t\t\t\t#define FxaaHalf3 vec3\n\t\t\t\t#define FxaaHalf4 vec4\n\t\t\t\t#define FxaaInt2 ivec2\n\t\t\t\t#define FxaaSat(x) clamp(x, 0.0, 1.0)\n\t\t\t\t#define FxaaTex sampler2D\n\t\t#else\n\t\t\t\t#define FxaaBool bool\n\t\t\t\t#define FxaaDiscard clip(-1)\n\t\t\t\t#define FxaaFloat float\n\t\t\t\t#define FxaaFloat2 float2\n\t\t\t\t#define FxaaFloat3 float3\n\t\t\t\t#define FxaaFloat4 float4\n\t\t\t\t#define FxaaHalf half\n\t\t\t\t#define FxaaHalf2 half2\n\t\t\t\t#define FxaaHalf3 half3\n\t\t\t\t#define FxaaHalf4 half4\n\t\t\t\t#define FxaaSat(x) saturate(x)\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_GLSL_100 == 1)\n\t\t\t#define FxaaTexTop(t, p) texture2D(t, p, 0.0)\n\t\t\t#define FxaaTexOff(t, p, o, r) texture2D(t, p + (o * r), 0.0)\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_GLSL_120 == 1)\n\t\t\t\t// Requires,\n\t\t\t\t//\t#version 120\n\t\t\t\t// And at least,\n\t\t\t\t//\t#extension GL_EXT_gpu_shader4 : enable\n\t\t\t\t//\t(or set FXAA_FAST_PIXEL_OFFSET 1 to work like DX9)\n\t\t\t\t#define FxaaTexTop(t, p) texture2DLod(t, p, 0.0)\n\t\t\t\t#if (FXAA_FAST_PIXEL_OFFSET == 1)\n\t\t\t\t\t\t#define FxaaTexOff(t, p, o, r) texture2DLodOffset(t, p, 0.0, o)\n\t\t\t\t#else\n\t\t\t\t\t\t#define FxaaTexOff(t, p, o, r) texture2DLod(t, p + (o * r), 0.0)\n\t\t\t\t#endif\n\t\t\t\t#if (FXAA_GATHER4_ALPHA == 1)\n\t\t\t\t\t\t// use #extension GL_ARB_gpu_shader5 : enable\n\t\t\t\t\t\t#define FxaaTexAlpha4(t, p) textureGather(t, p, 3)\n\t\t\t\t\t\t#define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)\n\t\t\t\t\t\t#define FxaaTexGreen4(t, p) textureGather(t, p, 1)\n\t\t\t\t\t\t#define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)\n\t\t\t\t#endif\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_GLSL_130 == 1)\n\t\t\t\t// Requires "#version 130" or better\n\t\t\t\t#define FxaaTexTop(t, p) textureLod(t, p, 0.0)\n\t\t\t\t#define FxaaTexOff(t, p, o, r) textureLodOffset(t, p, 0.0, o)\n\t\t\t\t#if (FXAA_GATHER4_ALPHA == 1)\n\t\t\t\t\t\t// use #extension GL_ARB_gpu_shader5 : enable\n\t\t\t\t\t\t#define FxaaTexAlpha4(t, p) textureGather(t, p, 3)\n\t\t\t\t\t\t#define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)\n\t\t\t\t\t\t#define FxaaTexGreen4(t, p) textureGather(t, p, 1)\n\t\t\t\t\t\t#define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)\n\t\t\t\t#endif\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_HLSL_3 == 1)\n\t\t\t\t#define FxaaInt2 float2\n\t\t\t\t#define FxaaTex sampler2D\n\t\t\t\t#define FxaaTexTop(t, p) tex2Dlod(t, float4(p, 0.0, 0.0))\n\t\t\t\t#define FxaaTexOff(t, p, o, r) tex2Dlod(t, float4(p + (o * r), 0, 0))\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_HLSL_4 == 1)\n\t\t\t\t#define FxaaInt2 int2\n\t\t\t\tstruct FxaaTex { SamplerState smpl; Texture2D tex; };\n\t\t\t\t#define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)\n\t\t\t\t#define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_HLSL_5 == 1)\n\t\t\t\t#define FxaaInt2 int2\n\t\t\t\tstruct FxaaTex { SamplerState smpl; Texture2D tex; };\n\t\t\t\t#define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)\n\t\t\t\t#define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)\n\t\t\t\t#define FxaaTexAlpha4(t, p) t.tex.GatherAlpha(t.smpl, p)\n\t\t\t\t#define FxaaTexOffAlpha4(t, p, o) t.tex.GatherAlpha(t.smpl, p, o)\n\t\t\t\t#define FxaaTexGreen4(t, p) t.tex.GatherGreen(t.smpl, p)\n\t\t\t\t#define FxaaTexOffGreen4(t, p, o) t.tex.GatherGreen(t.smpl, p, o)\n\t\t#endif\n\n\n\t\t/*============================================================================\n\t\t\t\t\t\t\t\t\t\t\t GREEN AS LUMA OPTION SUPPORT FUNCTION\n\t\t============================================================================*/\n\t\t#if (FXAA_GREEN_AS_LUMA == 0)\n\t\t\t\tFxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.w; }\n\t\t#else\n\t\t\t\tFxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.y; }\n\t\t#endif\n\n\n\n\n\t\t/*============================================================================\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t FXAA3 QUALITY - PC\n\n\t\t============================================================================*/\n\t\t#if (FXAA_PC == 1)\n\t\t/*--------------------------------------------------------------------------*/\n\t\tFxaaFloat4 FxaaPixelShader(\n\t\t\t\t//\n\t\t\t\t// Use noperspective interpolation here (turn off perspective interpolation).\n\t\t\t\t// {xy} = center of pixel\n\t\t\t\tFxaaFloat2 pos,\n\t\t\t\t//\n\t\t\t\t// Used only for FXAA Console, and not used on the 360 version.\n\t\t\t\t// Use noperspective interpolation here (turn off perspective interpolation).\n\t\t\t\t// {xy_} = upper left of pixel\n\t\t\t\t// {_zw} = lower right of pixel\n\t\t\t\tFxaaFloat4 fxaaConsolePosPos,\n\t\t\t\t//\n\t\t\t\t// Input color texture.\n\t\t\t\t// {rgb_} = color in linear or perceptual color space\n\t\t\t\t// if (FXAA_GREEN_AS_LUMA == 0)\n\t\t\t\t//\t\t {__a} = luma in perceptual color space (not linear)\n\t\t\t\tFxaaTex tex,\n\t\t\t\t//\n\t\t\t\t// Only used on the optimized 360 version of FXAA Console.\n\t\t\t\t// For everything but 360, just use the same input here as for "tex".\n\t\t\t\t// For 360, same texture, just alias with a 2nd sampler.\n\t\t\t\t// This sampler needs to have an exponent bias of -1.\n\t\t\t\tFxaaTex fxaaConsole360TexExpBiasNegOne,\n\t\t\t\t//\n\t\t\t\t// Only used on the optimized 360 version of FXAA Console.\n\t\t\t\t// For everything but 360, just use the same input here as for "tex".\n\t\t\t\t// For 360, same texture, just alias with a 3nd sampler.\n\t\t\t\t// This sampler needs to have an exponent bias of -2.\n\t\t\t\tFxaaTex fxaaConsole360TexExpBiasNegTwo,\n\t\t\t\t//\n\t\t\t\t// Only used on FXAA Quality.\n\t\t\t\t// This must be from a constant/uniform.\n\t\t\t\t// {x_} = 1.0/screenWidthInPixels\n\t\t\t\t// {_y} = 1.0/screenHeightInPixels\n\t\t\t\tFxaaFloat2 fxaaQualityRcpFrame,\n\t\t\t\t//\n\t\t\t\t// Only used on FXAA Console.\n\t\t\t\t// This must be from a constant/uniform.\n\t\t\t\t// This effects sub-pixel AA quality and inversely sharpness.\n\t\t\t\t//\t Where N ranges between,\n\t\t\t\t//\t\t N = 0.50 (default)\n\t\t\t\t//\t\t N = 0.33 (sharper)\n\t\t\t\t// {x__} = -N/screenWidthInPixels\n\t\t\t\t// {_y_} = -N/screenHeightInPixels\n\t\t\t\t// {_z_} =\tN/screenWidthInPixels\n\t\t\t\t// {__w} =\tN/screenHeightInPixels\n\t\t\t\tFxaaFloat4 fxaaConsoleRcpFrameOpt,\n\t\t\t\t//\n\t\t\t\t// Only used on FXAA Console.\n\t\t\t\t// Not used on 360, but used on PS3 and PC.\n\t\t\t\t// This must be from a constant/uniform.\n\t\t\t\t// {x__} = -2.0/screenWidthInPixels\n\t\t\t\t// {_y_} = -2.0/screenHeightInPixels\n\t\t\t\t// {_z_} =\t2.0/screenWidthInPixels\n\t\t\t\t// {__w} =\t2.0/screenHeightInPixels\n\t\t\t\tFxaaFloat4 fxaaConsoleRcpFrameOpt2,\n\t\t\t\t//\n\t\t\t\t// Only used on FXAA Console.\n\t\t\t\t// Only used on 360 in place of fxaaConsoleRcpFrameOpt2.\n\t\t\t\t// This must be from a constant/uniform.\n\t\t\t\t// {x__} =\t8.0/screenWidthInPixels\n\t\t\t\t// {_y_} =\t8.0/screenHeightInPixels\n\t\t\t\t// {_z_} = -4.0/screenWidthInPixels\n\t\t\t\t// {__w} = -4.0/screenHeightInPixels\n\t\t\t\tFxaaFloat4 fxaaConsole360RcpFrameOpt2,\n\t\t\t\t//\n\t\t\t\t// Only used on FXAA Quality.\n\t\t\t\t// This used to be the FXAA_QUALITY_SUBPIX define.\n\t\t\t\t// It is here now to allow easier tuning.\n\t\t\t\t// Choose the amount of sub-pixel aliasing removal.\n\t\t\t\t// This can effect sharpness.\n\t\t\t\t//\t 1.00 - upper limit (softer)\n\t\t\t\t//\t 0.75 - default amount of filtering\n\t\t\t\t//\t 0.50 - lower limit (sharper, less sub-pixel aliasing removal)\n\t\t\t\t//\t 0.25 - almost off\n\t\t\t\t//\t 0.00 - completely off\n\t\t\t\tFxaaFloat fxaaQualitySubpix,\n\t\t\t\t//\n\t\t\t\t// Only used on FXAA Quality.\n\t\t\t\t// This used to be the FXAA_QUALITY_EDGE_THRESHOLD define.\n\t\t\t\t// It is here now to allow easier tuning.\n\t\t\t\t// The minimum amount of local contrast required to apply algorithm.\n\t\t\t\t//\t 0.333 - too little (faster)\n\t\t\t\t//\t 0.250 - low quality\n\t\t\t\t//\t 0.166 - default\n\t\t\t\t//\t 0.125 - high quality\n\t\t\t\t//\t 0.063 - overkill (slower)\n\t\t\t\tFxaaFloat fxaaQualityEdgeThreshold,\n\t\t\t\t//\n\t\t\t\t// Only used on FXAA Quality.\n\t\t\t\t// This used to be the FXAA_QUALITY_EDGE_THRESHOLD_MIN define.\n\t\t\t\t// It is here now to allow easier tuning.\n\t\t\t\t// Trims the algorithm from processing darks.\n\t\t\t\t//\t 0.0833 - upper limit (default, the start of visible unfiltered edges)\n\t\t\t\t//\t 0.0625 - high quality (faster)\n\t\t\t\t//\t 0.0312 - visible limit (slower)\n\t\t\t\t// Special notes when using FXAA_GREEN_AS_LUMA,\n\t\t\t\t//\t Likely want to set this to zero.\n\t\t\t\t//\t As colors that are mostly not-green\n\t\t\t\t//\t will appear very dark in the green channel!\n\t\t\t\t//\t Tune by looking at mostly non-green content,\n\t\t\t\t//\t then start at zero and increase until aliasing is a problem.\n\t\t\t\tFxaaFloat fxaaQualityEdgeThresholdMin,\n\t\t\t\t//\n\t\t\t\t// Only used on FXAA Console.\n\t\t\t\t// This used to be the FXAA_CONSOLE_EDGE_SHARPNESS define.\n\t\t\t\t// It is here now to allow easier tuning.\n\t\t\t\t// This does not effect PS3, as this needs to be compiled in.\n\t\t\t\t//\t Use FXAA_CONSOLE_PS3_EDGE_SHARPNESS for PS3.\n\t\t\t\t//\t Due to the PS3 being ALU bound,\n\t\t\t\t//\t there are only three safe values here: 2 and 4 and 8.\n\t\t\t\t//\t These options use the shaders ability to a free *|/ by 2|4|8.\n\t\t\t\t// For all other platforms can be a non-power of two.\n\t\t\t\t//\t 8.0 is sharper (default!!!)\n\t\t\t\t//\t 4.0 is softer\n\t\t\t\t//\t 2.0 is really soft (good only for vector graphics inputs)\n\t\t\t\tFxaaFloat fxaaConsoleEdgeSharpness,\n\t\t\t\t//\n\t\t\t\t// Only used on FXAA Console.\n\t\t\t\t// This used to be the FXAA_CONSOLE_EDGE_THRESHOLD define.\n\t\t\t\t// It is here now to allow easier tuning.\n\t\t\t\t// This does not effect PS3, as this needs to be compiled in.\n\t\t\t\t//\t Use FXAA_CONSOLE_PS3_EDGE_THRESHOLD for PS3.\n\t\t\t\t//\t Due to the PS3 being ALU bound,\n\t\t\t\t//\t there are only two safe values here: 1/4 and 1/8.\n\t\t\t\t//\t These options use the shaders ability to a free *|/ by 2|4|8.\n\t\t\t\t// The console setting has a different mapping than the quality setting.\n\t\t\t\t// Other platforms can use other values.\n\t\t\t\t//\t 0.125 leaves less aliasing, but is softer (default!!!)\n\t\t\t\t//\t 0.25 leaves more aliasing, and is sharper\n\t\t\t\tFxaaFloat fxaaConsoleEdgeThreshold,\n\t\t\t\t//\n\t\t\t\t// Only used on FXAA Console.\n\t\t\t\t// This used to be the FXAA_CONSOLE_EDGE_THRESHOLD_MIN define.\n\t\t\t\t// It is here now to allow easier tuning.\n\t\t\t\t// Trims the algorithm from processing darks.\n\t\t\t\t// The console setting has a different mapping than the quality setting.\n\t\t\t\t// This only applies when FXAA_EARLY_EXIT is 1.\n\t\t\t\t// This does not apply to PS3,\n\t\t\t\t// PS3 was simplified to avoid more shader instructions.\n\t\t\t\t//\t 0.06 - faster but more aliasing in darks\n\t\t\t\t//\t 0.05 - default\n\t\t\t\t//\t 0.04 - slower and less aliasing in darks\n\t\t\t\t// Special notes when using FXAA_GREEN_AS_LUMA,\n\t\t\t\t//\t Likely want to set this to zero.\n\t\t\t\t//\t As colors that are mostly not-green\n\t\t\t\t//\t will appear very dark in the green channel!\n\t\t\t\t//\t Tune by looking at mostly non-green content,\n\t\t\t\t//\t then start at zero and increase until aliasing is a problem.\n\t\t\t\tFxaaFloat fxaaConsoleEdgeThresholdMin,\n\t\t\t\t//\n\t\t\t\t// Extra constants for 360 FXAA Console only.\n\t\t\t\t// Use zeros or anything else for other platforms.\n\t\t\t\t// These must be in physical constant registers and NOT immediates.\n\t\t\t\t// Immediates will result in compiler un-optimizing.\n\t\t\t\t// {xyzw} = float4(1.0, -1.0, 0.25, -0.25)\n\t\t\t\tFxaaFloat4 fxaaConsole360ConstDir\n\t\t) {\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaFloat2 posM;\n\t\t\t\tposM.x = pos.x;\n\t\t\t\tposM.y = pos.y;\n\t\t\t\t#if (FXAA_GATHER4_ALPHA == 1)\n\t\t\t\t\t\t#if (FXAA_DISCARD == 0)\n\t\t\t\t\t\t\t\tFxaaFloat4 rgbyM = FxaaTexTop(tex, posM);\n\t\t\t\t\t\t\t\t#if (FXAA_GREEN_AS_LUMA == 0)\n\t\t\t\t\t\t\t\t\t\t#define lumaM rgbyM.w\n\t\t\t\t\t\t\t\t#else\n\t\t\t\t\t\t\t\t\t\t#define lumaM rgbyM.y\n\t\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t#endif\n\t\t\t\t\t\t#if (FXAA_GREEN_AS_LUMA == 0)\n\t\t\t\t\t\t\t\tFxaaFloat4 luma4A = FxaaTexAlpha4(tex, posM);\n\t\t\t\t\t\t\t\tFxaaFloat4 luma4B = FxaaTexOffAlpha4(tex, posM, FxaaInt2(-1, -1));\n\t\t\t\t\t\t#else\n\t\t\t\t\t\t\t\tFxaaFloat4 luma4A = FxaaTexGreen4(tex, posM);\n\t\t\t\t\t\t\t\tFxaaFloat4 luma4B = FxaaTexOffGreen4(tex, posM, FxaaInt2(-1, -1));\n\t\t\t\t\t\t#endif\n\t\t\t\t\t\t#if (FXAA_DISCARD == 1)\n\t\t\t\t\t\t\t\t#define lumaM luma4A.w\n\t\t\t\t\t\t#endif\n\t\t\t\t\t\t#define lumaE luma4A.z\n\t\t\t\t\t\t#define lumaS luma4A.x\n\t\t\t\t\t\t#define lumaSE luma4A.y\n\t\t\t\t\t\t#define lumaNW luma4B.w\n\t\t\t\t\t\t#define lumaN luma4B.z\n\t\t\t\t\t\t#define lumaW luma4B.x\n\t\t\t\t#else\n\t\t\t\t\t\tFxaaFloat4 rgbyM = FxaaTexTop(tex, posM);\n\t\t\t\t\t\t#if (FXAA_GREEN_AS_LUMA == 0)\n\t\t\t\t\t\t\t\t#define lumaM rgbyM.w\n\t\t\t\t\t\t#else\n\t\t\t\t\t\t\t\t#define lumaM rgbyM.y\n\t\t\t\t\t\t#endif\n\t\t\t\t\t\t#if (FXAA_GLSL_100 == 1)\n\t\t\t\t\t\t\tFxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0, 1.0), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 0.0), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0,-1.0), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 0.0), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t#else\n\t\t\t\t\t\t\tFxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0, 1), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 0), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0,-1), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 0), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t#endif\n\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaFloat maxSM = max(lumaS, lumaM);\n\t\t\t\tFxaaFloat minSM = min(lumaS, lumaM);\n\t\t\t\tFxaaFloat maxESM = max(lumaE, maxSM);\n\t\t\t\tFxaaFloat minESM = min(lumaE, minSM);\n\t\t\t\tFxaaFloat maxWN = max(lumaN, lumaW);\n\t\t\t\tFxaaFloat minWN = min(lumaN, lumaW);\n\t\t\t\tFxaaFloat rangeMax = max(maxWN, maxESM);\n\t\t\t\tFxaaFloat rangeMin = min(minWN, minESM);\n\t\t\t\tFxaaFloat rangeMaxScaled = rangeMax * fxaaQualityEdgeThreshold;\n\t\t\t\tFxaaFloat range = rangeMax - rangeMin;\n\t\t\t\tFxaaFloat rangeMaxClamped = max(fxaaQualityEdgeThresholdMin, rangeMaxScaled);\n\t\t\t\tFxaaBool earlyExit = range < rangeMaxClamped;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tif(earlyExit)\n\t\t\t\t\t\t#if (FXAA_DISCARD == 1)\n\t\t\t\t\t\t\t\tFxaaDiscard;\n\t\t\t\t\t\t#else\n\t\t\t\t\t\t\t\treturn rgbyM;\n\t\t\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t#if (FXAA_GATHER4_ALPHA == 0)\n\t\t\t\t\t\t#if (FXAA_GLSL_100 == 1)\n\t\t\t\t\t\t\tFxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0,-1.0), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 1.0), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0,-1.0), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 1.0), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t#else\n\t\t\t\t\t\t\tFxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1,-1), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 1), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1,-1), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t#endif\n\t\t\t\t#else\n\t\t\t\t\t\tFxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(1, -1), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\tFxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));\n\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaFloat lumaNS = lumaN + lumaS;\n\t\t\t\tFxaaFloat lumaWE = lumaW + lumaE;\n\t\t\t\tFxaaFloat subpixRcpRange = 1.0/range;\n\t\t\t\tFxaaFloat subpixNSWE = lumaNS + lumaWE;\n\t\t\t\tFxaaFloat edgeHorz1 = (-2.0 * lumaM) + lumaNS;\n\t\t\t\tFxaaFloat edgeVert1 = (-2.0 * lumaM) + lumaWE;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaFloat lumaNESE = lumaNE + lumaSE;\n\t\t\t\tFxaaFloat lumaNWNE = lumaNW + lumaNE;\n\t\t\t\tFxaaFloat edgeHorz2 = (-2.0 * lumaE) + lumaNESE;\n\t\t\t\tFxaaFloat edgeVert2 = (-2.0 * lumaN) + lumaNWNE;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaFloat lumaNWSW = lumaNW + lumaSW;\n\t\t\t\tFxaaFloat lumaSWSE = lumaSW + lumaSE;\n\t\t\t\tFxaaFloat edgeHorz4 = (abs(edgeHorz1) * 2.0) + abs(edgeHorz2);\n\t\t\t\tFxaaFloat edgeVert4 = (abs(edgeVert1) * 2.0) + abs(edgeVert2);\n\t\t\t\tFxaaFloat edgeHorz3 = (-2.0 * lumaW) + lumaNWSW;\n\t\t\t\tFxaaFloat edgeVert3 = (-2.0 * lumaS) + lumaSWSE;\n\t\t\t\tFxaaFloat edgeHorz = abs(edgeHorz3) + edgeHorz4;\n\t\t\t\tFxaaFloat edgeVert = abs(edgeVert3) + edgeVert4;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaFloat subpixNWSWNESE = lumaNWSW + lumaNESE;\n\t\t\t\tFxaaFloat lengthSign = fxaaQualityRcpFrame.x;\n\t\t\t\tFxaaBool horzSpan = edgeHorz >= edgeVert;\n\t\t\t\tFxaaFloat subpixA = subpixNSWE * 2.0 + subpixNWSWNESE;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tif(!horzSpan) lumaN = lumaW;\n\t\t\t\tif(!horzSpan) lumaS = lumaE;\n\t\t\t\tif(horzSpan) lengthSign = fxaaQualityRcpFrame.y;\n\t\t\t\tFxaaFloat subpixB = (subpixA * (1.0/12.0)) - lumaM;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaFloat gradientN = lumaN - lumaM;\n\t\t\t\tFxaaFloat gradientS = lumaS - lumaM;\n\t\t\t\tFxaaFloat lumaNN = lumaN + lumaM;\n\t\t\t\tFxaaFloat lumaSS = lumaS + lumaM;\n\t\t\t\tFxaaBool pairN = abs(gradientN) >= abs(gradientS);\n\t\t\t\tFxaaFloat gradient = max(abs(gradientN), abs(gradientS));\n\t\t\t\tif(pairN) lengthSign = -lengthSign;\n\t\t\t\tFxaaFloat subpixC = FxaaSat(abs(subpixB) * subpixRcpRange);\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaFloat2 posB;\n\t\t\t\tposB.x = posM.x;\n\t\t\t\tposB.y = posM.y;\n\t\t\t\tFxaaFloat2 offNP;\n\t\t\t\toffNP.x = (!horzSpan) ? 0.0 : fxaaQualityRcpFrame.x;\n\t\t\t\toffNP.y = ( horzSpan) ? 0.0 : fxaaQualityRcpFrame.y;\n\t\t\t\tif(!horzSpan) posB.x += lengthSign * 0.5;\n\t\t\t\tif( horzSpan) posB.y += lengthSign * 0.5;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaFloat2 posN;\n\t\t\t\tposN.x = posB.x - offNP.x * FXAA_QUALITY_P0;\n\t\t\t\tposN.y = posB.y - offNP.y * FXAA_QUALITY_P0;\n\t\t\t\tFxaaFloat2 posP;\n\t\t\t\tposP.x = posB.x + offNP.x * FXAA_QUALITY_P0;\n\t\t\t\tposP.y = posB.y + offNP.y * FXAA_QUALITY_P0;\n\t\t\t\tFxaaFloat subpixD = ((-2.0)*subpixC) + 3.0;\n\t\t\t\tFxaaFloat lumaEndN = FxaaLuma(FxaaTexTop(tex, posN));\n\t\t\t\tFxaaFloat subpixE = subpixC * subpixC;\n\t\t\t\tFxaaFloat lumaEndP = FxaaLuma(FxaaTexTop(tex, posP));\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tif(!pairN) lumaNN = lumaSS;\n\t\t\t\tFxaaFloat gradientScaled = gradient * 1.0/4.0;\n\t\t\t\tFxaaFloat lumaMM = lumaM - lumaNN * 0.5;\n\t\t\t\tFxaaFloat subpixF = subpixD * subpixE;\n\t\t\t\tFxaaBool lumaMLTZero = lumaMM < 0.0;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tlumaEndN -= lumaNN * 0.5;\n\t\t\t\tlumaEndP -= lumaNN * 0.5;\n\t\t\t\tFxaaBool doneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\tFxaaBool doneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P1;\n\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P1;\n\t\t\t\tFxaaBool doneNP = (!doneN) || (!doneP);\n\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P1;\n\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P1;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tif(doneNP) {\n\t\t\t\t\t\tif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n\t\t\t\t\t\tif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n\t\t\t\t\t\tif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n\t\t\t\t\t\tif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n\t\t\t\t\t\tdoneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\t\t\tdoneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P2;\n\t\t\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P2;\n\t\t\t\t\t\tdoneNP = (!doneN) || (!doneP);\n\t\t\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P2;\n\t\t\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P2;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t#if (FXAA_QUALITY_PS > 3)\n\t\t\t\t\t\tif(doneNP) {\n\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n\t\t\t\t\t\t\t\tdoneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\t\t\t\t\tdoneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\t\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P3;\n\t\t\t\t\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P3;\n\t\t\t\t\t\t\t\tdoneNP = (!doneN) || (!doneP);\n\t\t\t\t\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P3;\n\t\t\t\t\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P3;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t#if (FXAA_QUALITY_PS > 4)\n\t\t\t\t\t\t\t\tif(doneNP) {\n\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\tdoneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\tdoneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P4;\n\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P4;\n\t\t\t\t\t\t\t\t\t\tdoneNP = (!doneN) || (!doneP);\n\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P4;\n\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P4;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t\t\t#if (FXAA_QUALITY_PS > 5)\n\t\t\t\t\t\t\t\t\t\tif(doneNP) {\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\t\t\tdoneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\t\t\tdoneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P5;\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P5;\n\t\t\t\t\t\t\t\t\t\t\t\tdoneNP = (!doneN) || (!doneP);\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P5;\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P5;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t\t\t\t\t#if (FXAA_QUALITY_PS > 6)\n\t\t\t\t\t\t\t\t\t\t\t\tif(doneNP) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdoneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdoneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P6;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P6;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdoneNP = (!doneN) || (!doneP);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P6;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P6;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t#if (FXAA_QUALITY_PS > 7)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(doneNP) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdoneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdoneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P7;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P7;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdoneNP = (!doneN) || (!doneP);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P7;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P7;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t#if (FXAA_QUALITY_PS > 8)\n\t\t\t\tif(doneNP) {\n\t\t\t\t\t\tif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n\t\t\t\t\t\tif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n\t\t\t\t\t\tif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n\t\t\t\t\t\tif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n\t\t\t\t\t\tdoneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\t\t\tdoneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P8;\n\t\t\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P8;\n\t\t\t\t\t\tdoneNP = (!doneN) || (!doneP);\n\t\t\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P8;\n\t\t\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P8;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t#if (FXAA_QUALITY_PS > 9)\n\t\t\t\t\t\tif(doneNP) {\n\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n\t\t\t\t\t\t\t\tdoneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\t\t\t\t\tdoneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\t\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P9;\n\t\t\t\t\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P9;\n\t\t\t\t\t\t\t\tdoneNP = (!doneN) || (!doneP);\n\t\t\t\t\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P9;\n\t\t\t\t\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P9;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t#if (FXAA_QUALITY_PS > 10)\n\t\t\t\t\t\t\t\tif(doneNP) {\n\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\tdoneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\tdoneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P10;\n\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P10;\n\t\t\t\t\t\t\t\t\t\tdoneNP = (!doneN) || (!doneP);\n\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P10;\n\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P10;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t\t\t#if (FXAA_QUALITY_PS > 11)\n\t\t\t\t\t\t\t\t\t\tif(doneNP) {\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\t\t\tdoneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\t\t\tdoneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P11;\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P11;\n\t\t\t\t\t\t\t\t\t\t\t\tdoneNP = (!doneN) || (!doneP);\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P11;\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P11;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t\t\t\t\t#if (FXAA_QUALITY_PS > 12)\n\t\t\t\t\t\t\t\t\t\t\t\tif(doneNP) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdoneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdoneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P12;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P12;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdoneNP = (!doneN) || (!doneP);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P12;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P12;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t}\n\t\t\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t}\n\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t}\n\t\t\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t}\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaFloat dstN = posM.x - posN.x;\n\t\t\t\tFxaaFloat dstP = posP.x - posM.x;\n\t\t\t\tif(!horzSpan) dstN = posM.y - posN.y;\n\t\t\t\tif(!horzSpan) dstP = posP.y - posM.y;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaBool goodSpanN = (lumaEndN < 0.0) != lumaMLTZero;\n\t\t\t\tFxaaFloat spanLength = (dstP + dstN);\n\t\t\t\tFxaaBool goodSpanP = (lumaEndP < 0.0) != lumaMLTZero;\n\t\t\t\tFxaaFloat spanLengthRcp = 1.0/spanLength;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaBool directionN = dstN < dstP;\n\t\t\t\tFxaaFloat dst = min(dstN, dstP);\n\t\t\t\tFxaaBool goodSpan = directionN ? goodSpanN : goodSpanP;\n\t\t\t\tFxaaFloat subpixG = subpixF * subpixF;\n\t\t\t\tFxaaFloat pixelOffset = (dst * (-spanLengthRcp)) + 0.5;\n\t\t\t\tFxaaFloat subpixH = subpixG * fxaaQualitySubpix;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaFloat pixelOffsetGood = goodSpan ? pixelOffset : 0.0;\n\t\t\t\tFxaaFloat pixelOffsetSubpix = max(pixelOffsetGood, subpixH);\n\t\t\t\tif(!horzSpan) posM.x += pixelOffsetSubpix * lengthSign;\n\t\t\t\tif( horzSpan) posM.y += pixelOffsetSubpix * lengthSign;\n\t\t\t\t#if (FXAA_DISCARD == 1)\n\t\t\t\t\t\treturn FxaaTexTop(tex, posM);\n\t\t\t\t#else\n\t\t\t\t\t\treturn FxaaFloat4(FxaaTexTop(tex, posM).xyz, lumaM);\n\t\t\t\t#endif\n\t\t}\n\t\t/*==========================================================================*/\n\t\t#endif\n\n\t\tvoid main() {\n\t\t\tgl_FragColor = FxaaPixelShader(\n\t\t\t\tvUv,\n\t\t\t\tvec4(0.0),\n\t\t\t\ttDiffuse,\n\t\t\t\ttDiffuse,\n\t\t\t\ttDiffuse,\n\t\t\t\tresolution,\n\t\t\t\tvec4(0.0),\n\t\t\t\tvec4(0.0),\n\t\t\t\tvec4(0.0),\n\t\t\t\t0.75,\n\t\t\t\t0.166,\n\t\t\t\t0.0833,\n\t\t\t\t0.0,\n\t\t\t\t0.0,\n\t\t\t\t0.0,\n\t\t\t\tvec4(0.0)\n\t\t\t);\n\n\t\t\t// TODO avoid querying texture twice for same texel\n\t\t\tgl_FragColor.a = texture2D(tDiffuse, vUv).a;\n\t\t}'};function An(t){return An="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},An(t)}function Tn(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function wn(t,e){return wn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},wn(t,e)}function Sn(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Fn(t);if(e){var i=Fn(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Nn(this,n)}}function Nn(t,e){if(e&&("object"===An(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Fn(t){return Fn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Fn(t)}var Pn=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&wn(t,e)}(o,t);var e,n,r,i=Sn(o);function o(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),i.call(this,bn)}return e=o,(n=[{key:"setSize",value:function(t,e){var n=this.material.uniforms.resolution.value;n.x=1/t,n.y=1/e}}])&&Tn(e.prototype,n),r&&Tn(e,r),Object.defineProperty(e,"prototype",{writable:!1}),o}(Ft);function Ln(t){return Ln="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ln(t)}function On(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function En(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Cn(t,e){return Cn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Cn(t,e)}function In(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Rn(t);if(e){var i=Rn(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Un(this,n)}}function Un(t,e){if(e&&("object"===Ln(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Rn(t){return Rn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Rn(t)}var Mn,zn,Dn=function(e){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Cn(t,e)}(a,e);var n,r,i,o=In(a);function a(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.5;En(this,a);var s=(e=o.call(this,new t.ShaderMaterial(a.shader))).material.uniforms;return s.uTop.value=n,s.uBottom.value=r,s.uFalloff.value=i,e}return n=a,r&&On(n.prototype,r),i&&On(n,i),Object.defineProperty(n,"prototype",{writable:!1}),n}(Ft);Dn.shader={uniforms:{tDiffuse:{value:null},uTop:{value:0},uBottom:{value:0},uFalloff:{value:0}},vertexShader:"varying vec2 vUv;\r\n\r\nvoid main() {\r\n\r\n\tvUv = uv;\r\n\r\n\tgl_Position = vec4( position, 1.0 );\r\n\r\n}",fragmentShader:"\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform float uTop;\n\t\tuniform float uBottom;\n\t\tuniform float uFalloff;\n\t\tvarying vec2 vUv;\n\n\t\t".concat(hn,"\n\n\t\tvoid main() {\n\n\t\t\tfloat falloff = uFalloff;\n\t\t\tfloat amount = uBottom;\n\t\t\tif ( vUv.y > 0.5 ) amount = uTop;\n\n\t\t\tvec4 color = texture2D( tDiffuse, vUv );\n\n\t\t\tfloat dist = distance(vUv.y, 0.5);\n\t\t\tcolor.rgb *= smoothstep( 0.8, falloff * 0.799, dist * (amount + falloff) );\n\t\t\t\n\t\t\tcolor.rgb = bayerMatrixDither( color.rgb );\n\n\t\t\tgl_FragColor = color;\n\n\t\t}\n\t")};var Xn=new t.WebGLRenderer({powerPreference:"high-performance",stencil:!1});Xn.toneMapping=t.ACESFilmicToneMapping;var jn=Xn.domElement;document.getElementById("main").appendChild(jn);var Jn=new class{constructor(e,n){if(this.renderer=e,void 0===n){const r={minFilter:t.LinearFilter,magFilter:t.LinearFilter,format:t.RGBAFormat},i=e.getSize(new t.Vector2);this._pixelRatio=e.getPixelRatio(),this._width=i.width,this._height=i.height,(n=new t.WebGLRenderTarget(this._width*this._pixelRatio,this._height*this._pixelRatio,r)).texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this._width=n.width,this._height=n.height;this.renderTarget1=n,this.renderTarget2=n.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],void 0===At&&console.error("THREE.EffectComposer relies on CopyShader"),void 0===Ft&&console.error("THREE.EffectComposer relies on ShaderPass"),this.copyPass=new Ft(At),this.clock=new t.Clock}swapBuffers(){const t=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=t}addPass(t){this.passes.push(t),t.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(t,e){this.passes.splice(e,0,t),t.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(t){const e=this.passes.indexOf(t);-1!==e&&this.passes.splice(e,1)}isLastEnabledPass(t){for(let e=t+1;e<this.passes.length;e++)if(this.passes[e].enabled)return!1;return!0}render(t){void 0===t&&(t=this.clock.getDelta());const e=this.renderer.getRenderTarget();let n=!1;for(let e=0,r=this.passes.length;e<r;e++){const r=this.passes[e];if(!1!==r.enabled){if(r.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(e),r.render(this.renderer,this.writeBuffer,this.readBuffer,t,n),r.needsSwap){if(n){const e=this.renderer.getContext(),n=this.renderer.state.buffers.stencil;n.setFunc(e.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,t),n.setFunc(e.EQUAL,1,4294967295)}this.swapBuffers()}void 0!==Pt&&(r instanceof Pt?n=!0:r instanceof Lt&&(n=!1))}}this.renderer.setRenderTarget(e)}reset(e){if(void 0===e){const n=this.renderer.getSize(new t.Vector2);this._pixelRatio=this.renderer.getPixelRatio(),this._width=n.width,this._height=n.height,(e=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(t,e){this._width=t,this._height=e;const n=this._width*this._pixelRatio,r=this._height*this._pixelRatio;this.renderTarget1.setSize(n,r),this.renderTarget2.setSize(n,r);for(let t=0;t<this.passes.length;t++)this.passes[t].setSize(n,r)}setPixelRatio(t){this._pixelRatio=t,this.setSize(this._width,this._height)}}(Xn);Mn={renderer:Xn,canvas:jn,composer:Jn,init:function(){var e=window,n=e.innerWidth,r=e.innerHeight,i=e.devicePixelRatio,o=Math.round(n/i),a=Math.round(r/i),s=Qn.current,u=s.bloom,l=s.adjustments;zn={render:new Et(k.scene,k.camera),fxaa:new Pn,bloom:new _n(new t.Vector2(o,a),u.strength,u.radius,u.threshold),vignette:new Dn(.7,1.2,.25),adjustments:new ln(l)},Object.values(zn).forEach((function(t){return Jn.addPass(t)})),Mn.post=zn},resize:function(t,e,n){Xn.setPixelRatio(n),Xn.setSize(t,e),Jn.setSize(t,e),Object.values(zn).forEach((function(r){r.setSize&&r.setSize(t,e,n)}))},update:function(){Jn.render()}};var Qn,kn=new bt.GUI;function Bn(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==n)return;var r,i,o=[],a=!0,s=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(o.push(r.value),!e||o.length!==e);a=!0);}catch(t){s=!0,i=t}finally{try{a||null==n.return||n.return()}finally{if(s)throw i}}return o}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return Vn(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Vn(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Vn(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}kn.init=function(){var t=Qn.orb,e=Mn.post.adjustments,n=kn.addFolder("Orb");n.add(t,"passes",1,4).step(1),n.add(t,"smoothness",3,30).step(1),n.add(t,"speed",1,100).step(1),n.open();var r=kn.addFolder("Rotation");r.add(t.rotationSpeed,"x",-100,100).step(1),r.add(t.rotationSpeed,"y",-100,100).step(1),r.add(t.rotationSpeed,"z",-100,100).step(1),r.open();var i=1/Math.pow(10,h.digits),o=kn.addFolder("Color");o.add(t,"value1",0,1).step(i),o.add(t,"value2",0,1).step(i),o.add(e,"hue",0,2*Math.PI).step(i),o.add(e,"saturation",0,3).step(i),o.open();var a,s,u,l="save (URL)",c=kn.addFolder("Settings");if(c.add(Qn,"reset"),c.add(Qn,"random"),c.add((a={},s=l,u=Qn.save,s in a?Object.defineProperty(a,s,{value:u,enumerable:!0,configurable:!0,writable:!0}):a[s]=u,a),l),c.open(),kn.updateDisplay=function(){return kn.controllersRecursive().forEach((function(t){return t.updateDisplay()}))},window.sessionStorage){var f="closeGUI";"false"!==window.sessionStorage.getItem(f)&&kn.close(),kn.domElement.addEventListener("click",(function(){window.sessionStorage.setItem(f,kn.closed)}))}};var Yn="rotationSpeed";function Hn(){var t=Qn,e=t.orb,n=t.current;if(Qn.orb){var r=Mn.post.adjustments;Object.entries(n.adjustments).forEach((function(t){var e=Bn(t,2),n=e[0],i=e[1];r[n]=i})),Object.entries(n.orb).forEach((function(t){var n=Bn(t,2),r=n[0],i=n[1];r!==Yn&&(e[r]=i)})),Object.entries(n.orb.rotationSpeed).forEach((function(t){var n=Bn(t,2),r=n[0],i=n[1];e.rotationSpeed[r]=i})),kn.updateDisplay()}}function Wn(){var t="Orion",e=h.hash;document.title=e?"".concat(t," #").concat(e):t,e?Kn(e):Zn(!1)}function Gn(){var t=_t.defaults;Qn.current=(0,$.cloneDeep)(t),Qn.reference=(0,$.cloneDeep)(t)}var qn=_t.WINLO_PARAM,$n="seed";function Kn(t){t?yt.seed=t:yt.autoseed(),Qn.current.seed=yt.seed;var e=function(t,e,n){var r=n.min,i=n.max,o=n.round,a=yt.random(r,i,o);t[e]=h.round(a)},n=_t.random,r=Qn.current,i=r.adjustments,o=r.orb;Object.entries(n.adjustments).forEach((function(t){var n=Bn(t,2),r=n[0],o=n[1];yt.random()>.5?e(i,r,o):i[r]=yt.bool()?o.min:o.max})),Object.entries(n.orb).forEach((function(t){var n=Bn(t,2),r=n[0],i=n[1];return e(o,r,i)})),Object.entries(n.rotationSpeed).forEach((function(t){var n=Bn(t,2),r=n[0],i=n[1];yt.random()>.66?e(o.rotationSpeed,r,i):o.rotationSpeed[r]=0})),Qn.reference=(0,$.cloneDeep)(Qn.current),Hn(),t||(t=yt.seed,h.save({seed:t},!1,{hash:$n}))}function Zn(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];t&&h.reset(),Gn(),Hn()}function tr(t){return tr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tr(t)}function er(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function nr(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function rr(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function ir(t,e){return ir=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},ir(t,e)}function or(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=sr(t);if(e){var i=sr(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return ar(this,n)}}function ar(t,e){if(e&&("object"===tr(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function sr(t){return sr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},sr(t)}Qn={random:Kn,save:function(){!function(){var t=Qn,e=t.orb,n=t.current;Object.keys(n.adjustments).forEach((function(t){n.adjustments[t]=h.round(Mn.post.adjustments[t])})),Object.keys(n.orb).forEach((function(t){t!==Yn&&(n.orb[t]=h.round(e[t]))})),Object.keys(n.orb.rotationSpeed).forEach((function(t){n.orb.rotationSpeed[t]=h.round(e.rotationSpeed[t])}))}();var t=Qn,e=t.current,n=t.reference;h.save(e,qn,{reference:n,hash:$n})},load:function(){Wn(),h.load(Qn.current,qn,{hash:$n}),Hn()},reset:Zn,init:function(t){Qn.orb=t,window.addEventListener("hashchange",Wn)}},Gn();var ur=function(e){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ir(t,e)}(a,e);var n,r,i,o=or(a);function a(){var e;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a);var n=Qn.current.orb,r=n.passes,i=n.smoothness,s=n.speed,u=n.value1,l=n.value2,c=n.rotationSpeed,f=new t.SphereGeometry(1,320,320),h=new t.ShaderMaterial({vertexShader:"#define PI acos(-1.0)\n\nuniform int uPasses;\nuniform float uSmoothness;\nuniform float uSpeed;\nuniform float uTime;\nvarying vec4 vPosition;\nvarying float vDistance;\n\n// Classic Perlin 3D Noise, by Stefan Gustavson\nvec4 permute(vec4 x){return mod(((x*34.0)+1.0)*x, 289.0);}\nvec4 taylorInvSqrt(vec4 r){return 1.79284291400159 - 0.85373472095314 * r;}\nvec3 fade(vec3 t) {return t*t*t*(t*(t*6.0-15.0)+10.0);}\n\nfloat cnoise(vec3 P){\n  vec3 Pi0 = floor(P); // Integer part for indexing\n  vec3 Pi1 = Pi0 + vec3(1.0); // Integer part + 1\n  Pi0 = mod(Pi0, 289.0);\n  Pi1 = mod(Pi1, 289.0);\n  vec3 Pf0 = fract(P); // Fractional part for interpolation\n  vec3 Pf1 = Pf0 - vec3(1.0); // Fractional part - 1.0\n  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);\n  vec4 iy = vec4(Pi0.yy, Pi1.yy);\n  vec4 iz0 = Pi0.zzzz;\n  vec4 iz1 = Pi1.zzzz;\n\n  vec4 ixy = permute(permute(ix) + iy);\n  vec4 ixy0 = permute(ixy + iz0);\n  vec4 ixy1 = permute(ixy + iz1);\n\n  vec4 gx0 = ixy0 / 7.0;\n  vec4 gy0 = fract(floor(gx0) / 7.0) - 0.5;\n  gx0 = fract(gx0);\n  vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);\n  vec4 sz0 = step(gz0, vec4(0.0));\n  gx0 -= sz0 * (step(0.0, gx0) - 0.5);\n  gy0 -= sz0 * (step(0.0, gy0) - 0.5);\n\n  vec4 gx1 = ixy1 / 7.0;\n  vec4 gy1 = fract(floor(gx1) / 7.0) - 0.5;\n  gx1 = fract(gx1);\n  vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);\n  vec4 sz1 = step(gz1, vec4(0.0));\n  gx1 -= sz1 * (step(0.0, gx1) - 0.5);\n  gy1 -= sz1 * (step(0.0, gy1) - 0.5);\n\n  vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);\n  vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);\n  vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);\n  vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);\n  vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);\n  vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);\n  vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);\n  vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);\n\n  vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));\n  g000 *= norm0.x;\n  g010 *= norm0.y;\n  g100 *= norm0.z;\n  g110 *= norm0.w;\n  vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));\n  g001 *= norm1.x;\n  g011 *= norm1.y;\n  g101 *= norm1.z;\n  g111 *= norm1.w;\n\n  float n000 = dot(g000, Pf0);\n  float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));\n  float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));\n  float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));\n  float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));\n  float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));\n  float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));\n  float n111 = dot(g111, Pf1);\n\n  vec3 fade_xyz = fade(Pf0);\n  vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);\n  vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);\n  float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x); \n  return 2.2 * n_xyz;\n}\n// \n\nvoid main() {\n\n    vec3 pos = position;\n\n    float speed = 0.01 * uSpeed;\n    float loopLength = 10.0 * speed;\n\n    float factor1 = uSmoothness;\n    float factor2 = uSmoothness * 0.8;\n    float factor = mix(factor1, factor2, sin( uTime ));\n\n    // Lerp-based noise loop\n    float transitionStart = loopLength * 0.5;\n    float time = mod(uTime * speed, loopLength);\n\n    float v1 = cnoise(pos + time);\n    float v2 = cnoise(pos + time - loopLength);\n\n\tfor ( int i = 0; i < uPasses; i ++ ) {\n\t\tv1 = cnoise( vec3(v1) );\n\t\tv2 = cnoise( vec3(v2) );\n\t}\n\n    float transitionProgress = (time-transitionStart)/(loopLength-transitionStart);\n    float progress = clamp(transitionProgress, 0.0, 1.0);\n\n    float noise = mix(v1, v2, progress) / factor;\n\n    pos += noise;\n\n    gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4(pos, 1.0);\n\n    vPosition = modelMatrix * vec4(pos, 1.0);\n    vDistance = distance(pos, vec3(0.0));\n\n}",fragmentShader:"uniform float uValue1;\nuniform float uValue2;\nvarying vec4 vPosition;\nvarying float vDistance;\n\nfloat map(float s, float a1, float a2, float b1, float b2) {\n\n    return b1 + (s-a1)*(b2-b1)/(a2-a1);\n\n}\n\nvoid main() {\n\n\tvec4 baseColor = vec4( 0.95, 0.98, 1.0, 1.0 );\n\tvec4 color1 = baseColor * uValue1;\n\tvec4 color2 = baseColor * uValue2;\n\n    float distanceMap = map(vDistance, 1.0 , 1.1, 0.0, 1.0);\n\n    vec4 color = mix( color1, color2, distanceMap );\n\n    gl_FragColor = vec4( color );\n\n}",uniforms:{uPasses:{value:r},uSmoothness:{value:i},uSpeed:{value:s},uTime:{value:0},uValue1:{value:u},uValue2:{value:l}}});return(e=o.call(this,f,h)).rotationSpeed=function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?er(Object(n),!0).forEach((function(e){nr(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):er(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({},c),e}return n=a,(r=[{key:"update",value:function(t){var e=this.rotation,n=this.rotationSpeed,r=.01;t/=1e3,e.x=t*n.x*r,e.y=t*n.y*r,e.z=t*n.z*r,this.time=t}},{key:"invert",value:function(){var t=this.value1,e=this.value2,n=t;t=e,e=n}},{key:"passes",get:function(){return this.material.uniforms.uPasses.value},set:function(t){this.material.uniforms.uPasses.value=t}},{key:"smoothness",get:function(){return this.material.uniforms.uSmoothness.value},set:function(t){this.material.uniforms.uSmoothness.value=t}},{key:"speed",get:function(){return this.material.uniforms.uSpeed.value},set:function(t){this.material.uniforms.uSpeed.value=t}},{key:"time",get:function(){return this.material.uniforms.uTime.value},set:function(t){this.material.uniforms.uTime.value=t}},{key:"value1",get:function(){return this.material.uniforms.uValue1.value},set:function(t){this.material.uniforms.uValue1.value=t}},{key:"value2",get:function(){return this.material.uniforms.uValue2.value},set:function(t){this.material.uniforms.uValue2.value=t}}])&&rr(n.prototype,r),i&&rr(n,i),Object.defineProperty(n,"prototype",{writable:!1}),a}(t.Mesh);function lr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function cr(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var fr=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;lr(this,t),this.callbacks="function"==typeof e?[e]:e,this.fps=n,this.elapsed=0,this._last=0,this._delta=0,this._isPlaying=!1,this._tick=this.tick.bind(this)}var e,n,r;return e=t,n=[{key:"add",value:function(t){this.has(t)||this.callbacks.push(t)}},{key:"remove",value:function(t){this.has(t)&&this.callbacks.splice(this.callbacks.indexOf(t),1)}},{key:"has",value:function(t){return this.callbacks.includes(t)}},{key:"reset",value:function(){this.elapsed=0}},{key:"start",value:function(){this._last=this.now,this._delta=0,this._isPlaying=!0,this.requestFrame()}},{key:"pause",value:function(){this._isPlaying=!1}},{key:"stop",value:function(){this.pause(),this.reset()}},{key:"tick",value:function(){var e=this;if(this.isPlaying){this.requestFrame();var n=this.now,r=Math.min(t.maxDelta,n-this._last);this._last=n,this._delta+=r,this.elapsed+=r;var i=this._frameDuration-this._delta;i<=0&&(this.callbacks.forEach((function(t){return t.call(e,e.elapsed,e._delta)})),this._delta=Math.abs(i))}}},{key:"requestFrame",value:function(){requestAnimationFrame(this._tick)}},{key:"fps",get:function(){return this._fps},set:function(t){this._fps=t,this._frameDuration=t>0?Math.floor(1e3/t):0}},{key:"isPlaying",get:function(){return this._isPlaying}},{key:"now",get:function(){return t.time.now()}}],n&&cr(e.prototype,n),r&&cr(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();fr.maxDelta=100,fr.time=void 0===performance?Date:performance;var hr=document.body.style,dr=k.camera,pr=k.scene,vr=new t.Vector2,mr=new t.Raycaster;function gr(t){vr.x=t.clientX/window.innerWidth*2-1,vr.y=1-t.clientY/window.innerHeight*2}function yr(t){gr(t),xr.intersects&&Qn.random()}var xr={pointer:vr,raycaster:mr,update:function(){var t=xr.camera,e=t.target,n=t.origin,r=t.targetXY,i=t.lookAt,o=t.lerpSpeed;e.x=n.x+r.x*vr.x,e.y=n.y+r.y*vr.y,e.z=n.z,dr.position.lerp(e,o),dr.lookAt(i);var a=xr.intersects;hr.cursor=a?"pointer":"auto"},init:function(){var t=Mn.canvas;t.addEventListener("pointermove",gr),t.addEventListener("pointerup",yr)},resize:function(e,n){dr.position.set(0,.5,10),e<n&&(dr.position.z=14),xr.camera={lookAt:new t.Vector3(0,0,0),origin:new t.Vector3,target:new t.Vector3,targetXY:new t.Vector2(5,1),lerpSpeed:.02},xr.camera.origin.copy(dr.position)},get intersects(){return mr.setFromCamera(vr,dr),mr.intersectObjects(pr.children,!1).length}};h.init(),h.digits=2,Qn.load();var _r=k.scene,br=new q;br.position.y=-1.35,_r.add(br);var Ar=new ur;function Tr(t){Qn.init(Ar),br.init(t),Mn.init(),xr.init(),setTimeout(kn.init,0),window.addEventListener("resize",wr),wr(),new fr(Sr,60).start()}function wr(){var t=window,e=t.innerWidth,n=t.innerHeight,r=t.devicePixelRatio,i=e,o=n;[k,Mn,br,xr].forEach((function(t){return t.resize(i,o,r)})),Ar.position.z=i<o?2:0}function Sr(t){[xr,Ar,Mn].forEach((function(e){return e.update(t)}))}_r.add(Ar),(new t.TextureLoader).load("textures/polished_concrete_basecolor.jpg",(function(t){return Tr(t)}),void 0,(function(){return Tr()}))})()})();